{
  "version": 3,
  "sources": [
    "node_modules/browser-pack/_prelude.js",
    "node_modules/microevent.ts/lib/Event.js",
    "node_modules/microevent.ts/lib/index.js",
    "node_modules/worker-rpc/lib/RpcProvider.js",
    "node_modules/worker-rpc/lib/index.js",
    "src/tools/pool/Pool.ts",
    "src/tools/pool/PoolMember.ts",
    "src/video/processing/FrameMergeProcessor.ts",
    "src/video/processing/PassthroughProcessor.ts",
    "src/video/processing/ProcessorFactory.ts",
    "src/video/processing/ProcessorPipeline.ts",
    "src/video/processing/worker/PipelineHost.ts",
    "src/video/processing/worker/messages.ts",
    "src/video/surface/ArrayBufferSurface.ts",
    "worker/src/main/video-pipeline.ts",
    "worker/src/rpc.ts"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",
    "\"use strict\";\nvar factories = [];\nfactories[0] = function () {\n    return function dispatcher0() { };\n};\nfactories[1] = function (callback, context) {\n    if (typeof (context) === 'undefined')\n        return callback;\n    return function dispatcher1(payload) {\n        callback(payload, context);\n    };\n};\nfunction getFactory(handlerCount) {\n    if (!factories[handlerCount])\n        factories[handlerCount] = compileFactory(handlerCount);\n    return factories[handlerCount];\n}\nfunction compileFactory(handlerCount) {\n    var src = 'return function dispatcher' + handlerCount + '(payload) {\\n';\n    var argsHandlers = [], argsContexts = [];\n    for (var i = 0; i < handlerCount; i++) {\n        argsHandlers.push('cb' + i);\n        argsContexts.push('ctx' + i);\n        src += '    cb' + i + '(payload, ctx' + i + ');\\n';\n    }\n    src += '};';\n    return new (Function.bind.apply(Function, [void 0].concat(argsHandlers.concat(argsContexts), [src])))();\n}\nvar Event = (function () {\n    function Event() {\n        this.hasHandlers = false;\n        this._handlers = [];\n        this._contexts = [];\n        this._createDispatcher();\n    }\n    Event.prototype.addHandler = function (handler, context) {\n        if (!this.isHandlerAttached(handler, context)) {\n            this._handlers.push(handler);\n            this._contexts.push(context);\n            this._createDispatcher();\n            this._updateHasHandlers();\n        }\n        return this;\n    };\n    Event.prototype.removeHandler = function (handler, context) {\n        var idx = this._getHandlerIndex(handler, context);\n        if (typeof (idx) !== 'undefined') {\n            this._handlers.splice(idx, 1);\n            this._contexts.splice(idx, 1);\n            this._createDispatcher();\n            this._updateHasHandlers();\n        }\n        return this;\n    };\n    Event.prototype.isHandlerAttached = function (handler, context) {\n        return typeof (this._getHandlerIndex(handler, context)) !== 'undefined';\n    };\n    Event.prototype._updateHasHandlers = function () {\n        this.hasHandlers = !!this._handlers.length;\n    };\n    Event.prototype._getHandlerIndex = function (handler, context) {\n        var handlerCount = this._handlers.length;\n        var idx;\n        for (idx = 0; idx < handlerCount; idx++) {\n            if (this._handlers[idx] === handler && this._contexts[idx] === context)\n                break;\n        }\n        return idx < handlerCount ? idx : undefined;\n    };\n    Event.prototype._createDispatcher = function () {\n        this.dispatch = getFactory(this._handlers.length).apply(this, this._handlers.concat(this._contexts));\n    };\n    return Event;\n}());\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = Event;\n",
    "\"use strict\";\nvar Event_1 = require('./Event');\nexports.Event = Event_1.default;\n",
    "\"use strict\";\nvar microevent_ts_1 = require('microevent.ts');\nvar MSG_RESOLVE_TRANSACTION = \"resolve_transaction\", MSG_REJECT_TRANSACTION = \"reject_transaction\", MSG_ERROR = \"error\";\nvar RpcProvider = (function () {\n    function RpcProvider(_dispatch, _rpcTimeout) {\n        if (_rpcTimeout === void 0) { _rpcTimeout = 0; }\n        this._dispatch = _dispatch;\n        this._rpcTimeout = _rpcTimeout;\n        this.error = new microevent_ts_1.Event();\n        this._rpcHandlers = {};\n        this._signalHandlers = {};\n        this._pendingTransactions = {};\n        this._nextTransactionId = 0;\n    }\n    RpcProvider.prototype.dispatch = function (payload) {\n        var message = payload;\n        switch (message.type) {\n            case RpcProvider.MessageType.signal:\n                return this._handleSignal(message);\n            case RpcProvider.MessageType.rpc:\n                return this._handeRpc(message);\n            case RpcProvider.MessageType.internal:\n                return this._handleInternal(message);\n            default:\n                this._raiseError(\"invalid message type \" + message.type);\n        }\n    };\n    RpcProvider.prototype.rpc = function (id, payload, transfer) {\n        var _this = this;\n        var transactionId = this._nextTransactionId++;\n        this._dispatch({\n            type: RpcProvider.MessageType.rpc,\n            transactionId: transactionId,\n            id: id,\n            payload: payload\n        }, transfer ? transfer : undefined);\n        return new Promise(function (resolve, reject) {\n            var transaction = _this._pendingTransactions[transactionId] = {\n                id: transactionId,\n                resolve: resolve,\n                reject: reject\n            };\n            if (_this._rpcTimeout > 0) {\n                _this._pendingTransactions[transactionId].timeoutHandle =\n                    setTimeout(function () { return _this._transactionTimeout(transaction); }, _this._rpcTimeout);\n            }\n        });\n    };\n    ;\n    RpcProvider.prototype.signal = function (id, payload, transfer) {\n        this._dispatch({\n            type: RpcProvider.MessageType.signal,\n            id: id,\n            payload: payload,\n        }, transfer ? transfer : undefined);\n        return this;\n    };\n    RpcProvider.prototype.registerRpcHandler = function (id, handler) {\n        if (this._rpcHandlers[id]) {\n            throw new Error(\"rpc handler for \" + id + \" already registered\");\n        }\n        this._rpcHandlers[id] = handler;\n        return this;\n    };\n    ;\n    RpcProvider.prototype.registerSignalHandler = function (id, handler) {\n        if (!this._signalHandlers[id]) {\n            this._signalHandlers[id] = [];\n        }\n        this._signalHandlers[id].push(handler);\n        return this;\n    };\n    RpcProvider.prototype.deregisterRpcHandler = function (id, handler) {\n        if (this._rpcHandlers[id]) {\n            delete this._rpcHandlers[id];\n        }\n        return this;\n    };\n    ;\n    RpcProvider.prototype.deregisterSignalHandler = function (id, handler) {\n        if (this._signalHandlers[id]) {\n            this._signalHandlers[id] = this._signalHandlers[id].filter(function (h) { return handler !== h; });\n        }\n        return this;\n    };\n    RpcProvider.prototype._raiseError = function (error) {\n        this.error.dispatch(new Error(error));\n        this._dispatch({\n            type: RpcProvider.MessageType.internal,\n            id: MSG_ERROR,\n            payload: error\n        });\n    };\n    RpcProvider.prototype._handleSignal = function (message) {\n        if (!this._signalHandlers[message.id]) {\n            return this._raiseError(\"invalid signal \" + message.id);\n        }\n        this._signalHandlers[message.id].forEach(function (handler) { return handler(message.payload); });\n    };\n    RpcProvider.prototype._handeRpc = function (message) {\n        var _this = this;\n        if (!this._rpcHandlers[message.id]) {\n            return this._raiseError(\"invalid rpc \" + message.id);\n        }\n        Promise.resolve(this._rpcHandlers[message.id](message.payload))\n            .then(function (result) { return _this._dispatch({\n            type: RpcProvider.MessageType.internal,\n            id: MSG_RESOLVE_TRANSACTION,\n            transactionId: message.transactionId,\n            payload: result\n        }); }, function (reason) { return _this._dispatch({\n            type: RpcProvider.MessageType.internal,\n            id: MSG_REJECT_TRANSACTION,\n            transactionId: message.transactionId,\n            payload: reason\n        }); });\n    };\n    RpcProvider.prototype._handleInternal = function (message) {\n        switch (message.id) {\n            case MSG_RESOLVE_TRANSACTION:\n                if (!this._pendingTransactions[message.transactionId]) {\n                    return this._raiseError(\"no pending transaction with id \" + message.transactionId);\n                }\n                this._pendingTransactions[message.transactionId].resolve(message.payload);\n                this._clearTransaction(this._pendingTransactions[message.transactionId]);\n                break;\n            case MSG_REJECT_TRANSACTION:\n                if (!this._pendingTransactions[message.transactionId]) {\n                    return this._raiseError(\"no pending transaction with id \" + message.transactionId);\n                }\n                this._pendingTransactions[message.transactionId].reject(message.payload);\n                this._clearTransaction(this._pendingTransactions[message.transactionId]);\n                break;\n            case MSG_ERROR:\n                this.error.dispatch(new Error(\"remote error: \" + message.payload));\n                break;\n            default:\n                this._raiseError(\"unhandled internal message \" + message.id);\n                break;\n        }\n    };\n    RpcProvider.prototype._transactionTimeout = function (transaction) {\n        transaction.reject('transaction timed out');\n        this._raiseError(\"transaction \" + transaction.id + \" timed out\");\n        delete this._pendingTransactions[transaction.id];\n        return;\n    };\n    RpcProvider.prototype._clearTransaction = function (transaction) {\n        if (typeof (transaction.timeoutHandle) !== 'undefined') {\n            clearTimeout(transaction.timeoutHandle);\n        }\n        delete this._pendingTransactions[transaction.id];\n    };\n    return RpcProvider;\n}());\nvar RpcProvider;\n(function (RpcProvider) {\n    (function (MessageType) {\n        MessageType[MessageType[\"signal\"] = 0] = \"signal\";\n        MessageType[MessageType[\"rpc\"] = 1] = \"rpc\";\n        MessageType[MessageType[\"internal\"] = 2] = \"internal\";\n    })(RpcProvider.MessageType || (RpcProvider.MessageType = {}));\n    var MessageType = RpcProvider.MessageType;\n    ;\n})(RpcProvider || (RpcProvider = {}));\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = RpcProvider;\n",
    "\"use strict\";\nvar RpcProvider_1 = require('./RpcProvider');\nexports.RpcProvider = RpcProvider_1.default;\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { Event } from 'microevent.ts';\n\nimport PoolMember from './PoolMember';\nimport PoolInterface from './PoolInterface';\n\nclass Pool<T> implements PoolInterface<T> {\n    constructor(private _factory: Pool.FactoryInterface<T>) {}\n\n    get(): PoolMember<T> {\n        let member: PoolMember<T>;\n\n        if (this._poolSize === 0) {\n            const newItem = this._factory();\n\n            member = new PoolMember<T>(\n                newItem,\n                (victim: PoolMember<T>) => this._releaseMember(victim),\n                (victim: PoolMember<T>) => this._disposeMember(victim)\n            );\n        } else {\n            member = this._pool[--this._poolSize];\n            member._isAvailable = false;\n        }\n\n        return member;\n    }\n\n    private _releaseMember(victim: PoolMember<T>) {\n        if (victim._isAvailable) {\n            throw new Error('Trying to release an already released pool member');\n        }\n\n        if (victim._isDisposed) {\n            throw new Error('Trying to release an already disposed pool member');\n        }\n\n        const position = this._poolSize++;\n\n        this._pool[position] = victim;\n\n        victim._isAvailable = true;\n        victim._poolPosition = position;\n\n        this.event.release.dispatch(victim.get());\n    }\n\n    private _disposeMember(victim: PoolMember<T>) {\n        if (victim._isDisposed) {\n            throw new Error('Trying to dispose of an already disposed pool member');\n        }\n\n        if (victim._isAvailable) {\n            if (this._poolSize > 1) {\n                this._pool[victim._poolPosition] = this._pool[this._poolSize - 1];\n            }\n\n            this._poolSize--;\n        }\n\n        victim._isDisposed = true;\n\n        this.event.dispose.dispatch(victim.get());\n    }\n\n    event = {\n        release: new Event<T>(),\n        dispose: new Event<T>()\n    };\n\n    private _pool: Array<PoolMember<T>> = [];\n\n    private _poolSize = 0;\n}\n\nnamespace Pool {\n    export interface FactoryInterface<T> {\n        (): T;\n    }\n\n    export interface RecycleCallbackInterface<T> {\n        (value: T): void;\n    }\n\n    export interface DisposeCallbackInterface<T> {\n        (value: T): void;\n    }\n}\n\nexport { Pool as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport PoolMemberInterface from './PoolMemberInterface';\n\nclass PoolMember<T> implements PoolMemberInterface<T> {\n    constructor(\n        private _value: T,\n        private _releaseCB: (victim: PoolMember<T>) => void,\n        private _disposeCB: (victim: PoolMember<T>) => void\n    ) {}\n\n    adopt(target: T): void {\n        this._value = target;\n    }\n\n    get(): T {\n        return this._value;\n    }\n\n    release(): void {\n        this._releaseCB(this);\n    }\n\n    dispose(): void {\n        this._disposeCB(this);\n    }\n\n    public _isAvailable = false;\n    public _isDisposed = false;\n    public _poolPosition: number;\n}\n\nexport { PoolMember as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { Event } from 'microevent.ts';\n\nimport ProcessorInterface from './ProcessorInterface';\nimport RGBASurfaceInterface from '../surface/RGBASurfaceInterface';\nimport PoolMemberInterface from '../../tools/pool/PoolMemberInterface';\n\nclass FrameMergeProcessor implements ProcessorInterface {\n    init(width: number, height: number) {\n        this.flush();\n\n        this._width = width;\n        this._height = height;\n    }\n\n    flush(): void {\n        for (let i = 0; i < this._nFramesOnHold; i++) {\n            this._framesOnHold[i].release();\n            this._framesOnHold[i] = null;\n        }\n\n        this._nFramesOnHold = 0;\n    }\n\n    processSurface(wrappedSurface: PoolMemberInterface<RGBASurfaceInterface>): void {\n        const surface = wrappedSurface.get();\n\n        if (surface.getHeight() !== this._height || surface.getWidth() !== this._width) {\n            throw new Error('surface dimensions do not match');\n        }\n\n        this._framesOnHold[this._nFramesOnHold++] = wrappedSurface;\n\n        if (this._nFramesOnHold === 2) {\n            this._process();\n        }\n    }\n\n    private _process(): void {\n        const buffer0 = this._framesOnHold[0].get().getBuffer(),\n            buffer1 = this._framesOnHold[1].get().getBuffer();\n\n        for (let i = 0; i < this._width * this._height; i++) {\n            buffer0[i] =\n                0xff000000 |\n                ((((buffer0[i] & 0xff0000) + (buffer1[i] & 0xff0000)) >>> 1) & 0xff0000) |\n                ((((buffer0[i] & 0xff00) + (buffer1[i] & 0xff00)) >>> 1) & 0xff00) |\n                ((((buffer0[i] & 0xff) + (buffer1[i] & 0xff)) >>> 1) & 0xff);\n        }\n\n        this.emit.dispatch(this._framesOnHold[0]);\n        this._framesOnHold[1].release();\n\n        this._nFramesOnHold = 0;\n    }\n\n    emit = new Event<PoolMemberInterface<RGBASurfaceInterface>>();\n\n    private _framesOnHold = new Array<PoolMemberInterface<RGBASurfaceInterface>>(2);\n    private _nFramesOnHold = 0;\n\n    private _width = 0;\n    private _height = 0;\n}\n\nexport { FrameMergeProcessor as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { Event } from 'microevent.ts';\n\nimport RGBASurfaceInterface from '../surface/RGBASurfaceInterface';\nimport PoolMemberInterface from '../../tools/pool/PoolMemberInterface';\nimport ProcessorInterface from './ProcessorInterface';\n\nclass PassthroughProcessor implements ProcessorInterface {\n    init(): void {}\n\n    flush(): void {}\n\n    processSurface(surface: PoolMemberInterface<RGBASurfaceInterface>): void {\n        this.emit.dispatch(surface);\n    }\n\n    emit = new Event<PoolMemberInterface<RGBASurfaceInterface>>();\n}\n\nexport { PassthroughProcessor as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport ProcessorInterface from './ProcessorInterface';\nimport * as Config from './config';\n\nimport PassthroughProcessor from './PassthroughProcessor';\nimport FrameMergeProcessor from './FrameMergeProcessor';\n\nclass ProcessorFactory {\n    create(config: Config.ProcessorConfig): ProcessorInterface {\n        switch (config.type) {\n            case Config.Type.passthrough:\n                return new PassthroughProcessor();\n\n            case Config.Type.merge:\n                return new FrameMergeProcessor();\n\n            default:\n                throw new Error('cannot happen: invalid processor type');\n        }\n    }\n}\n\nexport { ProcessorFactory as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { EventInterface } from 'microevent.ts';\n\nimport RGBASurfaceInterface from '../surface/RGBASurfaceInterface';\nimport PoolMemberInterface from '../../tools/pool/PoolMemberInterface';\nimport ProcessorInterface from './ProcessorInterface';\nimport ProcessorFactory from './ProcessorFactory';\nimport { ProcessorConfig, Type } from './config';\n\nclass ProcessorPipeline implements ProcessorInterface {\n    constructor(config?: Array<ProcessorConfig>) {\n        if (!config || config.length === 0) {\n            config = [{ type: Type.passthrough }];\n        }\n\n        const factory = new ProcessorFactory();\n\n        this._processors = config.map(cfg => factory.create(cfg));\n\n        for (let i = 1; i < this._processors.length; i++) {\n            this._processors[i - 1].emit.addHandler(surface => this._processors[i].processSurface(surface));\n        }\n\n        this.emit = this._processors[this._processors.length - 1].emit;\n    }\n\n    init(width: number, height: number): void {\n        this._processors.forEach(prc => prc.init(width, height));\n    }\n\n    flush(): void {\n        this._processors.forEach(prc => prc.flush());\n    }\n\n    processSurface(surface: PoolMemberInterface<RGBASurfaceInterface>): void {\n        this._processors[0].processSurface(surface);\n    }\n\n    emit: EventInterface<PoolMemberInterface<RGBASurfaceInterface>>;\n\n    private _processors: Array<ProcessorInterface>;\n}\n\nexport { ProcessorPipeline as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { RpcProviderInterface } from 'worker-rpc';\n\nimport ArrayBufferSurface from '../../surface/ArrayBufferSurface';\nimport Pool from '../../../tools/pool/Pool';\nimport PoolMemberInterface from '../../../tools/pool/PoolMemberInterface';\nimport * as messages from './messages';\nimport ProcessorPipeline from '../ProcessorPipeline';\n\nclass PipelineHost {\n    constructor(private _rpc: RpcProviderInterface) {\n        this._rpc\n            .registerRpcHandler(messages.messageIds.configure, this._onConfigure.bind(this))\n            .registerRpcHandler(messages.messageIds.flush, this._onFlush.bind(this))\n            .registerSignalHandler(messages.messageIds.process, this._onProcess.bind(this));\n\n        this._surfacePool.event.release.addHandler(PipelineHost._onReleaseSurface, this);\n    }\n\n    private static _onReleaseSurface(surface: ArrayBufferSurface, self: PipelineHost): void {\n        const buffer = surface.getUnderlyingBuffer();\n\n        if (!buffer) {\n            return;\n        }\n\n        if (!self._bufferIds.has(buffer)) {\n            throw new Error('double release');\n        }\n\n        const id = self._bufferIds.get(buffer);\n        self._bufferIds.delete(buffer);\n\n        self._rpc.signal(\n            messages.messageIds.release,\n            {\n                id,\n                buffer\n            } as messages.ReleaseMessage,\n            [buffer]\n        );\n    }\n\n    private static _onEmitSurface(managedSurface: PoolMemberInterface<ArrayBufferSurface>, self: PipelineHost): void {\n        const buffer = managedSurface.get().getUnderlyingBuffer();\n\n        if (!self._bufferIds.has(buffer)) {\n            throw new Error('double release');\n        }\n\n        const id = self._bufferIds.get(buffer);\n        self._bufferIds.delete(buffer);\n\n        self._rpc.signal(\n            messages.messageIds.emit,\n            {\n                id,\n                buffer\n            } as messages.EmitMessage,\n            [buffer]\n        );\n\n        managedSurface.get().resetUnderlyingBuffer();\n        managedSurface.release();\n    }\n\n    private _onConfigure(msg: messages.ConfigureMessage): void {\n        if (this._pipeline) {\n            this._pipeline.flush();\n            this._pipeline.emit.removeHandler(PipelineHost._onEmitSurface, this);\n        }\n\n        this._pipeline = new ProcessorPipeline(msg.config);\n        this._pipeline.init(msg.width, msg.height);\n        this._pipeline.emit.addHandler(PipelineHost._onEmitSurface, this);\n    }\n\n    private _onFlush(msg: messages.FlushMessage): void {\n        if (this._pipeline) {\n            this._pipeline.flush();\n        }\n    }\n\n    private _onProcess(msg: messages.ProcessMessage): void {\n        if (!this._pipeline) {\n            return;\n        }\n\n        this._bufferIds.set(msg.buffer, msg.id);\n\n        const managedSurface = this._surfacePool.get();\n        managedSurface.get().replaceUnderlyingBuffer(msg.width, msg.height, msg.buffer);\n\n        this._pipeline.processSurface(managedSurface);\n    }\n\n    private _pipeline: ProcessorPipeline = null;\n    private _surfacePool = new Pool<ArrayBufferSurface>(() => new ArrayBufferSurface());\n    private _bufferIds = new WeakMap<ArrayBuffer, number>();\n}\n\nexport { PipelineHost as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { ProcessorConfig } from '../config';\n\nexport const messageIds = {\n    configure: 'pipeline/configure',\n    flush: 'pipeline/flush',\n    process: 'pipeline/process',\n    emit: 'pipeline/emit',\n    release: 'pipeline/release'\n};\nObject.freeze(messageIds);\n\nexport interface ConfigureMessage {\n    width: number;\n    height: number;\n    config: Array<ProcessorConfig>;\n}\n\nexport interface FlushMessage {}\n\nexport interface ProcessMessage {\n    id: number;\n    buffer: ArrayBuffer;\n    width: number;\n    height: number;\n}\n\nexport interface EmitMessage {\n    id: number;\n    buffer: ArrayBuffer;\n}\n\nexport interface ReleaseMessage {\n    id: number;\n    buffer: ArrayBuffer;\n}\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport RGBASurfaceInterface from './RGBASurfaceInterface';\n\nclass ArrayBufferSurface implements RGBASurfaceInterface {\n    static createFromArrayBuffer(width: number, height: number, buffer: ArrayBuffer): ArrayBufferSurface {\n        return new ArrayBufferSurface().replaceUnderlyingBuffer(width, height, buffer);\n    }\n\n    replaceUnderlyingBuffer(width: number, height: number, buffer: ArrayBuffer): ArrayBufferSurface {\n        if (width * height * 4 !== buffer.byteLength) {\n            throw new Error('surface size mismatch');\n        }\n\n        this._width = width;\n        this._height = height;\n        this._underlyingBuffer = buffer;\n\n        this._buffer = new Uint32Array(this._underlyingBuffer);\n\n        return this;\n    }\n\n    getUnderlyingBuffer(): ArrayBuffer {\n        return this._underlyingBuffer;\n    }\n\n    resetUnderlyingBuffer(): ArrayBufferSurface {\n        this._width = this._height = 0;\n        this._underlyingBuffer = this._buffer = null;\n\n        return this;\n    }\n\n    getWidth(): number {\n        return this._width;\n    }\n\n    getHeight(): number {\n        return this._height;\n    }\n\n    getBuffer(): Uint32Array {\n        return this._buffer;\n    }\n\n    getByteOrder(): RGBASurfaceInterface.ByteOrder {\n        return RGBASurfaceInterface.ByteOrder.rgba;\n    }\n\n    fill(value: number): this {\n        for (let i = 0; i < this._buffer.length; i++) {\n            this._buffer[i] = value;\n        }\n\n        return this;\n    }\n\n    private _height = 0;\n    private _width = 0;\n    private _underlyingBuffer: ArrayBuffer;\n\n    private _buffer: Uint32Array = null;\n}\n\nexport { ArrayBufferSurface as default };\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\nimport { getRpc } from '../rpc';\nimport PipelineHost from '../../../src/video/processing/worker/PipelineHost';\n\nexport const pipelineHost = new PipelineHost(getRpc());\n",
    "/*\n *   This file is part of 6502.ts, an emulator for 6502 based systems built\n *   in Typescript.\n *\n *   Copyright (C) 2014 - 2018 Christian Speckner & contributors\n *\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version.\n *\n *   This program is distributed in the hope that it will be useful,\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *   GNU General Public License for more details.\n *\n *   You should have received a copy of the GNU General Public License along\n *   with this program; if not, write to the Free Software Foundation, Inc.,\n *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n */\n\ndeclare function postMessage(message: any, transfer?: any): void;\n\nimport { RpcProviderInterface, RpcProvider } from 'worker-rpc';\n\nlet rpcProvider: RpcProvider = null,\n    port: MessagePort = null,\n    portPending: MessagePort = null;\n\nfunction send(message: any, transfer?: any): void {\n    if (port) {\n        port.postMessage(message, transfer);\n    } else {\n        postMessage(message, transfer);\n    }\n\n    if (portPending) {\n        port = portPending;\n        port.onmessage = (e: MessageEvent) => rpcProvider.dispatch(e.data);\n    }\n\n    portPending = null;\n}\n\nrpcProvider = new RpcProvider(send);\nrpcProvider.error.addHandler(e => {\n    console.log(e ? e.message : 'unknown rpc error');\n});\nonmessage = (e: MessageEvent) => port || rpcProvider.dispatch(e.data);\n\nrpcProvider.registerRpcHandler('/use-port', (newPort: MessagePort) => {\n    if (!(port || portPending)) {\n        portPending = newPort;\n        return Promise.resolve();\n    } else {\n        return Promise.reject('RPC already switched to message port');\n    }\n});\n\nexport function getRpc(): RpcProviderInterface {\n    return rpcProvider;\n}\n"
  ]
}