
/*
 *   This file is part of 6502.ts, an emulator for 6502 based systems built
 *   in Typescript.
 *
 *   Copyright (C) 2014 - 2018 Christian Speckner & contributors
 *
 *   This program is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation; either version 2 of the License, or
 *   (at your option) any later version.
 *
 *   This program is distributed in the hope that it will be useful,
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *   GNU General Public License for more details.
 *
 *   Please go to the project's github page at
 *
 *   https://github.com/6502ts/6502.ts
 *
 *   for more details and for a copy of the GNU General Public License v2.
 */

!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).$6502=t()}}(function(){return function s(a,o,u){function c(e,t){if(!o[e]){if(!a[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[e]={exports:{}};a[e][0].call(n.exports,function(t){return c(a[e][1][t]||t)},n,n.exports,s,a,o,u)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(){this._queue=[],this._pending=!1}return t.prototype.isLocked=function(){return this._pending},t.prototype.acquire=function(){var e=this,t=new Promise(function(t){return e._queue.push(t)});return this._pending||this._dispatchNext(),t},t.prototype.runExclusive=function(r){return this.acquire().then(function(e){var t;try{t=r()}catch(t){throw e(),t}return Promise.resolve(t).then(function(t){return e(),t},function(t){throw e(),t})})},t.prototype._dispatchNext=function(){0<this._queue.length?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1},t}();r.default=i},{}],2:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./Mutex");r.Mutex=i.default},{"./Mutex":1}],3:[function(t,e,r){"use strict";var i=[];function n(t){return i[t]||(i[t]=function(t){for(var e="return function dispatcher"+t+"(payload) {\n",r=[],i=[],n=0;n<t;n++)r.push("cb"+n),i.push("ctx"+n),e+="    cb"+n+"(payload, ctx"+n+");\n";return e+="};",new(Function.bind.apply(Function,[void 0].concat(r.concat(i),[e])))}(t)),i[t]}i[0]=function(){return function(){}},i[1]=function(e,r){return void 0===r?e:function(t){e(t,r)}};var s=function(){function t(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return t.prototype.addHandler=function(t,e){return this.isHandlerAttached(t,e)||(this._handlers.push(t),this._contexts.push(e),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.removeHandler=function(t,e){var r=this._getHandlerIndex(t,e);return void 0!==r&&(this._handlers.splice(r,1),this._contexts.splice(r,1),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.isHandlerAttached=function(t,e){return void 0!==this._getHandlerIndex(t,e)},t.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},t.prototype._getHandlerIndex=function(t,e){var r,i=this._handlers.length;for(r=0;r<i&&(this._handlers[r]!==t||this._contexts[r]!==e);r++);return r<i?r:void 0},t.prototype._createDispatcher=function(){this.dispatch=n(this._handlers.length).apply(this,this._handlers.concat(this._contexts))},t}();Object.defineProperty(r,"__esModule",{value:!0}),r.default=s},{}],4:[function(t,e,r){"use strict";var i=t("./Event");r.Event=i.default},{"./Event":3}],5:[function(t,a,e){!function(){"use strict";var s="undefined"!=typeof window&&void 0!==window.document?window.document:{},t=void 0!==a&&a.exports,r="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,i=function(){for(var t,e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=e.length,n={};r<i;r++)if((t=e[r])&&t[1]in s){for(r=0;r<t.length;r++)n[e[0][r]]=t[r];return n}return!1}(),n={change:i.fullscreenchange,error:i.fullscreenerror},e={request:function(t){var e=i.requestFullscreen;t=t||s.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?t[e]():t[e](r?Element.ALLOW_KEYBOARD_INPUT:{})},exit:function(){s[i.exitFullscreen]()},toggle:function(t){this.isFullscreen?this.exit():this.request(t)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,e){var r=n[t];r&&s.addEventListener(r,e,!1)},off:function(t,e){var r=n[t];r&&s.removeEventListener(r,e,!1)},raw:i};i?(Object.defineProperties(e,{isFullscreen:{get:function(){return Boolean(s[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return s[i.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(s[i.fullscreenEnabled])}}}),t?a.exports=e:window.screenfull=e):t?a.exports=!1:window.screenfull=!1}()},{}],6:[function(t,w,e){(function(i){var e,r,n,s,a,o,u,c,l,_,h,d,p,f,m,g,v,y,b;!function(t){var e="object"==typeof i?i:"object"==typeof self?self:"object"==typeof this?this:{};function r(r,i){return r!==e&&("function"==typeof Object.create?Object.defineProperty(r,"__esModule",{value:!0}):r.__esModule=!0),function(t,e){return r[t]=i?i(t,e):e}}"object"==typeof w&&"object"==typeof w.exports?t(r(e,r(w.exports))):t(r(e))}(function(t){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};e=function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},r=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},n=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(r[i[n]]=t[i[n]])}return r},s=function(t,e,r,i){var n,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,i);else for(var o=t.length-1;0<=o;o--)(n=t[o])&&(a=(s<3?n(a):3<s?n(e,r,a):n(e,r))||a);return 3<s&&a&&Object.defineProperty(e,r,a),a},a=function(r,i){return function(t,e){i(t,e,r)}},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(s,a,o,u){return new(o||(o=Promise))(function(t,e){function r(t){try{n(u.next(t))}catch(t){e(t)}}function i(t){try{n(u.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new o(function(t){t(e.value)}).then(r,i)}n((u=u.apply(s,a||[])).next())})},c=function(r,i){var n,s,a,t,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,s=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){o.label=e[1];break}if(6===e[0]&&o.label<a[1]){o.label=a[1],a=e;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(e);break}a[2]&&o.ops.pop(),o.trys.pop();continue}e=i.call(r,o)}catch(t){e=[6,t],s=0}finally{n=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},l=function(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])},_=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},h=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var i,n,s=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=s.next()).done;)a.push(i.value)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a},d=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t},p=function(t){return this instanceof p?(this.v=t,this):new p(t)},f=function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(i){s[i]&&(n[i]=function(r){return new Promise(function(t,e){1<a.push([i,r,t,e])||o(i,r)})})}function o(t,e){try{(r=s[t](e)).value instanceof p?Promise.resolve(r.value.v).then(u,c):l(a[0][2],r)}catch(t){l(a[0][3],t)}var r}function u(t){o("next",t)}function c(t){o("throw",t)}function l(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}},m=function(i){var t,n;return t={},e("next"),e("throw",function(t){throw t}),e("return"),t[Symbol.iterator]=function(){return this},t;function e(e,r){t[e]=i[e]?function(t){return(n=!n)?{value:p(i[e](t)),done:"return"===e}:r?r(t):t}:r}},g=function(u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=u[Symbol.asyncIterator];return e?e.call(u):(u=_(u),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=u[o]&&function(a){return new Promise(function(t,e){var r,i,n,s;a=u[o](a),r=t,i=e,n=a.done,s=a.value,Promise.resolve(s).then(function(t){r({value:t,done:n})},i)})}}},v=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},y=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e},b=function(t){return t&&t.__esModule?t:{default:t}},t("__extends",e),t("__assign",r),t("__rest",n),t("__decorate",s),t("__param",a),t("__metadata",o),t("__awaiter",u),t("__generator",c),t("__exportStar",l),t("__values",_),t("__read",h),t("__spread",d),t("__await",p),t("__asyncGenerator",f),t("__asyncDelegator",m),t("__asyncValues",g),t("__makeTemplateObject",v),t("__importStar",y),t("__importDefault",b)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(t,e,r){"use strict";var i,n=t("microevent.ts"),a="resolve_transaction",o="reject_transaction";!function(t){var e;(e=t.MessageType||(t.MessageType={}))[e.signal=0]="signal",e[e.rpc=1]="rpc",e[e.internal=2]="internal";t.MessageType}((i=function(){function s(t,e){void 0===e&&(e=0),this._dispatch=t,this._rpcTimeout=e,this.error=new n.Event,this._rpcHandlers={},this._signalHandlers={},this._pendingTransactions={},this._nextTransactionId=0}return s.prototype.dispatch=function(t){var e=t;switch(e.type){case s.MessageType.signal:return this._handleSignal(e);case s.MessageType.rpc:return this._handeRpc(e);case s.MessageType.internal:return this._handleInternal(e);default:this._raiseError("invalid message type "+e.type)}},s.prototype.rpc=function(t,e,r){var i=this,n=this._nextTransactionId++;return this._dispatch({type:s.MessageType.rpc,transactionId:n,id:t,payload:e},r||void 0),new Promise(function(t,e){var r=i._pendingTransactions[n]={id:n,resolve:t,reject:e};0<i._rpcTimeout&&(i._pendingTransactions[n].timeoutHandle=setTimeout(function(){return i._transactionTimeout(r)},i._rpcTimeout))})},s.prototype.signal=function(t,e,r){return this._dispatch({type:s.MessageType.signal,id:t,payload:e},r||void 0),this},s.prototype.registerRpcHandler=function(t,e){if(this._rpcHandlers[t])throw new Error("rpc handler for "+t+" already registered");return this._rpcHandlers[t]=e,this},s.prototype.registerSignalHandler=function(t,e){return this._signalHandlers[t]||(this._signalHandlers[t]=[]),this._signalHandlers[t].push(e),this},s.prototype.deregisterRpcHandler=function(t,e){return this._rpcHandlers[t]&&delete this._rpcHandlers[t],this},s.prototype.deregisterSignalHandler=function(t,e){return this._signalHandlers[t]&&(this._signalHandlers[t]=this._signalHandlers[t].filter(function(t){return e!==t})),this},s.prototype._raiseError=function(t){this.error.dispatch(new Error(t)),this._dispatch({type:s.MessageType.internal,id:"error",payload:t})},s.prototype._handleSignal=function(e){if(!this._signalHandlers[e.id])return this._raiseError("invalid signal "+e.id);this._signalHandlers[e.id].forEach(function(t){return t(e.payload)})},s.prototype._handeRpc=function(e){var r=this;if(!this._rpcHandlers[e.id])return this._raiseError("invalid rpc "+e.id);Promise.resolve(this._rpcHandlers[e.id](e.payload)).then(function(t){return r._dispatch({type:s.MessageType.internal,id:a,transactionId:e.transactionId,payload:t})},function(t){return r._dispatch({type:s.MessageType.internal,id:o,transactionId:e.transactionId,payload:t})})},s.prototype._handleInternal=function(t){switch(t.id){case a:if(!this._pendingTransactions[t.transactionId])return this._raiseError("no pending transaction with id "+t.transactionId);this._pendingTransactions[t.transactionId].resolve(t.payload),this._clearTransaction(this._pendingTransactions[t.transactionId]);break;case o:if(!this._pendingTransactions[t.transactionId])return this._raiseError("no pending transaction with id "+t.transactionId);this._pendingTransactions[t.transactionId].reject(t.payload),this._clearTransaction(this._pendingTransactions[t.transactionId]);break;case"error":this.error.dispatch(new Error("remote error: "+t.payload));break;default:this._raiseError("unhandled internal message "+t.id)}},s.prototype._transactionTimeout=function(t){t.reject("transaction timed out"),this._raiseError("transaction "+t.id+" timed out"),delete this._pendingTransactions[t.id]},s.prototype._clearTransaction=function(t){void 0!==t.timeoutHandle&&clearTimeout(t.timeoutHandle),delete this._pendingTransactions[t.id]},s}())||(i={})),Object.defineProperty(r,"__esModule",{value:!0}),r.default=i},{"microevent.ts":4}],8:[function(t,e,r){"use strict";var i=t("./RpcProvider");r.RpcProvider=i.default},{"./RpcProvider":7}],9:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("./Instruction"),i=t("./CpuInterface"),o=t("./ops");function n(t,e){t.p=e.readWord(65532)}function s(t,e,r){var i=t.p;t.nmi&&(r=65530),t.nmi=t.irq=!1,e.write(t.s+256,i>>>8&255),t.s=t.s+255&255,e.write(t.s+256,255&i),t.s=t.s+255&255,e.write(t.s+256,-17&t.flags),t.s=t.s+255&255,t.flags|=4,t.p=e.readWord(r)}function u(t,e){s(t,e,65534)}function c(t,e){s(t,e,65530)}r.opBoot=n,r.opIrq=u,r.opNmi=c;var l=function(){function t(t,e){this._bus=t,this._rng=e,this.executionState=0,this.state=new i.default.State,this._opCycles=0,this._instructionCallback=null,this._invalidInstructionCallback=null,this._interruptPending=!1,this._nmiPending=!1,this._interuptCheck=0,this._halted=!1,this._operand=0,this._lastInstructionPointer=0,this._currentAddressingMode=12,this._dereference=!1,this.reset()}return t.prototype.setInterrupt=function(t){return this._interruptPending=t,this},t.prototype.isInterrupt=function(){return this._interruptPending},t.prototype.nmi=function(){return this._nmiPending=!0,this},t.prototype.halt=function(){return this._halted=!0,this},t.prototype.resume=function(){return this._halted=!1,this},t.prototype.isHalt=function(){return this._halted},t.prototype.setInvalidInstructionCallback=function(t){return this._invalidInstructionCallback=t,this},t.prototype.getInvalidInstructionCallback=function(){return this._invalidInstructionCallback},t.prototype.getLastInstructionPointer=function(){return this._lastInstructionPointer},t.prototype.reset=function(){return this.state.a=this._rng?this._rng.int(255):0,this.state.x=this._rng?this._rng.int(255):0,this.state.y=this._rng?this._rng.int(255):0,this.state.s=253,this.state.p=this._rng?this._rng.int(65535):0,this.state.flags=52|(this._rng?this._rng.int(255):0),this.state.irq=!1,this.state.nmi=!1,this.executionState=0,this._opCycles=7,this._interruptPending=!1,this._nmiPending=!1,this._instructionCallback=n,this},t.prototype.cycle=function(){if(this._halted)return this;switch(this.executionState){case 0:case 2:0==--this._opCycles&&(this._dereference&&(this._operand=this._bus.read(this._operand)),1===this._interuptCheck&&this._checkForInterrupts(),this._instructionCallback(this.state,this._bus,this._operand,this._currentAddressingMode),this.executionState=1,0===this._interuptCheck&&this._checkForInterrupts());break;case 1:if(this.state.nmi)return this._instructionCallback=c,this._opCycles=6,this.state.nmi=this.state.irq=!1,this._interuptCheck=1,this.executionState=2,this;if(this.state.irq)return this._instructionCallback=u,this._opCycles=6,this.state.nmi=this.state.irq=!1,this._interuptCheck=1,this.executionState=2,this;this._fetch()}return this},t.prototype._fetch=function(){var t,e,r=a.default.opcodes[this._bus.read(this.state.p)],i=r.addressingMode,n=!1,s=!1;switch(this._lastInstructionPointer=this.state.p,this._currentAddressingMode=i,this._interuptCheck=0,r.operation){case 0:this._opCycles=0,this._instructionCallback=o.opAdc,n=!0;break;case 1:this._opCycles=0,this._instructionCallback=o.opAnd,n=!0;break;case 2:0===i?(this._opCycles=1,this._instructionCallback=o.opAslAcc):(this._opCycles=3,this._instructionCallback=o.opAslMem,s=!0);break;case 3:1&this.state.flags?(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=o.opJmp,this._opCycles=0);break;case 4:1&this.state.flags?(this._instructionCallback=o.opJmp,this._opCycles=0):(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 5:2&this.state.flags?(this._instructionCallback=o.opJmp,this._opCycles=0):(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 6:this._opCycles=0,this._instructionCallback=o.opBit,n=!0;break;case 7:128&this.state.flags?(this._instructionCallback=o.opJmp,this._opCycles=0):(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 8:2&this.state.flags?(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=o.opJmp,this._opCycles=0);break;case 9:128&this.state.flags?(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=o.opJmp,this._opCycles=0);break;case 11:64&this.state.flags?(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=o.opJmp,this._opCycles=0);break;case 12:64&this.state.flags?(this._instructionCallback=o.opJmp,this._opCycles=0):(i=0,this._instructionCallback=o.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 10:this._opCycles=6,this._instructionCallback=o.opBrk,this._interuptCheck=1;break;case 13:this._opCycles=1,this._instructionCallback=o.opClc;break;case 14:this._opCycles=1,this._instructionCallback=o.opCld;break;case 15:this._opCycles=1,this._instructionCallback=o.opCli,this._interuptCheck=1;break;case 16:this._opCycles=1,this._instructionCallback=o.opClv;break;case 17:this._opCycles=0,this._instructionCallback=o.opCmp,n=!0;break;case 18:this._opCycles=0,this._instructionCallback=o.opCpx,n=!0;break;case 19:this._opCycles=0,this._instructionCallback=o.opCpy,n=!0;break;case 20:this._opCycles=3,this._instructionCallback=o.opDec,s=!0;break;case 21:this._opCycles=1,this._instructionCallback=o.opDex;break;case 22:this._opCycles=1,this._instructionCallback=o.opDey;break;case 23:this._opCycles=0,this._instructionCallback=o.opEor,n=!0;break;case 24:this._opCycles=3,this._instructionCallback=o.opInc,s=!0;break;case 25:this._opCycles=1,this._instructionCallback=o.opInx;break;case 26:this._opCycles=1,this._instructionCallback=o.opIny;break;case 27:this._opCycles=0,this._instructionCallback=o.opJmp;break;case 28:this._opCycles=5,this._instructionCallback=o.opJsr;break;case 29:this._opCycles=1===i?0:1,this._instructionCallback=o.opLda;break;case 30:this._opCycles=1===i?0:1,this._instructionCallback=o.opLdx;break;case 31:this._opCycles=1===i?0:1,this._instructionCallback=o.opLdy;break;case 32:0===i?(this._opCycles=1,this._instructionCallback=o.opLsrAcc):(this._opCycles=3,this._instructionCallback=o.opLsrMem,s=!0);break;case 33:this._opCycles=1,this._instructionCallback=o.opNop;break;case 56:case 57:n=!(this._opCycles=0),this._instructionCallback=o.opNop;break;case 34:this._opCycles=0,this._instructionCallback=o.opOra,n=!0;break;case 36:this._opCycles=2,this._instructionCallback=o.opPhp;break;case 35:this._opCycles=2,this._instructionCallback=o.opPha;break;case 37:this._opCycles=3,this._instructionCallback=o.opPla;break;case 38:this._opCycles=3,this._instructionCallback=o.opPlp,this._interuptCheck=1;break;case 39:0===i?(this._opCycles=1,this._instructionCallback=o.opRolAcc):(this._opCycles=3,this._instructionCallback=o.opRolMem,s=!0);break;case 40:0===i?(this._opCycles=1,this._instructionCallback=o.opRorAcc):(this._opCycles=3,this._instructionCallback=o.opRorMem,s=!0);break;case 41:this._opCycles=5,this._instructionCallback=o.opRti;break;case 42:this._opCycles=5,this._instructionCallback=o.opRts;break;case 43:this._opCycles=0,this._instructionCallback=o.opSbc,n=!0;break;case 44:this._opCycles=1,this._instructionCallback=o.opSec;break;case 45:this._opCycles=1,this._instructionCallback=o.opSed;break;case 46:this._opCycles=1,this._instructionCallback=o.opSei,this._interuptCheck=1;break;case 47:this._opCycles=1,this._instructionCallback=o.opSta,s=!0;break;case 48:this._opCycles=1,this._instructionCallback=o.opStx,s=!0;break;case 49:this._opCycles=1,this._instructionCallback=o.opSty,s=!0;break;case 50:this._opCycles=1,this._instructionCallback=o.opTax;break;case 51:this._opCycles=1,this._instructionCallback=o.opTay;break;case 52:this._opCycles=1,this._instructionCallback=o.opTsx;break;case 53:this._opCycles=1,this._instructionCallback=o.opTxa;break;case 54:this._opCycles=1,this._instructionCallback=o.opTxs;break;case 55:this._opCycles=1,this._instructionCallback=o.opTya;break;case 62:this._opCycles=0,this._instructionCallback=o.opArr;break;case 58:this._opCycles=0,this._instructionCallback=o.opAlr;break;case 59:this._opCycles=0,this._instructionCallback=o.opAxs;break;case 60:this._opCycles=3,this._instructionCallback=o.opDcp,s=!0;break;case 61:this._opCycles=0,this._instructionCallback=o.opLax,n=!0;break;case 63:this._opCycles=3,this._instructionCallback=o.opSlo,n=!(s=!0);break;case 64:this._opCycles=1,this._instructionCallback=o.opAax;break;case 65:this._opCycles=0,this._instructionCallback=o.opLar,n=!0;break;case 66:this._opCycles=3,this._instructionCallback=o.opIsc,s=!0;break;case 67:this._opCycles=0,this._instructionCallback=o.opAac;break;case 68:this._opCycles=0,this._instructionCallback=o.opAtx;break;case 69:s=!(n=!(this._opCycles=3)),this._instructionCallback=o.opRra;break;case 70:s=!(n=!(this._opCycles=3)),this._instructionCallback=o.opRla;break;default:return void(this._invalidInstructionCallback&&this._invalidInstructionCallback(this))}switch(this.state.p=this.state.p+1&65535,i){case 1:this._operand=this._bus.read(this.state.p),n=!1,this.state.p=this.state.p+1&65535,this._opCycles++;break;case 2:this._operand=this._bus.read(this.state.p),this.state.p=this.state.p+1&65535,this._opCycles++;break;case 3:this._operand=this._bus.readWord(this.state.p),this.state.p=this.state.p+2&65535,this._opCycles+=2;break;case 4:t=this._bus.readWord(this.state.p),this._operand=255==(255&t)?this._bus.read(t)+(this._bus.read(65280&t)<<8):this._bus.readWord(t),this.state.p=this.state.p+2&65535,this._opCycles+=4;break;case 5:t=128&(t=this._bus.read(this.state.p))?-(255&~(t-1)):t,this._operand=this.state.p+t+65537&65535,this.state.p=this.state.p+1&65535,this._opCycles+=(65280&this._operand)!=(65280&this.state.p)?3:2;break;case 6:e=this._bus.read(this.state.p),this._bus.read(e),this._operand=e+this.state.x&255,this.state.p=this.state.p+1&65535,this._opCycles+=2;break;case 7:t=this._bus.readWord(this.state.p),this._operand=t+this.state.x&65535,(65280&this._operand)!=(65280&t)&&this._bus.read(65280&t|255&this._operand),this._opCycles+=s||(65280&this._operand)!=(65280&t)?3:2,this.state.p=this.state.p+2&65535;break;case 9:e=this._bus.read(this.state.p),this._bus.read(e),this._operand=e+this.state.y&255,this.state.p=this.state.p+1&65535,this._opCycles+=2;break;case 10:t=this._bus.readWord(this.state.p),this._operand=t+this.state.y&65535,(65280&this._operand)!=(65280&t)&&this._bus.read(65280&t|255&this._operand),this._opCycles+=s||(65280&this._operand)!=(65280&t)?3:2,this.state.p=this.state.p+2&65535;break;case 8:e=this._bus.read(this.state.p),this._bus.read(e),t=e+this.state.x&255,this._operand=255===t?this._bus.read(255)+(this._bus.read(0)<<8):this._bus.readWord(t),this._opCycles+=4,this.state.p=this.state.p+1&65535;break;case 11:t=255===(t=this._bus.read(this.state.p))?this._bus.read(255)+(this._bus.read(0)<<8):this._bus.readWord(t),this._operand=t+this.state.y&65535,(65280&this._operand)!=(65280&t)&&this._bus.read(65280&t|255&this._operand),this._opCycles+=s||(65280&t)!=(65280&this._operand)?4:3,this.state.p=this.state.p+1&65535}(this._dereference=n)&&this._opCycles++,this.executionState=2},t.prototype._checkForInterrupts=function(){this._nmiPending&&(this.state.irq=!1,this.state.nmi=!0,this._nmiPending=!1),!this._interruptPending||this.state.nmi||4&this.state.flags||(this.state.irq=!0)},t}();r.default=l},{"./CpuInterface":10,"./Instruction":12,"./ops":14}],10:[function(t,e,r){"use strict";var i,n;Object.defineProperty(r,"__esModule",{value:!0}),n=function(){this.a=0,this.x=0,this.y=0,this.s=0,this.p=0,this.flags=0,this.irq=!1,this.nmi=!1},(i||(i={})).State=n,r.default=i},{}],11:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n,s=t("./StateMachineCpu"),a=t("./BatchedAccessCpu"),o=function(){function r(t){this._type=t}return r.prototype.create=function(t,e){switch(this._type){case r.Type.stateMachine:return new s.default(t,e);case r.Type.batchedAccess:return new a.default(t,e);default:throw new Error("invalid CPU type")}},r}();i=o||(o={}),(n=i.Type||(i.Type={}))[n.stateMachine=0]="stateMachine",n[n.batchedAccess=1]="batchedAccess",r.default=o},{"./BatchedAccessCpu":9,"./StateMachineCpu":13}],12:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n,o,s=function(){function t(t,e,r){void 0===r&&(r=e),this.operation=t,this.addressingMode=e,this.effectiveAddressingMode=r}return t.prototype.getSize=function(){switch(this.effectiveAddressingMode){case 1:case 2:case 6:case 9:case 8:case 11:case 5:return 2;case 3:case 7:case 10:case 4:return 3;default:return 1}},t}();r.default=s,i=s||(s={}),(n=i.OperationMap||(i.OperationMap={}))[n.adc=0]="adc",n[n.and=1]="and",n[n.asl=2]="asl",n[n.bcc=3]="bcc",n[n.bcs=4]="bcs",n[n.beq=5]="beq",n[n.bit=6]="bit",n[n.bmi=7]="bmi",n[n.bne=8]="bne",n[n.bpl=9]="bpl",n[n.brk=10]="brk",n[n.bvc=11]="bvc",n[n.bvs=12]="bvs",n[n.clc=13]="clc",n[n.cld=14]="cld",n[n.cli=15]="cli",n[n.clv=16]="clv",n[n.cmp=17]="cmp",n[n.cpx=18]="cpx",n[n.cpy=19]="cpy",n[n.dec=20]="dec",n[n.dex=21]="dex",n[n.dey=22]="dey",n[n.eor=23]="eor",n[n.inc=24]="inc",n[n.inx=25]="inx",n[n.iny=26]="iny",n[n.jmp=27]="jmp",n[n.jsr=28]="jsr",n[n.lda=29]="lda",n[n.ldx=30]="ldx",n[n.ldy=31]="ldy",n[n.lsr=32]="lsr",n[n.nop=33]="nop",n[n.ora=34]="ora",n[n.pha=35]="pha",n[n.php=36]="php",n[n.pla=37]="pla",n[n.plp=38]="plp",n[n.rol=39]="rol",n[n.ror=40]="ror",n[n.rti=41]="rti",n[n.rts=42]="rts",n[n.sbc=43]="sbc",n[n.sec=44]="sec",n[n.sed=45]="sed",n[n.sei=46]="sei",n[n.sta=47]="sta",n[n.stx=48]="stx",n[n.sty=49]="sty",n[n.tax=50]="tax",n[n.tay=51]="tay",n[n.tsx=52]="tsx",n[n.txa=53]="txa",n[n.txs=54]="txs",n[n.tya=55]="tya",n[n.dop=56]="dop",n[n.top=57]="top",n[n.alr=58]="alr",n[n.axs=59]="axs",n[n.dcp=60]="dcp",n[n.lax=61]="lax",n[n.arr=62]="arr",n[n.slo=63]="slo",n[n.aax=64]="aax",n[n.lar=65]="lar",n[n.isc=66]="isc",n[n.aac=67]="aac",n[n.atx=68]="atx",n[n.rra=69]="rra",n[n.rla=70]="rla",n[n.invalid=71]="invalid",i.opcodes=new Array(256),r.default=s,function(t){for(var e=0;e<256;e++)o.opcodes[e]=new o(71,12);var r,i,n;for(e=0;e<8;e++){switch(e){case 0:r=34;break;case 1:r=1;break;case 2:r=23;break;case 3:r=0;break;case 4:r=47;break;case 5:r=29;break;case 6:r=17;break;case 7:r=43}for(var s=0;s<8;s++){switch(s){case 0:i=8;break;case 1:i=2;break;case 2:i=1;break;case 3:i=3;break;case 4:i=11;break;case 5:i=6;break;case 6:i=10;break;case 7:i=7}47===r&&1===i&&(i=12),71!==r&&12!==i&&(n=e<<5|s<<2|1,o.opcodes[n]=new o(r,i))}}function a(t,e,r,i){if(71!==o.opcodes[t].operation)throw new Error("entry for opcode "+t+" already exists");o.opcodes[t]=new o(e,r,i)}a(6,2,2),a(10,2,0),a(14,2,3),a(22,2,6),a(30,2,7),a(38,39,2),a(42,39,0),a(46,39,3),a(54,39,6),a(62,39,7),a(70,32,2),a(74,32,0),a(78,32,3),a(86,32,6),a(94,32,7),a(102,40,2),a(106,40,0),a(110,40,3),a(118,40,6),a(126,40,7),a(134,48,2),a(142,48,3),a(150,48,9),a(162,30,1),a(166,30,2),a(174,30,3),a(182,30,9),a(190,30,10),a(198,20,2),a(206,20,3),a(214,20,6),a(222,20,7),a(230,24,2),a(238,24,3),a(246,24,6),a(254,24,7),a(36,6,2),a(44,6,3),a(76,27,3),a(108,27,4),a(132,49,2),a(140,49,3),a(148,49,6),a(160,31,1),a(164,31,2),a(172,31,3),a(180,31,6),a(188,31,7),a(192,19,1),a(196,19,2),a(204,19,3),a(224,18,1),a(228,18,2),a(236,18,3),a(16,9,5),a(48,7,5),a(80,11,5),a(112,12,5),a(144,3,5),a(176,4,5),a(208,8,5),a(240,5,5),a(0,10,0),a(32,28,0,3),a(64,41,0),a(96,42,0),a(8,36,0),a(40,38,0),a(72,35,0),a(104,37,0),a(136,22,0),a(168,51,0),a(200,26,0),a(232,25,0),a(24,13,0),a(56,44,0),a(88,15,0),a(120,46,0),a(152,55,0),a(184,16,0),a(216,14,0),a(248,45,0),a(138,53,0),a(154,54,0),a(170,50,0),a(186,52,0),a(202,21,0),a(234,33,0),a(26,33,0),a(58,33,0),a(90,33,0),a(122,33,0),a(218,33,0),a(250,33,0),a(4,56,2),a(20,56,6),a(52,56,6),a(68,56,2),a(84,56,6),a(100,56,2),a(116,56,6),a(128,56,1),a(130,56,1),a(137,56,1),a(194,56,1),a(212,56,6),a(226,56,1),a(244,56,6),a(12,57,3),a(28,57,7),a(60,57,7),a(92,57,7),a(124,57,7),a(220,57,7),a(252,57,7),a(235,43,1),a(75,58,1),a(203,59,1),a(199,60,2),a(215,60,6),a(207,60,3),a(223,60,7),a(219,60,10),a(195,60,8),a(211,60,11),a(167,61,2),a(183,61,9),a(175,61,3),a(191,61,10),a(163,61,8),a(179,61,11),a(107,62,1),a(7,63,2),a(23,63,6),a(15,63,3),a(31,63,7),a(27,63,10),a(3,63,8),a(19,63,11),a(135,64,2),a(151,64,9),a(131,64,8),a(143,64,3),a(187,65,10),a(231,66,2),a(247,66,6),a(239,66,3),a(255,66,7),a(251,66,10),a(227,66,8),a(243,66,11),a(11,67,1),a(43,67,1),a(171,68,1),a(103,69,2),a(119,69,6),a(111,69,3),a(127,69,7),a(123,69,10),a(99,69,8),a(115,69,11),a(39,70,2),a(55,70,6),a(47,70,3),a(63,70,7),a(59,70,10),a(35,70,8),a(51,70,11)}((o=s||(s={})).__init||(o.__init={})),r.default=s},{}],13:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./CpuInterface"),s=t("./statemachine/vector"),a=t("./statemachine/Compiler"),i=function(){function t(t,e){this._bus=t,this._rng=e,this.executionState=0,this.state=new n.default.State,this._invalidInstructionCallback=null,this._interruptPending=!1,this._nmiPending=!1,this._halt=!1,this._pollInterruptsAfterLastInstruction=!1,this._lastInstructionPointer=0,this._operations=new Array(255),this._opBoot=s.boot(this.state),this._opIrq=s.irq(this.state),this._opNmi=s.nmi(this.state);for(var r=new a.default(this.state),i=0;i<256;i++)this._operations[i]=r.compile(i);this.reset()}return t.prototype.reset=function(){return this.state.a=this._rng?this._rng.int(255):0,this.state.x=this._rng?this._rng.int(255):0,this.state.y=this._rng?this._rng.int(255):0,this.state.s=253,this.state.p=this._rng?this._rng.int(65535):0,this.state.flags=52|(this._rng?this._rng.int(255):0),this.state.irq=!1,this.state.nmi=!1,this.executionState=0,this._interruptPending=!1,this._nmiPending=!1,this._halt=!1,this._lastResult=this._opBoot.reset(void 0),this._lastInstructionPointer=0,this},t.prototype.setInterrupt=function(t){return this._interruptPending=t,this},t.prototype.isInterrupt=function(){return this._interruptPending},t.prototype.nmi=function(){return this._nmiPending=!0,this},t.prototype.halt=function(){return this._halt=!0,this},t.prototype.resume=function(){return this._halt=!1,this},t.prototype.isHalt=function(){return this._halt},t.prototype.setInvalidInstructionCallback=function(t){return this._invalidInstructionCallback=t,this},t.prototype.getInvalidInstructionCallback=function(){return this._invalidInstructionCallback},t.prototype.getLastInstructionPointer=function(){return this._lastInstructionPointer},t.prototype.cycle=function(){if(this._halt&&(!this._lastResult||0===this._lastResult.cycleType))return this;if(1===this.executionState)return this._fetch(),this;var t;switch(this._lastResult.cycleType){case 0:t=this._bus.read(this._lastResult.address);break;case 1:t=this._lastResult.value,this._bus.write(this._lastResult.address,t);break;default:throw new Error("invalid cycle type")}return this._lastResult.pollInterrupts&&(this._pollInterrupts(),this._lastResult.pollInterrupts=!1,this._pollInterruptsAfterLastInstruction=!1),this._lastResult=this._lastResult.nextStep(t),null===this._lastResult&&(this.executionState=1),this},t.prototype._fetch=function(){var t;this._pollInterruptsAfterLastInstruction&&this._pollInterrupts(),this._lastInstructionPointer=this.state.p;var e=this._bus.read(this.state.p);this.state.nmi?(t=this._opNmi,this._pollInterruptsAfterLastInstruction=!1):this.state.irq?(t=this._opIrq,this._pollInterruptsAfterLastInstruction=!1):(t=this._operations[e],this.state.p=this.state.p+1&65535,this._pollInterruptsAfterLastInstruction=!0),t?(this.executionState=2,this._lastResult=t.reset(void 0)):this._invalidInstructionCallback&&this._invalidInstructionCallback(this)},t.prototype._pollInterrupts=function(){if(this.state.irq=!1,this._nmiPending)return this.state.nmi=!0,void(this._nmiPending=!1);!this._interruptPending||this.state.nmi||4&this.state.flags||(this.state.irq=!0)},t}();r.default=i},{"./CpuInterface":10,"./statemachine/Compiler":15,"./statemachine/vector":39}],14:[function(t,e,r){"use strict";function i(t,e){t.s=t.s+1&255,t.flags=-17&(32|e.read(256+t.s))}function n(t,e){t.flags=-131&t.flags|128&e|(e?0:2)}function s(t,e,r){if(8&t.flags){var i=(15&r)+(15&t.a)+(1&t.flags),n=(r>>>4)+(t.a>>>4)+(9<i?1:0);t.a=i%10|n%10<<4,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|(9<n?1:0)}else{var s=t.a+r+(1&t.flags),a=255&s;t.flags=-196&t.flags|128&a|(a?0:2)|s>>>8|(~(r^t.a)&(a^r)&128)>>>1,t.a=a}}function a(t,e,r){t.a&=r,n(t,t.a)}function o(t,e,r){if(8&t.flags){var i=(15&t.a)-(15&r)-(1&~t.flags),n=(t.a>>>4)-(r>>>4)-(i<0?1:0);t.a=(i<0?10+i:i)|(n<0?10+n:n)<<4,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|(n<0?0:1)}else{r=255&~r;var s=t.a+r+(1&t.flags),a=255&s;t.flags=-196&t.flags|128&a|(a?0:2)|s>>>8|(~(r^t.a)&(a^r)&128)>>>1,t.a=a}}Object.defineProperty(r,"__esModule",{value:!0}),r.opAdc=s,r.opAnd=a,r.opAslAcc=function(t){var e=t.a;t.a=t.a<<1&255,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},r.opAslMem=function(t,e,r){var i=e.read(r),n=i<<1&255;e.write(r,n),t.flags=-132&t.flags|128&n|(n?0:2)|i>>>7},r.opBit=function(t,e,r){t.flags=-195&t.flags|192&r|(r&t.a?0:2)},r.opBrk=function(t,e){var r=t.p+1&65535,i=65534;t.nmi&&(i=65530,t.nmi=!1),t.nmi=t.irq=!1,e.write(t.s+256,r>>>8&255),t.s=t.s+255&255,e.write(t.s+256,255&r),t.s=t.s+255&255,e.write(t.s+256,16|t.flags),t.s=t.s+255&255,t.flags|=4,t.p=e.readWord(i)},r.opClc=function(t){t.flags&=-2},r.opCld=function(t){t.flags&=-9},r.opCli=function(t){t.flags&=-5},r.opClv=function(t){t.flags&=-65},r.opCmp=function(t,e,r){var i=t.a+(255&~r)+1;t.flags=-132&t.flags|128&i|(255&i?0:2)|i>>>8},r.opCpx=function(t,e,r){var i=t.x+(255&~r)+1;t.flags=-132&t.flags|128&i|(255&i?0:2)|i>>>8},r.opCpy=function(t,e,r){var i=t.y+(255&~r)+1;t.flags=-132&t.flags|128&i|(255&i?0:2)|i>>>8},r.opDec=function(t,e,r){var i=e.read(r)+255&255;e.write(r,i),n(t,i)},r.opDex=function(t){t.x=t.x+255&255,n(t,t.x)},r.opEor=function(t,e,r){t.a=t.a^r,n(t,t.a)},r.opDey=function(t){t.y=t.y+255&255,n(t,t.y)},r.opInc=function(t,e,r){var i=e.read(r)+1&255;e.write(r,i),n(t,i)},r.opInx=function(t){t.x=t.x+1&255,n(t,t.x)},r.opIny=function(t){t.y=t.y+1&255,n(t,t.y)},r.opJmp=function(t,e,r){t.p=r},r.opJsr=function(t,e,r){var i=t.p+1&65535,n=e.read(t.p);e.read(256+t.s),e.write(256+t.s,i>>>8),t.s=t.s+255&255,e.write(256+t.s,255&i),t.s=t.s+255&255,t.p=n|e.read(t.p+1&65535)<<8},r.opLda=function(t,e,r,i){t.a=1===i?r:e.read(r),n(t,t.a)},r.opLdx=function(t,e,r,i){t.x=1===i?r:e.read(r),n(t,t.x)},r.opLdy=function(t,e,r,i){t.y=1===i?r:e.read(r),n(t,t.y)},r.opLsrAcc=function(t){var e=t.a;t.a=t.a>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},r.opLsrMem=function(t,e,r){var i=e.read(r),n=i>>>1;e.write(r,n),t.flags=-132&t.flags|128&n|(n?0:2)|1&i},r.opNop=function(){},r.opOra=function(t,e,r){t.a|=r,n(t,t.a)},r.opPhp=function(t,e){e.write(256+t.s,16|t.flags),t.s=t.s+255&255},r.opPlp=function(t,e){i(t,e)},r.opPha=function(t,e){e.write(256+t.s,t.a),t.s=t.s+255&255},r.opPla=function(t,e){t.s=t.s+1&255,t.a=e.read(256+t.s),n(t,t.a)},r.opRolAcc=function(t){var e=t.a;t.a=t.a<<1&255|1&t.flags,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},r.opRolMem=function(t,e,r){var i=e.read(r),n=i<<1&255|1&t.flags;e.write(r,n),t.flags=-132&t.flags|128&n|(n?0:2)|i>>>7},r.opRorAcc=function(t){var e=t.a;t.a=t.a>>>1|(1&t.flags)<<7,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},r.opRorMem=function(t,e,r){var i=e.read(r),n=i>>>1|(1&t.flags)<<7;e.write(r,n),t.flags=-132&t.flags|128&n|(n?0:2)|1&i},r.opRti=function(t,e){var r;i(t,e),t.s=t.s+1&255,r=e.read(256+t.s),t.s=t.s+1&255,r|=e.read(256+t.s)<<8,t.p=r},r.opRts=function(t,e){var r;e.read(256+t.s),t.s=t.s+1&255,r=e.read(256+t.s),t.s=t.s+1&255,r+=e.read(256+t.s)<<8,t.p=r+1&65535},r.opSbc=o,r.opSec=function(t){t.flags|=1},r.opSed=function(t){t.flags|=8},r.opSei=function(t){t.flags|=4},r.opSta=function(t,e,r){e.write(r,t.a)},r.opStx=function(t,e,r){e.write(r,t.x)},r.opSty=function(t,e,r){e.write(r,t.y)},r.opTax=function(t){t.x=t.a,n(t,t.a)},r.opTay=function(t){t.y=t.a,n(t,t.a)},r.opTsx=function(t){t.x=t.s,n(t,t.x)},r.opTxa=function(t){t.a=t.x,n(t,t.a)},r.opTxs=function(t){t.s=t.x},r.opTya=function(t){t.a=t.y,n(t,t.a)},r.opAlr=function(t,e,r){var i=t.a&r;t.a=i>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&i},r.opAxs=function(t,e,r){var i=(t.a&t.x)+(255&~r)+1;t.x=255&i,t.flags=-132&t.flags|128&t.x|(255&t.x?0:2)|i>>>8},r.opDcp=function(t,e,r){var i=e.read(r)+255&255;e.write(r,i);var n=t.a+(255&~i)+1;t.flags=-132&t.flags|128&n|(255&n?0:2)|n>>>8},r.opLax=function(t,e,r){t.a=r,t.x=r,n(t,r)},r.opArr=function(t,e,r){t.a=(t.a&r)>>>1|(1&t.flags?128:0),t.flags=-196&t.flags|(64&t.a)>>>6|(t.a?0:2)|128&t.a|64&t.a^(32&t.a)<<1},r.opSlo=function(t,e,r){var i=e.read(r);t.flags=-2&t.flags|i>>>7,i=i<<1&255,e.write(r,i),t.a=t.a|i,n(t,t.a)},r.opAax=function(t,e,r){var i=t.x&t.a;e.write(r,i),n(t,i)},r.opLar=function(t,e,r){t.s=t.a=t.x=t.s&r,n(t,t.a)},r.opIsc=function(t,e,r){var i=e.read(r)+1&255;e.write(r,i),o(t,0,i)},r.opAac=function(t,e,r){t.a&=r,n(t,t.a),t.flags=-2&t.flags|(128&t.a)>>>7},r.opAtx=function(t,e,r){t.a&=r,t.x=t.a,n(t,t.a)},r.opRra=function(t,e,r){var i=e.read(r),n=i>>>1|(1&t.flags)<<7;e.write(r,n),t.flags=-2&t.flags|1&i,s(t,0,n)},r.opRla=function(t,e,r){var i=e.read(r),n=i<<1&255|1&t.flags;e.write(r,n),t.flags=-2&t.flags|i>>>7,a(t,0,n)}},{}],15:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../Instruction"),u=t("./addressing"),n=t("./instruction"),s=t("./ops"),c=t("./addressing/indirect"),a=t("./vector"),o=function(){function t(t){this._state=t}return t.prototype.compile=function(t){var e=i.default.opcodes[t];switch(e.operation){case 0:return this._createAddressing(e.addressingMode,s.adc,{deref:!0});case 1:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.a=e.a&t})},{deref:!0});case 2:return 0===e.addressingMode?n.nullaryOneCycle(this._state,s.aslImmediate):this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.aslRmw).reset,{writeOp:!0});case 6:return this._createAddressing(e.addressingMode,s.bit,{deref:!0});case 10:return a.brk(this._state);case 17:return this._createAddressing(e.addressingMode,function(t,e){return s.cmp(t,e,function(t){return t.a}),null},{deref:!0});case 18:return this._createAddressing(e.addressingMode,function(t,e){return s.cmp(t,e,function(t){return t.x}),null},{deref:!0});case 19:return this._createAddressing(e.addressingMode,function(t,e){return s.cmp(t,e,function(t){return t.y}),null},{deref:!0});case 20:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,function(t,e){return s.genRmw(t,e,function(t){return t-1&255})}).reset,{writeOp:!0});case 21:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.x=t.x-1&255})});case 22:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.y=t.y-1&255})});case 24:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,function(t,e){return s.genRmw(t,e,function(t){return t+1&255})}).reset,{writeOp:!0});case 25:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.x=t.x+1&255})});case 26:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.y=t.y+1&255})});case 23:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.a=e.a^t})},{deref:!0});case 27:return this._createAddressing(e.addressingMode,function(t,e){return e.p=t,null});case 28:return n.jsr(this._state);case 29:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.a=t})},{deref:!0});case 30:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.x=t})},{deref:!0});case 31:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.y=t})},{deref:!0});case 32:return 0===e.addressingMode?n.nullaryOneCycle(this._state,s.lsrImmediate):this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.lsrRmw).reset,{writeOp:!0});case 33:return n.nullaryOneCycle(this._state,function(){});case 34:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.a|=t})},{deref:!0});case 35:return n.push(this._state,function(t){return t.a});case 36:return n.push(this._state,function(t){return 16|t.flags});case 37:return n.pull(this._state,function(t,e){return s.genNullary(t,function(t){return t.a=e})});case 38:return n.pull(this._state,function(t,e){return t.flags=-17&(32|e)});case 39:return 0===e.addressingMode?n.nullaryOneCycle(this._state,s.rolImmediate):this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.rolRmw).reset,{writeOp:!0});case 40:return 0===e.addressingMode?n.nullaryOneCycle(this._state,s.rorImmediate):this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.rorRmw).reset,{writeOp:!0});case 41:return n.rti(this._state);case 42:return n.rts(this._state);case 43:return this._createAddressing(e.addressingMode,s.sbc,{deref:!0});case 48:return this._createAddressing(e.addressingMode,n.write(this._state,function(t){return t.x}).reset,{writeOp:!0});case 49:return this._createAddressing(e.addressingMode,n.write(this._state,function(t){return t.y}).reset,{writeOp:!0});case 50:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.x=t.a})});case 51:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.y=t.a})});case 52:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.x=t.s})});case 53:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.a=t.x})});case 54:return n.nullaryOneCycle(this._state,function(t){return t.s=t.x});case 55:return n.nullaryOneCycle(this._state,function(t){return s.genNullary(t,function(t){return t.a=t.y})});case 3:return n.branch(this._state,function(t){return 0==(1&t)});case 4:return n.branch(this._state,function(t){return 0<(1&t)});case 8:return n.branch(this._state,function(t){return 0==(2&t)});case 5:return n.branch(this._state,function(t){return 0<(2&t)});case 9:return n.branch(this._state,function(t){return 0==(128&t)});case 7:return n.branch(this._state,function(t){return 0<(128&t)});case 11:return n.branch(this._state,function(t){return 0==(64&t)});case 12:return n.branch(this._state,function(t){return 0<(64&t)});case 44:return n.nullaryOneCycle(this._state,function(t){return t.flags|=1});case 45:return n.nullaryOneCycle(this._state,function(t){return t.flags|=8});case 46:return n.nullaryOneCycle(this._state,function(t){return t.flags|=4});case 47:return this._createAddressing(e.addressingMode,n.write(this._state,function(t){return t.a}).reset,{writeOp:!0});case 13:return n.nullaryOneCycle(this._state,function(t){return t.flags&=-2});case 14:return n.nullaryOneCycle(this._state,function(t){return t.flags&=-9});case 15:return n.nullaryOneCycle(this._state,function(t){return t.flags&=-5});case 16:return n.nullaryOneCycle(this._state,function(t){return t.flags&=-65});case 56:case 57:return this._createAddressing(e.addressingMode,function(){return null},{deref:!0});case 67:return this._createAddressing(e.addressingMode,s.aac);case 64:return this._createAddressing(e.addressingMode,n.write(this._state,s.aax).reset,{writeOp:!0});case 58:return this._createAddressing(e.addressingMode,s.alr,{deref:!0});case 62:return this._createAddressing(e.addressingMode,function(t,e){return s.arr(t,e),null},{deref:!0});case 59:return this._createAddressing(e.addressingMode,s.axs,{deref:!0});case 68:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.x=e.a=e.a&t})},{deref:!0});case 60:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.dcp).reset,{writeOp:!0});case 66:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.isc).reset,{writeOp:!0});case 61:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.a=e.x=t})},{deref:!0});case 65:return this._createAddressing(e.addressingMode,function(t,e){return s.genUnary(t,e,function(t,e){return e.s=e.x=e.a=e.s&t})},{deref:!0});case 70:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.rla).reset,{writeOp:!0});case 69:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.rra).reset,{writeOp:!0});case 63:return this._createAddressing(e.addressingMode,n.readModifyWrite(this._state,s.slo).reset,{writeOp:!0});default:return null}},t.prototype._createAddressing=function(t,e,r){var i=void 0===r?{}:r,n=i.deref,s=void 0!==n&&n,a=i.writeOp,o=void 0!==a&&a;switch(s&&1!==t&&(e=u.dereference(this._state,e).reset),t){case 1:return u.immediate(this._state,e);case 2:return u.zeroPage(this._state,e);case 3:return u.absolute(this._state,e);case 6:return u.zeroPageX(this._state,e);case 9:return u.zeroPageY(this._state,e);case 7:return u.absoluteX(this._state,e,o);case 10:return u.absoluteY(this._state,e,o);case 8:return u.indexedIndirectX(this._state,e);case 11:return u.indirectIndexedY(this._state,e,o);case 4:return c.indirect(this._state,e);default:throw new Error("invalid addressing mode "+t)}},t}();r.default=o},{"../Instruction":12,"./addressing":21,"./addressing/indirect":23,"./instruction":28,"./ops":37,"./vector":39}],16:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(){this.cycleType=0,this.address=0,this.value=0,this.pollInterrupts=!1,this.nextStep=null}return t.prototype.read=function(t,e){return this.cycleType=0,this.address=e,this.nextStep=t,this},t.prototype.write=function(t,e,r){return this.cycleType=1,this.address=e,this.value=r,this.nextStep=t,this},t.prototype.poll=function(t){return this.pollInterrupts=t,this},t}();r.default=i},{}],17:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(){return r._result.read(r._fetchLo,r._state.p)},this._fetchLo=function(t){return r._operand=t,r._state.p=r._state.p+1&65535,r._result.read(r._fetchHi,r._state.p)},this._fetchHi=function(t){return r._operand|=t<<8,r._state.p=r._state.p+1&65535,r._next(r._operand,r._state)},this._operand=0,this._result=new n.default,this._state=t,this._next=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchLo",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchHi",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.absolute=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],18:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("tslib"),s=t("../ResultImpl"),a=t("../../../../tools/decorators"),i=function(){function i(t,e,r,i){void 0===r&&(r=function(){return null}),void 0===i&&(i=!1);var n=this;this.reset=function(){return n._result.read(n._fetchLo,n._state.p)},this._fetchLo=function(t){return n._operand=t,n._state.p=n._state.p+1&65535,n._result.read(n._fetchHi,n._state.p)},this._fetchHi=function(t){n._operand|=t<<8,n._state.p=n._state.p+1&65535;var e=n._indexExtractor(n._state);return n._carry=255<(255&n._operand)+e,n._operand=65280&n._operand|n._operand+e&255,n._carry||n._writeOp?n._result.read(n._dereferenceAndCarry,n._operand):n._next(n._operand,n._state)},this._dereferenceAndCarry=function(t){return n._carry&&(n._operand=n._operand+256&65535),n._next(n._operand,n._state)},this._operand=0,this._carry=!1,this._result=new s.default,this._state=t,this._indexExtractor=e,this._next=r,this._writeOp=i,a.freezeImmutables(this)}return i.absoluteX=function(t,e,r){return new i(t,function(t){return t.x},e,r)},i.absoluteY=function(t,e,r){return new i(t,function(t){return t.y},e,r)},n.__decorate([a.Immutable],i.prototype,"reset",void 0),n.__decorate([a.Immutable],i.prototype,"_fetchLo",void 0),n.__decorate([a.Immutable],i.prototype,"_fetchHi",void 0),n.__decorate([a.Immutable],i.prototype,"_dereferenceAndCarry",void 0),n.__decorate([a.Immutable],i.prototype,"_result",void 0),n.__decorate([a.Immutable],i.prototype,"_state",void 0),n.__decorate([a.Immutable],i.prototype,"_indexExtractor",void 0),n.__decorate([a.Immutable],i.prototype,"_next",void 0),n.__decorate([a.Immutable],i.prototype,"_writeOp",void 0),n.__decorate([a.Immutable],i,"absoluteX",null),n.__decorate([a.Immutable],i,"absoluteY",null),i}();r.absoluteX=function(t,e,r){return i.absoluteX(t,e,r)},r.absoluteY=function(t,e,r){return i.absoluteY(t,e,r)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],19:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(t){return r._result.read(r._dereference,t)},this._dereference=function(t){return r._next(t,r._state)},this._result=new n.default,this._next=e,this._state=t,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_dereference",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.dereference=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],20:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(){return r._result.read(r._fetchOperand,r._state.p)},this._fetchOperand=function(t){return r._operand=t,r._state.p=r._state.p+1&65535,r._next(r._operand,r._state)},this._operand=0,this._result=new n.default,this._state=t,this._next=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchOperand",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.immediate=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],21:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./absolute");r.absolute=i.absolute;var n=t("./absoluteIndexed");r.absoluteX=n.absoluteX,r.absoluteY=n.absoluteY;var s=t("./dereference");r.dereference=s.dereference;var a=t("./immediate");r.immediate=a.immediate;var o=t("./indexedIndirectX");r.indexedIndirectX=o.indexedIndirectX;var u=t("./indirectIndexedY");r.indirectIndexedY=u.indirectIndexedY;var c=t("./zeroPage");r.zeroPage=c.zeroPage;var l=t("./zeroPageIndexed");r.zeroPageX=l.zeroPageX,r.zeroPageY=l.zeroPageY},{"./absolute":17,"./absoluteIndexed":18,"./dereference":19,"./immediate":20,"./indexedIndirectX":22,"./indirectIndexedY":24,"./zeroPage":25,"./zeroPageIndexed":26}],22:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(){return r._result.read(r._fetchAddress,r._state.p)},this._fetchAddress=function(t){return r._address=t,r._state.p=r._state.p+1&65535,r._result.read(r._addIndex,r._address)},this._addIndex=function(t){return r._address=r._address+r._state.x&255,r._result.read(r._fetchLo,r._address)},this._fetchLo=function(t){return r._operand=t,r._address=r._address+1&255,r._result.read(r._fetchHi,r._address)},this._fetchHi=function(t){return r._operand|=t<<8,r._next(r._operand,r._state)},this._operand=0,this._address=0,this._result=new n.default,this._state=t,this._next=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchAddress",void 0),i.__decorate([s.Immutable],t.prototype,"_addIndex",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchLo",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchHi",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.indexedIndirectX=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],23:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(){return r._result.read(r._fetchAddressLo,r._state.p)},this._fetchAddressLo=function(t){return r._address=t,r._state.p=r._state.p+1&65535,r._result.read(r._fetchAddressHi,r._state.p)},this._fetchAddressHi=function(t){return r._address|=t<<8,r._state.p=r._state.p+1&65535,r._result.read(r._fetchLo,r._address)},this._fetchLo=function(t){return r._operand=t,255==(255&r._address)?r._address&=65280:r._address=r._address+1&65535,r._result.read(r._fetchHi,r._address)},this._fetchHi=function(t){return r._operand|=t<<8,r._next(r._operand,r._state)},this._operand=0,this._address=0,this._result=new n.default,this._state=t,this._next=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchAddressLo",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchAddressHi",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchLo",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchHi",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.indirect=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],24:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e,r){void 0===e&&(e=function(){return null});var i=this;this.reset=function(){return i._result.read(i._fetchAddress,i._state.p)},this._fetchAddress=function(t){return i._address=t,i._state.p=i._state.p+1&65535,i._result.read(i._fetchLo,i._address)},this._fetchLo=function(t){return i._operand=t,i._address=i._address+1&255,i._result.read(i._fetchHi,i._address)},this._fetchHi=function(t){return i._operand|=t<<8,i._carry=255<(255&i._operand)+i._state.y,i._operand=65280&i._operand|i._operand+i._state.y&255,i._carry||i._writeOp?i._result.read(i._dereferenceAndCarry,i._operand):i._next(i._operand,i._state)},this._dereferenceAndCarry=function(t){return i._carry&&(i._operand=i._operand+256&65535),i._next(i._operand,i._state)},this._operand=0,this._address=0,this._carry=!1,this._result=new n.default,this._state=t,this._next=e,this._writeOp=r,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchAddress",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchLo",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchHi",void 0),i.__decorate([s.Immutable],t.prototype,"_dereferenceAndCarry",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),i.__decorate([s.Immutable],t.prototype,"_writeOp",void 0),t}();r.indirectIndexedY=function(t,e,r){return new a(t,e,r)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],25:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){void 0===e&&(e=function(){return null});var r=this;this.reset=function(){return r._result.read(r._fetchAddress,r._state.p)},this._fetchAddress=function(t){return r._operand=t,r._state.p=r._state.p+1&65535,r._next(r._operand,r._state)},this._operand=0,this._result=new n.default,this._state=t,this._next=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchAddress",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_next",void 0),t}();r.zeroPage=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],26:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function r(t,e,r){var i=this;this.reset=function(){return i._result.read(i._fetchAddress,i._state.p)},this._fetchAddress=function(t){return i._operand=t,i._state.p=i._state.p+1&65535,i._result.read(i._addIndex,i._operand)},this._addIndex=function(t){return i._operand=i._operand+i._indexExtractor(i._state)&255,i._next(i._operand,i._state)},this._operand=0,this._result=new n.default,this._state=t,this._indexExtractor=e,this._next=r,s.freezeImmutables(this)}return r.zeroPageX=function(t,e){return void 0===e&&(e=function(){return null}),new r(t,function(t){return t.x},e)},r.zeroPageY=function(t,e){return void 0===e&&(e=function(){return null}),new r(t,function(t){return t.y},e)},i.__decorate([s.Immutable],r.prototype,"reset",void 0),i.__decorate([s.Immutable],r.prototype,"_fetchAddress",void 0),i.__decorate([s.Immutable],r.prototype,"_addIndex",void 0),i.__decorate([s.Immutable],r.prototype,"_result",void 0),i.__decorate([s.Immutable],r.prototype,"_state",void 0),i.__decorate([s.Immutable],r.prototype,"_next",void 0),i.__decorate([s.Immutable],r.prototype,"_indexExtractor",void 0),r}();r.zeroPageX=function(t,e){return a.zeroPageX(t,e)},r.zeroPageY=function(t,e){return a.zeroPageY(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],27:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){var r=this;this.reset=function(){return r._result.read(r._fetchTarget,r._state.p).poll(!0)},this._fetchTarget=function(t){return r._operand=t,r._state.p=r._state.p+1&65535,r._predicate(r._state.flags)?r._result.read(r._firstDummyRead,r._state.p):null},this._firstDummyRead=function(t){return r._target=r._state.p+(128&r._operand?r._operand-256:r._operand)&65535,(65280&r._target)==(65280&r._state.p)?(r._state.p=r._target,null):r._result.read(r._secondDummyRead,65280&r._state.p|255&r._target).poll(!0)},this._secondDummyRead=function(t){return r._state.p=r._target,null},this._target=0,this._operand=0,this._result=new n.default,this._state=t,this._predicate=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchTarget",void 0),i.__decorate([s.Immutable],t.prototype,"_firstDummyRead",void 0),i.__decorate([s.Immutable],t.prototype,"_secondDummyRead",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_predicate",void 0),t}();r.branch=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],28:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./branch");r.branch=i.branch;var n=t("./jsr");r.jsr=n.jsr;var s=t("./readModifyWrite");r.readModifyWrite=s.readModifyWrite;var a=t("./rts");r.rts=a.rts;var o=t("./nullaryOneCycle");r.nullaryOneCycle=o.nullaryOneCycle;var u=t("./pull");r.pull=u.pull;var c=t("./push");r.push=c.push;var l=t("./rti");r.rti=l.rti;var _=t("./write");r.write=_.write},{"./branch":27,"./jsr":29,"./nullaryOneCycle":30,"./pull":31,"./push":32,"./readModifyWrite":33,"./rti":34,"./rts":35,"./write":36}],29:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t){var e=this;this.reset=function(){return e._result.read(e._fetchPcl,e._state.p)},this._fetchPcl=function(t){return e._addressLo=t,e._state.p=e._state.p+1&65535,e._result.read(e._dummyStackRead,256+e._state.s)},this._dummyStackRead=function(){return e._result.write(e._pushPch,256+e._state.s,e._state.p>>>8)},this._pushPch=function(){return e._state.s=e._state.s-1&255,e._result.write(e._pushPcl,256+e._state.s,255&e._state.p)},this._pushPcl=function(){return e._state.s=e._state.s-1&255,e._result.read(e._fetchPch,e._state.p)},this._fetchPch=function(t){return e._state.p=e._addressLo|t<<8,null},this._addressLo=0,this._result=new n.default,this._state=t,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"_fetchPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyStackRead",void 0),i.__decorate([s.Immutable],t.prototype,"_pushPch",void 0),i.__decorate([s.Immutable],t.prototype,"_pushPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchPch",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),t}();r.jsr=function(t){return new a(t)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],30:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){var r=this;this.reset=function(){return r._result.read(r._executeOperation,r._state.p).poll(!0)},this._executeOperation=function(){return r._operation(r._state),null},this._result=new n.default,this._state=t,this._operation=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_executeOperation",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_operation",void 0),t}();r.nullaryOneCycle=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],31:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../../../../tools/decorators"),s=t("../ResultImpl"),a=function(){function t(t,e){var r=this;this.reset=function(){return r._result.read(r._dummyRead,r._state.p).poll(!0)},this._dummyRead=function(){return r._result.read(r._incrementS,256+r._state.s)},this._incrementS=function(){return r._state.s=r._state.s+1&255,r._result.read(r._pull,256+r._state.s)},this._pull=function(t){return r._operation(r._state,t),null},this._result=new s.default,this._state=t,this._operation=e,n.freezeImmutables(this)}return i.__decorate([n.Immutable],t.prototype,"reset",void 0),i.__decorate([n.Immutable],t.prototype,"_dummyRead",void 0),i.__decorate([n.Immutable],t.prototype,"_incrementS",void 0),i.__decorate([n.Immutable],t.prototype,"_pull",void 0),i.__decorate([n.Immutable],t.prototype,"_result",void 0),i.__decorate([n.Immutable],t.prototype,"_state",void 0),i.__decorate([n.Immutable],t.prototype,"_operation",void 0),t}();r.pull=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],32:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../../../../tools/decorators"),s=t("../ResultImpl"),a=function(){function t(t,e){var r=this;this.reset=function(){return r._result.read(r._dummyRead,r._state.p)},this._dummyRead=function(){return r._result.write(r._push,256+r._state.s,r._operation(r._state))},this._push=function(){return r._state.s=r._state.s-1&255,null},this._result=new s.default,this._state=t,this._operation=e,n.freezeImmutables(this)}return i.__decorate([n.Immutable],t.prototype,"reset",void 0),i.__decorate([n.Immutable],t.prototype,"_dummyRead",void 0),i.__decorate([n.Immutable],t.prototype,"_push",void 0),i.__decorate([n.Immutable],t.prototype,"_result",void 0),i.__decorate([n.Immutable],t.prototype,"_state",void 0),i.__decorate([n.Immutable],t.prototype,"_operation",void 0),t}();r.push=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],33:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){var r=this;this.reset=function(t){return r._address=t,r._result.read(r._read,t)},this._read=function(t){return r._operand=t,r._result.write(r._dummyWrite,r._address,r._operand)},this._dummyWrite=function(t){return r._result.write(r._write,r._address,r._operation(r._operand,r._state))},this._write=function(){return null},this._result=new n.default,this._state=t,this._operation=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_read",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyWrite",void 0),i.__decorate([s.Immutable],t.prototype,"_write",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_operation",void 0),t}();r.readModifyWrite=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],34:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t){var e=this;this.reset=function(){return e._result.read(e._dummyOperandRead,e._state.p)},this._dummyOperandRead=function(){return e._result.read(e._dummyStackRead,256+e._state.s)},this._dummyStackRead=function(){return e._state.s=e._state.s+1&255,e._result.read(e._popP,256+e._state.s)},this._popP=function(t){return e._state.flags=-17&(32|t),e._state.s=e._state.s+1&255,e._result.read(e._popPcl,256+e._state.s)},this._popPcl=function(t){return e._state.p=65280&e._state.p|t,e._state.s=e._state.s+1&255,e._result.read(e._popPch,256+e._state.s)},this._popPch=function(t){return e._state.p=255&e._state.p|t<<8,null},this._result=new n.default,this._state=t,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyOperandRead",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyStackRead",void 0),i.__decorate([s.Immutable],t.prototype,"_popP",void 0),i.__decorate([s.Immutable],t.prototype,"_popPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_popPch",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),t}();r.rti=function(t){return new a(t)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],35:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t){var e=this;this.reset=function(){return e._result.read(e._dummyOperandRead,e._state.p)},this._dummyOperandRead=function(){return e._result.read(e._dummyStackRead,256+e._state.s)},this._dummyStackRead=function(){return e._state.s=e._state.s+1&255,e._result.read(e._popPcl,256+e._state.s)},this._popPcl=function(t){return e._state.p=65280&e._state.p|t,e._state.s=e._state.s+1&255,e._result.read(e._popPch,256+e._state.s)},this._popPch=function(t){return e._state.p=255&e._state.p|t<<8,e._result.read(e._incrementP,e._state.p)},this._incrementP=function(){return e._state.p=e._state.p+1&65535,null},this._result=new n.default,this._state=t,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyOperandRead",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyStackRead",void 0),i.__decorate([s.Immutable],t.prototype,"_popPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_popPch",void 0),i.__decorate([s.Immutable],t.prototype,"_incrementP",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),t}();r.rts=function(t){return new a(t)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],36:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e){var r=this;this.reset=function(t){return r._result.write(function(){return null},t,r._operation(r._state))},this._result=new n.default,this._state=t,this._operation=e,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_operation",void 0),t}();r.write=function(t,e){return new a(t,e)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],37:[function(t,e,r){"use strict";function n(t,e){e.flags=-131&e.flags|128&t|(t?0:2)}function i(t,e){if(8&e.flags){var r=(15&t)+(15&e.a)+(1&e.flags),i=(t>>>4)+(e.a>>>4)+(9<r?1:0);e.a=r%10|i%10<<4,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|(9<i?1:0)}else{var n=e.a+t+(1&e.flags),s=255&n;e.flags=-196&e.flags|128&s|(s?0:2)|n>>>8|(~(t^e.a)&(s^t)&128)>>>1,e.a=s}return null}function s(t,e){if(8&e.flags){var r=(15&e.a)-(15&t)-(1&~e.flags),i=(e.a>>>4)-(t>>>4)-(r<0?1:0);e.a=(r<0?10+r:r)|(i<0?10+i:i)<<4,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|(i<0?0:1)}else{t=255&~t;var n=e.a+t+(1&e.flags),s=255&n;e.flags=-196&e.flags|128&s|(s?0:2)|n>>>8|(~(t^e.a)&(s^t)&128)>>>1,e.a=s}return null}Object.defineProperty(r,"__esModule",{value:!0}),r.genRmw=function(t,e,r){var i=r(t);return n(i,e),i},r.genNullary=function(t,e){n(e(t),t)},r.genUnary=function(t,e,r){return n(r(t,e),e),null},r.adc=i,r.aslImmediate=function(t){var e=t.a;t.a=t.a<<1&255,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},r.aslRmw=function(t,e){var r=t<<1&255;return e.flags=-132&e.flags|128&r|(r?0:2)|t>>>7,r},r.bit=function(t,e){return e.flags=-195&e.flags|192&t|(t&e.a?0:2),null},r.cmp=function(t,e,r){var i=r(e)+(255&~t)+1;e.flags=-132&e.flags|128&i|(255&i?0:2)|i>>>8},r.sbc=s,r.lsrImmediate=function(t){var e=t.a;t.a=t.a>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},r.lsrRmw=function(t,e){var r=t>>>1;return e.flags=-132&e.flags|128&r|(r?0:2)|1&t,r},r.rolImmediate=function(t){var e=t.a;t.a=t.a<<1&255|1&t.flags,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},r.rolRmw=function(t,e){var r=t<<1&255|1&e.flags;return e.flags=-132&e.flags|128&r|(r?0:2)|t>>>7,r},r.rorImmediate=function(t){var e=t.a;t.a=t.a>>>1|(1&t.flags)<<7,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},r.rorRmw=function(t,e){var r=t>>>1|(1&e.flags)<<7;return e.flags=-132&e.flags|128&r|(r?0:2)|1&t,r},r.arr=function(t,e){e.a=(e.a&t)>>>1|(1&e.flags?128:0),e.flags=-196&e.flags|(64&e.a)>>>6|(e.a?0:2)|128&e.a|64&e.a^(32&e.a)<<1},r.alr=function(t,e){var r=e.a&t;return e.a=r>>>1,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|1&r,null},r.dcp=function(t,e){var r=t+255&255,i=e.a+(255&~r)+1;return e.flags=-132&e.flags|128&i|(255&i?0:2)|i>>>8,r},r.axs=function(t,e){var r=(e.a&e.x)+(255&~t)+1;return e.x=255&r,e.flags=-132&e.flags|128&e.x|(255&e.x?0:2)|r>>>8,null},r.rra=function(t,e){var r=t>>>1|(1&e.flags)<<7;return e.flags=-2&e.flags|1&t,i(r,e),r},r.rla=function(t,e){var r=t<<1&255|1&e.flags;return e.flags=-2&e.flags|t>>>7,n(e.a&=r,e),r},r.slo=function(t,e){e.flags=-2&e.flags|t>>>7;var r=t<<1&255;return e.a=e.a|r,n(e.a,e),r},r.aax=function(t){var e=t.a&t.x;return n(e,t),e},r.isc=function(t,e){var r=t+1&255;return s(r,e),r},r.aac=function(t,e){return e.a&=t,n(e.a,e),e.flags=-2&e.flags|(128&e.a)>>>7,null}},{}],38:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t){var e=this;this.reset=function(){return e._result.read(e._pre1Step,255)},this._pre1Step=function(){return e._result.read(e._pre2Step,255)},this._pre2Step=function(){return e._result.read(e._stack1Step,256)},this._stack1Step=function(){return e._result.read(e._stack2Step,511)},this._stack2Step=function(){return e._state.s=253,e._result.read(e._stack3Step,510)},this._stack3Step=function(){return e._result.read(e._readTargetLoStep,65532)},this._readTargetLoStep=function(t){return e._targetAddress=t,e._result.read(e._readTargetHiStep,65533)},this._readTargetHiStep=function(t){return e._targetAddress|=t<<8,e._state.p=e._targetAddress,null},this._targetAddress=0,this._result=new n.default,this._state=t,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_pre1Step",void 0),i.__decorate([s.Immutable],t.prototype,"_pre2Step",void 0),i.__decorate([s.Immutable],t.prototype,"_stack1Step",void 0),i.__decorate([s.Immutable],t.prototype,"_stack2Step",void 0),i.__decorate([s.Immutable],t.prototype,"_stack3Step",void 0),i.__decorate([s.Immutable],t.prototype,"_readTargetLoStep",void 0),i.__decorate([s.Immutable],t.prototype,"_readTargetHiStep",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),t}();r.boot=function(t){return new a(t)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],39:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./boot");r.boot=i.boot;var n=t("./interrupt");r.brk=n.brk,r.nmi=n.nmi,r.irq=n.irq},{"./boot":38,"./interrupt":40}],40:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../ResultImpl"),s=t("../../../../tools/decorators"),a=function(){function t(t,e,r){var i=this;this.reset=function(){return i._result.read(i._dummyRead,i._state.p)},this._dummyRead=function(){return i._isBrk&&(i._state.p=i._state.p+1&65535),i._result.write(i._pushPch,256+i._state.s,i._state.p>>>8)},this._pushPch=function(){return i._state.s=i._state.s-1&255,i._result.write(i._pushPcl,256+i._state.s,255&i._state.p).poll(!0)},this._pushPcl=function(){return i._state.s=i._state.s-1&255,i._vector=i._state.nmi?65530:i._defaultVector,i._result.write(i._pushFlags,256+i._state.s,i._isBrk?16|i._state.flags:-17&i._state.flags)},this._pushFlags=function(){return i._state.s=i._state.s-1&255,i._result.read(i._fetchPcl,i._vector)},this._fetchPcl=function(t){return i._state.flags|=4,i._state.p=t,i._result.read(i._fetchPch,++i._vector)},this._fetchPch=function(t){return i._state.p=i._state.p|t<<8,i._state.nmi=i._state.irq=!1,null},this._vector=0,this._result=new n.default,this._state=t,this._defaultVector=e,this._isBrk=r,s.freezeImmutables(this)}return i.__decorate([s.Immutable],t.prototype,"reset",void 0),i.__decorate([s.Immutable],t.prototype,"_dummyRead",void 0),i.__decorate([s.Immutable],t.prototype,"_pushPch",void 0),i.__decorate([s.Immutable],t.prototype,"_pushPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_pushFlags",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchPcl",void 0),i.__decorate([s.Immutable],t.prototype,"_fetchPch",void 0),i.__decorate([s.Immutable],t.prototype,"_result",void 0),i.__decorate([s.Immutable],t.prototype,"_state",void 0),i.__decorate([s.Immutable],t.prototype,"_defaultVector",void 0),i.__decorate([s.Immutable],t.prototype,"_isBrk",void 0),t}();r.brk=function(t){return new a(t,65534,!0)},r.irq=function(t){return new a(t,65534,!1)},r.nmi=function(t){return new a(t,65530,!1)}},{"../../../../tools/decorators":51,"../ResultImpl":16,tslib:6}],41:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./Switch"),n=function(){function t(){this._left=new i.default,this._right=new i.default,this._up=new i.default,this._down=new i.default,this._fire=new i.default}return t.prototype.getLeft=function(){return this._left},t.prototype.getRight=function(){return this._right},t.prototype.getUp=function(){return this._up},t.prototype.getDown=function(){return this._down},t.prototype.getFire=function(){return this._fire},t}();r.default=n},{"./Switch":43}],42:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=t("./Switch"),s=function(){function t(){this.valueChanged=new i.Event,this._fireSwitch=new n.default,this._value=.5}return t.prototype.setValue=function(t){this._value=t,this.valueChanged.dispatch(t)},t.prototype.getValue=function(){return this._value},t.prototype.getFire=function(){return this._fireSwitch},t}();r.default=s},{"./Switch":43,"microevent.ts":4}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=function(){function t(t){void 0===t&&(t=!1),this._state=t,this.stateChanged=new i.Event,this.beforeRead=new i.Event}return t.prototype.read=function(){return this.beforeRead.dispatch(this),this._state},t.prototype.peek=function(){return this._state},t.prototype.toggle=function(t){this._state!==t&&(this._state=t,this.stateChanged.dispatch(t))},t}();r.default=n},{"microevent.ts":4}],44:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n,s=t("tslib"),a=t("../cpu/Factory");(n=i||(i={})).create=function(t){return void 0===t&&(t={}),s.__assign({tvMode:0,enableAudio:!0,randomSeed:-1,emulatePaddles:!0,frameStart:-1,pcmAudio:!1,cpuType:a.default.Type.stateMachine},t)},n.getClockHz=function(t){switch(t.tvMode){case 0:return 3584160;case 1:case 2:return 3556800}},r.default=i},{"../cpu/Factory":11,tslib:6}],45:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../io/Switch"),n=function(){function t(){this._selectSwitch=new i.default,this._resetButton=new i.default,this._colorSwitch=new i.default,this._difficutlyP0=new i.default,this._difficutlyP1=new i.default}return t.prototype.getSelectSwitch=function(){return this._selectSwitch},t.prototype.getResetButton=function(){return this._resetButton},t.prototype.getColorSwitch=function(){return this._colorSwitch},t.prototype.getDifficultySwitchP0=function(){return this._difficutlyP0},t.prototype.getDifficultySwitchP1=function(){return this._difficutlyP1},t}();r.default=n},{"../io/Switch":43}],46:[function(t,e,r){"use strict";var i,n,s,a;Object.defineProperty(r,"__esModule",{value:!0}),n=i||(i={}),(a=s=n.CartridgeType||(n.CartridgeType={})).vanilla_2k="vanilla_2k",a.vanilla_4k="vanilla_4k",a.bankswitch_8k_F8="bankswitch_8k_F8",a.bankswitch_8k_E0="bankswitch_8k_E0",a.bankswitch_8k_3F="bankswitch_8k_3F",a.bankswitch_8k_FE="bankswitch_8k_FE",a.bankswitch_8k_UA="bankswitch_8k_UA",a.bankswitch_8k_DPC="bankswitch_8k_DPC",a.bankswitch_8k_econobanking="bankswitch_8k_econobanking",a.bankswitch_12k_FA="bankswitch_12k_FA",a.bankswitch_16k_F6="bankswitch_16k_F6",a.bankswitch_16k_E7="bankswitch_16k_E7",a.bankswitch_FA2="bankswitch_FA2",a.bankswitch_32k_F4="bankswitch_32k_F4",a.bankswitch_64k_F0="bankswitch_64k_F0",a.bankswitch_64k_EF="bankswitch_64k_EF",a.bankswitch_3E="bankswitch_3E",a.bankswitch_supercharger="bankswitch_supercharger",a.bankswitch_dpc_plus="bankswitch_dpc_plus",a.bankswitch_cdf="bankswitch_cdf",a.unknown="unknown",n.getAllTypes=function(){return[s.vanilla_2k,s.vanilla_4k,s.bankswitch_8k_F8,s.bankswitch_8k_E0,s.bankswitch_8k_3F,s.bankswitch_8k_FE,s.bankswitch_8k_UA,s.bankswitch_8k_econobanking,s.bankswitch_12k_FA,s.bankswitch_8k_DPC,s.bankswitch_16k_F6,s.bankswitch_16k_E7,s.bankswitch_FA2,s.bankswitch_32k_F4,s.bankswitch_3E,s.bankswitch_64k_F0,s.bankswitch_64k_EF,s.bankswitch_supercharger,s.bankswitch_dpc_plus,s.bankswitch_cdf,s.unknown]},n.describeCartridgeType=function(t){switch(t){case s.vanilla_2k:return"plain 2k";case s.vanilla_4k:return"plain 4k";case s.bankswitch_8k_F8:return"bankswitched 8k, F8 (Atari) scheme";case s.bankswitch_8k_E0:return"bankswitched 8k, E0 (Parker Bros.) scheme";case s.bankswitch_8k_3F:return"bankswitched 8k, 3F (Tigervision) scheme";case s.bankswitch_8k_FE:return"bankswitched 8k, FE (Activision) scheme";case s.bankswitch_8k_UA:return"bankswitched 8k, UA (Pleiades) scheme";case s.bankswitch_12k_FA:return"bankswitched 12k, FA (CBS) scheme";case s.bankswitch_8k_DPC:return"bankswitched 8k + DPC";case s.bankswitch_8k_econobanking:return"bankswitched 8k, econobanking scheme";case s.bankswitch_16k_F6:return"bankswitched 16k, F6 (Atari) scheme";case s.bankswitch_16k_E7:return"bankswitched 16k, E7 (M-Network) scheme";case s.bankswitch_FA2:return"bankswitched 28k/29k, FA2 (modified CBS) scheme";case s.bankswitch_32k_F4:return"bankswitched 32k, F4 (Atari) scheme";case s.bankswitch_3E:return"bankswitched 3E (Tigervision + RAM) scheme";case s.bankswitch_64k_F0:return"bankswitched 64k, F0 (Megaboy) scheme";case s.bankswitch_64k_EF:return"bankswitched 64k, EFSC (Homestar Runner) scheme";case s.bankswitch_supercharger:return"bankswitched supercharger";case s.bankswitch_dpc_plus:return"bankswitched DPC+";case s.bankswitch_cdf:return"bankswitched CDF";case s.unknown:return"unknown"}},r.default=i},{}],47:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=t("../Config"),d=t("../../../tools/AudioOutputBuffer"),i=t("../../../tools/base64"),p=i.decode("AQEPAQEBAQEBAQEBAwMDAQ=="),n=new Int8Array([1]),s=new Int8Array([1,1]),a=new Int8Array([16,15]),o=i.decode("AQICAQEBBAM="),u=i.decode("AQIBAQICBQQCAQMBAQEBBA=="),c=i.decode("AQQBAwIEAQIDAgEBAQEBAQIEAgEEAQECAgEDAgEDAQEBBAEBAQECAQECBgECAgECAQIBAQIBBgIBAgIBAQEBAgICAgcCAwICAQEBAwIBAQIBAQcBAQMBAQIDAwEBAQICAQECAgQDBQEDAQEFAgEBAQIBAgEDAQIFAQECAQEBBQEBAQEBAQEBBgEBAQIBAQEBBAIBAQMBAwYDAgMBAQIBAgQBAQEDAQEBAQMBAgEEAgIDBAEBBAECAQICAgEBBAMBBAQJBQQBBQMBAQMCAgIBBQECAQEBAgMBAgEBAwQCBQICAQIDAQEBAQECAQMDAwIBAgEBAQEBAwMBAgIDAQMBCA=="),l=i.decode("BQYEBQoFAwcECgYDBgQJBg=="),f=[n,o,o,i.decode("AgMCAQQBBgoCBAIBAQQFCQMDBAEBAQgFBQUEAQEBCAQCCAMDAQEHBAIHBQEDAQcEAQQIAgEDBAcBAwcDAgEGBgICBAUDAgYGAQMDAgUDBwMEAwICAgUJAwEFAwECAgsFAQUDAQECDAUBAgUCAQEMBgECBQECAQoGAwICBAECBgo="),s,s,a,u,c,u,a,n,s,s,a,l],_=function(){function t(t){this._config=t}return t.prototype.setConfig=function(t){this._config=t},t.prototype.getKey=function(t,e){return f[t]===s&&p[t]*(e+1)==1?0:t<<5|e},t.prototype.getBuffer=function(t){for(var e=t>>>5&15,r=31&t,i=f[e],n=0,s=0;s<i.length;s++)n+=i[s];n=n*p[e]*(r+1);var a=new Float32Array(n),o=h.default.getClockHz(this._config)/114,u=0,c=0,l=0,_=!0;for(s=0;s<n;s++)++u===p[e]*(r+1)&&(u=0,++c===i[l]&&(l++,c=0,i.length===l&&(l=0)),_=!(1&l)),a[s]=_?1:-1;return new d.default(a,o)},t}();r.default=_},{"../../../tools/AudioOutputBuffer":48,"../../../tools/base64":50,"../Config":44}],48:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){this._content=t,this._sampleRate=e}return t.prototype.getLength=function(){return this._content.length},t.prototype.getContent=function(){return this._content},t.prototype.getSampleRate=function(){return this._sampleRate},t.prototype.replaceUnderlyingBuffer=function(t){this._content=t},t}();r.default=i},{}],49:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t){this._capacity=t,this._size=0,this._index=0,this._buffer=new Array(this._capacity);for(var e=0;e<this._capacity;e++)this._buffer[e]=null}return t.prototype.size=function(){return this._size},t.prototype.pop=function(){if(0!==this._size){var t=this._buffer[this._index];return this._buffer[this._index]=null,this._index=(this._index+1)%this._capacity,this._size--,t}},t.prototype.push=function(t){return this._size===this._capacity&&this.pop(),this._buffer[(this._index+this._size++)%this._capacity]=t,this},t.prototype.forEach=function(t){for(var e=0;e<this._size;e++)t(this._buffer[(this._index+e)%this._capacity]);return this},t.prototype.clear=function(){for(var t=0;t<this._capacity;t++)this._buffer[t]=null;return this._size=0,this._index=0,this},t}();r.default=i},{}],50:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=new Uint8Array(256);function l(t,e){var r=i[t.charCodeAt(e)];if(63<r)throw new Error('invalid base64 character "'+t[e]+'" at index '+e);return r}!function(t){var e;for(e=0;e<256;e++)i[e]=255;for(e=0;e<64;e++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;i["=".charCodeAt(0)]=0}(r.__init||(r.__init={})),r.decode=function(t){if(t.length%4!=0)throw new Error("invalid base64 data --- char count mismatch");for(var e,r,i=t.length/4,n=3*i-function(t){for(var e=0,r=t.length-1;0<=r&&"="===t[r--];)e++;return e}(t),s=new Uint8Array(n),a=0,o=0;o<i;o++)for(var u=(l(e=t,r=4*o)<<18)+(l(e,r+1)<<12)+(l(e,r+2)<<6)+l(e,r+3),c=0;c<3&&a<n;c++)s[a++]=u>>>8*(2-c)&255;return s}},{}],51:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("tslib"),u=Symbol("immutable properties");r.freezeImmutables=function(t){var e,r,i=t[u];if(i)try{for(var n=o.__values(i),s=n.next();!s.done;s=n.next()){var a=s.value;Object.defineProperty(t,a,{writable:!1,configurable:!1})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},r.Immutable=function(t,e){t[u]||Object.defineProperty(t,u,{value:[],writable:!1,enumerable:!1}),t[u].push(e)}},{tslib:6}],52:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=t("./PoolMember"),s=function(){function t(t){this._factory=t,this.event={release:new i.Event,dispose:new i.Event},this._pool=[],this._poolSize=0}return t.prototype.get=function(){var t,e=this;if(0===this._poolSize){var r=this._factory();t=new n.default(r,function(t){return e._releaseMember(t)},function(t){return e._disposeMember(t)})}else(t=this._pool[--this._poolSize])._isAvailable=!1;return t},t.prototype._releaseMember=function(t){if(t._isAvailable)throw new Error("Trying to release an already released pool member");if(t._isDisposed)throw new Error("Trying to release an already disposed pool member");var e=this._poolSize++;(this._pool[e]=t)._isAvailable=!0,t._poolPosition=e,this.event.release.dispatch(t.get())},t.prototype._disposeMember=function(t){if(t._isDisposed)throw new Error("Trying to dispose of an already disposed pool member");t._isAvailable&&(1<this._poolSize&&(this._pool[t._poolPosition]=this._pool[this._poolSize-1]),this._poolSize--),t._isDisposed=!0,this.event.dispose.dispatch(t.get())},t}();r.default=s},{"./PoolMember":53,"microevent.ts":4}],53:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e,r){this._value=t,this._releaseCB=e,this._disposeCB=r,this._isAvailable=!1,this._isDisposed=!1}return t.prototype.adopt=function(t){this._value=t},t.prototype.get=function(){return this._value},t.prototype.release=function(){this._releaseCB(this)},t.prototype.dispose=function(){this._disposeCB(this)},t}();r.default=i},{}],54:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("screenfull"),n=!!navigator.platform.match(/iPhone|iPad|iPod/),s=function(){function t(t,e,r){void 0===e&&(e=1e5),void 0===r&&(r="stellerator-fullscreen");var i=this;this._videoDriver=t,this._zIndex=e,this._fullscreenClass=r,this._resizeListener=function(){i._resizeHandle||(i._resizeHandle=setTimeout(function(){i._resizeHandle=null,i._adjustSizeForFullscreen()},100))},this._resizeHandle=null,this._changeListener=this._onChange.bind(this),this._engaged=!1}return t.prototype.engage=function(){this._engaged||(this._engaged=!0,n||!i?(this._adjustSizeForFullscreen(),window.addEventListener("resize",this._resizeListener),this._engaged=!0):(i.on("change",this._changeListener),i.request(this._videoDriver.getCanvas())))},t.prototype.disengage=function(){this._engaged&&(n||!i?(this._resetSize(),window.removeEventListener("resize",this._resizeListener),this._engaged=!1):i.exit())},t.prototype.toggle=function(){this._engaged?this.disengage():this.engage()},t.prototype.isEngaged=function(){return this._engaged},t.prototype._onChange=function(){i&&(i.isFullscreen?(window.addEventListener("resize",this._resizeListener),this._adjustSizeForFullscreen()):(this._resetSize(),window.removeEventListener("resize",this._resizeListener),i.off("change",this._changeListener),this._engaged=!1))},t.prototype._resetSize=function(){var t=this,e=this._videoDriver.getCanvas();this._resizeHandle&&(clearTimeout(this._resizeHandle),this._resizeHandle=null),e.style.width="",e.style.height="",e.style.maxWidth="",e.style.maxHeight="",n&&(e.style.position="",e.style.top="",e.style.left="",e.style.zIndex=""),document.body.classList.remove(this._fullscreenClass),setTimeout(function(){return t._videoDriver.resize()},0)},t.prototype._adjustSizeForFullscreen=function(){var t=this._videoDriver.getCanvas();this._videoDriver.resize(window.innerWidth,window.innerHeight),t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px",t.style.maxWidth=window.innerWidth+"px",t.style.maxHeight=window.innerHeight+"px",n&&(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex=""+this._zIndex),document.body.classList.add(this._fullscreenClass)},t}();r.default=s},{screenfull:5}],55:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a=t("tslib"),n=t("microevent.ts"),l=((i={}).up=[12],i.down=[13],i.left=[14],i.right=[15],i.fire=[0,1,2,3,10,11],i.select=[8],i.start=[9],i),s=function(){function u(){var t=this;this._onGamepadConnect=function(){return t._probeGamepads()},this._onGamepadDisconnect=function(){return t._probeGamepads()},this.gamepadCountChanged=new n.Event,this._bound=!1,this._gamepadCount=0,this._lastPoll=0,this._joysticks=null,this._start=null,this._select=null,this._joysticksShadow=null,this._startShadow=null,this._selectShadow=null}return u.prototype.init=function(){if(!navigator.getGamepads)throw new Error("gamepad API not available");this._probeGamepads(),window.addEventListener("gamepadconnected",this._onGamepadConnect),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnect)},u.prototype.deinit=function(){this.unbind(),window.removeEventListener("gamepadconnected",this._onGamepadConnect),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnect)},u.prototype.bind=function(t){var e=this,r=t.joysticks,i=void 0===r?null:r,n=t.start,s=void 0===n?null:n,a=t.select,o=void 0===a?null:a;this._bound||(this._joysticks=i||[],this._start=s,this._select=o,this._bound=!0,this._joysticksShadow=this._joysticks.map(function(t){return(e={}).left=new c,e.right=new c,e.up=new c,e.down=new c,e.fire=new c,e;var e}),this._startShadow=this._start?new c:null,this._selectShadow=this._select?new c:null,this._controlledSwitches().forEach(function(t){return t.beforeRead.addHandler(u._onBeforeSwitchRead,e)}),this._initShadows())},u.prototype.unbind=function(){var e=this;this._bound&&(this._controlledSwitches().forEach(function(t){return t.beforeRead.removeHandler(u._onBeforeSwitchRead,e)}),this._joysticks=this._start=this._select=null,this._bound=!1)},u.prototype.getGamepadCount=function(){return this._gamepadCount},u._onBeforeSwitchRead=function(t,e){var r=Date.now();if(!(0===e._gamepadCount||r-e._lastPoll<50)){e._lastPoll=r;for(var i=0,n=0,s=!1,a=!1,o=navigator.getGamepads(),u=0;u<o.length;u++){var c=o[u];c&&(i++,e._updateJoystickState(c,n++),s=s||e._readState(l.start,c),a=a||e._readState(l.select,c))}0<i&&(e._start&&e._startShadow.toggle(s),e._select&&e._selectShadow.toggle(a)),e._syncShadows()}},u.prototype._controlledSwitches=function(){var e,t,r=[];try{for(var i=a.__values(this._joysticks),n=i.next();!n.done;n=i.next()){var s=n.value;r.push(s.getLeft(),s.getRight(),s.getUp(),s.getDown(),s.getFire())}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return this._select&&r.push(this._select),this._start&&r.push(this._start),r},u.prototype._readState=function(t,e){for(var r=!1,i=0;i<t.length;i++){var n=e.buttons[t[i]];r=r||("object"==typeof n?n.pressed:.5<=n)}return r},u.prototype._updateJoystickState=function(t,e){if(this._joysticks&&!(e>=this._joysticks.length)){var r=this._joysticksShadow[e];r.left.toggle(this._readState(l.left,t)),r.right.toggle(this._readState(l.right,t)),r.up.toggle(this._readState(l.up,t)),r.down.toggle(this._readState(l.down,t)),r.fire.toggle(this._readState(l.fire,t)),(t.axes[0]<-.5||t.axes[2]<-.5)&&r.left.toggle(!0),(.5<t.axes[0]||.5<t.axes[2])&&r.right.toggle(!0),(t.axes[1]<-.5||t.axes[3]<-.5)&&r.up.toggle(!0),(.5<t.axes[1]||.5<t.axes[3])&&r.down.toggle(!0)}},u.prototype._initShadows=function(){if(this._joysticks)for(var t=0;t<this._joysticks.length;t++){var e=this._joysticks[t],r=this._joysticksShadow[t];r.left.setState(e.getLeft().peek()),r.right.setState(e.getRight().peek()),r.up.setState(e.getUp().peek()),r.down.setState(e.getDown().peek()),r.fire.setState(e.getFire().peek())}this._start&&this._startShadow.setState(this._start.peek()),this._select&&this._selectShadow.setState(this._select.peek())},u.prototype._syncShadows=function(){if(this._joysticks)for(var t=0;t<this._joysticks.length;t++){var e=this._joysticks[t],r=this._joysticksShadow[t];r.left.sync(e.getLeft()),r.right.sync(e.getRight()),r.up.sync(e.getUp()),r.down.sync(e.getDown()),r.fire.sync(e.getFire())}this._start&&this._startShadow.sync(this._start),this._select&&this._selectShadow.sync(this._select)},u.prototype._probeGamepads=function(){for(var t=0,e=navigator.getGamepads(),r=0;r<e.length;r++)e[r]&&t++;t!==this._gamepadCount&&(this._gamepadCount=t,this.gamepadCountChanged.dispatch(this._gamepadCount))},u}();r.default=s;var c=function(){function t(){this._state=!1,this._dirty=!1}return t.prototype.toggle=function(t){t!==this._state&&(this._state=t,this._dirty=!0)},t.prototype.setState=function(t){this._state=t,this._dirty=!1},t.prototype.sync=function(t){this._dirty&&(t.toggle(this._state),this._dirty=!1)},t}()},{"microevent.ts":4,tslib:6}],56:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(){this._x=-1,this._listener=this._onDocumentMouseMove.bind(this)}return t.prototype.bind=function(t){this._paddle||(this._paddle=t,this._x=-1,document.addEventListener("mousemove",this._listener))},t.prototype.unbind=function(){this._paddle&&(document.removeEventListener("mousemove",this._listener),this._paddle=null)},t.prototype._onDocumentMouseMove=function(t){if(0<=this._x){var e=t.screenX-this._x,r=this._paddle.getValue();(r+=-e/window.innerWidth/.9)<0&&(r=0),1<r&&(r=1),this._paddle.setValue(r)}this._x=t.screenX},t}();r.default=i},{}],57:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("tslib"),a=["imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled"],i=function(){function e(t,e){void 0===e&&(e=4/3),this._canvas=t,this._aspect=e,this._syncRendering=!0,this._animationFrameHandle=0,this._pendingFrame=null,this._video=null,this._interpolate=!0,this._context=this._canvas.getContext("2d"),this._renderCanvas=document.createElement("canvas"),this._renderCanvas.width=this._renderCanvas.height=100,this._renderContext=this._renderCanvas.getContext("2d")}return e.prototype.resize=function(t,e){void 0!==t&&void 0!==e||(t=this._canvas.clientWidth,e=this._canvas.clientHeight);var r=window.devicePixelRatio||1;if(this._video){var i=this._video.getWidth(),n=this._video.getHeight();e*this._aspect<=t?3*n<=e&&e*this._aspect>=3*i&&(r=1):3*i<=t&&t/this._aspect>=3*n&&(r=1)}return this._canvas.width=t*r,this._canvas.height=e*r,this._clearCanvas(),this._recalculateBlittingMetrics(),this._applyInterpolationSettings(),this._video&&this._blitToCanvas(),this},e.prototype.init=function(){return this.enableInterpolation(!0),this._clearRenderCanvas(),this.resize(),this},e.prototype.close=function(){return this},e.prototype.enableSyncRendering=function(t){return t===this._syncRendering||(this._cancelPendingFrame(),this._syncRendering=t),this},e.prototype.syncRenderingEnabled=function(){return this._syncRendering},e.prototype.bind=function(t){return this._video||(this._video=t,this._videoWidth=this._renderCanvas.width=this._video.getWidth(),this._videoHeight=this._renderCanvas.height=this._video.getHeight(),this.resize(),this._clearRenderCanvas(),this._video.newFrame.addHandler(e._frameHandler,this)),this},e.prototype.unbind=function(){return this._video&&(this._video.newFrame.removeHandler(e._frameHandler,this),this._video=null,this._cancelPendingFrame(),this._clearCanvas()),this},e.prototype.enableInterpolation=function(t){return this._interpolate===t||(this._interpolate=t,this._applyInterpolationSettings()),this},e.prototype.interpolationEnabled=function(){return this._interpolate},e.prototype.getCanvas=function(){return this._canvas},e._frameHandler=function(t,e){e._pendingFrame&&e._pendingFrame.release(),e._pendingFrame=t,e._syncRendering?e._animationFrameHandle||e._scheduleDraw():e._draw()},e.prototype._clearCanvas=function(){this._context.fillStyle="solid black",this._context.fillRect(0,0,this._canvas.width,this._canvas.height)},e.prototype._clearRenderCanvas=function(){this._renderContext.fillStyle="solid black",this._renderContext.fillRect(0,0,this._renderCanvas.width,this._renderCanvas.height)},e.prototype._draw=function(){this._blitToRenderCanvas(),this._blitToCanvas(),this._pendingFrame.release(),this._pendingFrame=null},e.prototype._blitToRenderCanvas=function(){this._renderContext.putImageData(this._pendingFrame.get(),0,0)},e.prototype._blitToCanvas=function(){this._context.drawImage(this._renderCanvas,0,0,this._videoWidth,this._videoHeight,this._renderX,this._renderY,this._renderWidth,this._renderHeight)},e.prototype._scheduleDraw=function(){var t=this;this._animationFrameHandle||(this._animationFrameHandle=requestAnimationFrame(function(){t._draw(),t._animationFrameHandle=0}))},e.prototype._cancelPendingFrame=function(){this._animationFrameHandle&&(cancelAnimationFrame(this._animationFrameHandle),this._animationFrameHandle=0),this._pendingFrame&&(this._pendingFrame.release(),this._pendingFrame=null)},e.prototype._recalculateBlittingMetrics=function(){var t=this._canvas.width,e=this._canvas.height;this._aspect*e<=t?(this._renderHeight=e,this._renderWidth=this._aspect*e,this._renderY=0,this._renderX=Math.floor((t-this._renderWidth)/2)):(this._renderHeight=t/this._aspect,this._renderWidth=t,this._renderY=Math.floor((e-this._renderHeight)/2),this._renderX=0)},e.prototype._applyInterpolationSettings=function(){var e,t;try{for(var r=s.__values(a),i=r.next();!i.done;i=r.next()){var n=i.value;this._context[n]=this._interpolate}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e}();r.default=i},{tslib:6}],58:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("tslib"),a=t("async-mutex"),o=t("./audio/WaveformChannel"),u=t("./audio/PCMChannel"),i=!!navigator.platform.match(/iPhone|iPad|iPod/)||!!window.safari,c=["touchstart","click","keydown"],n=window.AudioContext||window.webkitAudioContext,l=function(){function t(){var r=this;if(this._interactionListener=function(){var e=r.context;r.interactionRequired=!1,c.forEach(function(t){return document.removeEventListener(t,r._interactionListener)}),r.mutex.runExclusive(function(){return e.resume(),new Promise(function(t){return setTimeout(function(){e.suspend(),t()},100)})})},this.mutex=new a.Mutex,this.context=null,this.interactionRequired=!0,n){this.context=new n;try{this.context.destination.channelCount=1}catch(t){console.warn("audio driver: failed to set channel count")}c.forEach(function(t){return document.addEventListener(t,r._interactionListener)})}}return t.prototype.stopListening=function(){var e=this;c.forEach(function(t){return document.removeEventListener(t,e._interactionListener)})},t}(),_=i?new l:null,h=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0);var i=this;this._touchListener=function(){c.forEach(function(t){return document.removeEventListener(t,i._touchListener,!0)}),i._context&&(i._context.resume(),setTimeout(function(){i._mutex.runExclusive(function(){return i._suspended?i._context.suspend():i._context.resume()})},10))},this._context=null,this._merger=null,this._waveformChannels=null,this._pcmChannels=null,this._channels=null,this._cache=new Map,this._mutex=new a.Mutex,this._suspended=!0,this._isBound=!1,this._waveformChannels=new Array(t),this._pcmChannels=new Array(e);for(var n=0;n<t;n++)this._waveformChannels[n]=new o.default(this._cache);for(n=0;n<e;n++)this._pcmChannels[n]=new u.default(r);this._channels=s.__spread(this._waveformChannels,this._pcmChannels)}return t.prototype.init=function(){var e=this;if(_){var t=_;_=new l,this._context=t.context,t.stopListening(),this._mutex=t.mutex,t.interactionRequired&&c.forEach(function(t){return document.addEventListener(t,e._touchListener,!0)})}else{if(!n)throw new Error("web audio is not supported by runtime");this._context=new n;try{this._context.destination.channelCount=1}catch(t){console.warn("audio driver: failed to set channel count")}}this._merger=this._context.createChannelMerger(this._channels.length),this._merger.connect(this._context.destination),this._channels.forEach(function(t){return t.init(e._context,e._merger)})},t.prototype.bind=function(r,i){if(void 0===r&&(r=[]),void 0===i&&(i=[]),!this._isBound){if(r.length!==this._waveformChannels.length)throw new Error("invalid number of waveform sources: expected "+this._waveformChannels.length+", got "+r.length);if(i.length!==this._pcmChannels.length)throw new Error("invalid number of waveform sources: expected "+this._pcmChannels.length+", got "+i.length);this._waveformChannels.forEach(function(t,e){return t.bind(r[e])}),this._pcmChannels.forEach(function(t,e){return t.bind(i[e])}),this._isBound=!0,this.resume()}},t.prototype.unbind=function(){this._isBound&&(this._channels.forEach(function(t){return t.unbind()}),this._isBound=!1,this.pause())},t.prototype.setMasterVolume=function(t,e){this._channels[t].setMasterVolume(e)},t.prototype.pause=function(){var e=this;return this._mutex.runExclusive(function(){return e._suspended=!0,new Promise(function(t){e._context.suspend().then(t,t),setTimeout(t,200)})})},t.prototype.resume=function(){var e=this;return this._mutex.runExclusive(function(){return e._suspended=!1,new Promise(function(t){e._context.resume().then(t,t),setTimeout(t,200)})})},t.prototype.close=function(){var t=this;this._mutex.runExclusive(function(){return t._context.close()})},t}();r.default=h},{"./audio/PCMChannel":60,"./audio/WaveformChannel":61,"async-mutex":2,tslib:6}],59:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(){this._buffer=new Float32Array(2),this._fractionalIndex=0,this._needsData=!1,this._ratio=0,this.reset(1,1)}return t.prototype.reset=function(t,e){this._ratio=t/e,this._needsData=!1;for(var r=this._fractionalIndex=0;r<2;r++)this._buffer[r]=0},t.prototype.get=function(){var t=(1-this._fractionalIndex)*this._buffer[0]+this._fractionalIndex*this._buffer[1];return this._fractionalIndex+=this._ratio,1<this._fractionalIndex&&(this._fractionalIndex-=1,this._needsData=!0),t},t.prototype.push=function(t){this._buffer[0]=this._buffer[1],this._buffer[1]=t,this._needsData=!1},t.prototype.needsData=function(){return this._needsData},t}();r.default=i},{}],60:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../tools/RingBuffer"),n=t("./LinearResampler"),s=function(){function e(t){void 0===t&&(t=1024),this._hostFragmentSize=t,this._outputSampleRate=0,this._bufferSize=0,this._volume=1,this._gain=null,this._processor=null,this._bufferUnderrun=!1,this._fragmentRing=null,this._fragmentSize=0,this._inputSampleRate=0,this._fragmentIndex=0,this._currentFragment=null,this._lastFragment=null,this._resampler=new n.default}return e.prototype.init=function(t,e){var r=this;this._outputSampleRate=t.sampleRate,this._gain=t.createGain(),this._gain.gain.value=this._volume,this._gain.connect(e),this._processor=t.createScriptProcessor(this._hostFragmentSize,1,1),this._bufferSize=this._processor.bufferSize,this._processor.connect(this._gain),this._processor.onaudioprocess=function(t){return r._processAudio(t)},t.createBuffer(1,1,t.sampleRate).getChannelData(0).set([0])},e.prototype.bind=function(t){this.unbind(),this._audio=t,this._fragmentSize=t.getFrameSize(),this._inputSampleRate=t.getSampleRate(),this._fragmentIndex=0,this._lastFragment=null,this._bufferUnderrun=!0,this._fragmentRing=new i.default(Math.ceil(4*this._bufferSize/this._outputSampleRate/this._fragmentSize*this._inputSampleRate)),this._audio.newFrame.addHandler(e._onNewFragment,this),this._resampler.reset(this._inputSampleRate,this._outputSampleRate)},e.prototype.unbind=function(){this._audio&&(this._audio.newFrame.removeHandler(e._onNewFragment,this),this._lastFragment&&(this._lastFragment.release(),this._lastFragment=null),this._currentFragment&&(this._currentFragment.release(),this._currentFragment=null),this._fragmentRing&&(this._fragmentRing.forEach(function(t){return t.release()}),this._fragmentRing.clear(),this._fragmentRing=null))},e.prototype.setMasterVolume=function(t){this._volume=t},e._onNewFragment=function(t,e){e._fragmentRing.push(t),e._currentFragment||(e._currentFragment=e._fragmentRing.pop(),e._fragmentIndex=0)},e.prototype._processAudio=function(t){var r=this;if(this._audio){var i=t.outputBuffer.getChannelData(0),n=0,e=function(t){for(var e=r._lastFragment&&r._lastFragment.get();n<t;)r._resampler.needsData()&&(r._resampler.push(r._audio&&r._audio.isPaused()||!e?0:e[r._fragmentIndex++]*r._volume),r._fragmentIndex>=r._fragmentSize&&(r._fragmentIndex=0)),i[n++]=r._resampler.get()};this._currentFragment&&this._bufferUnderrun&&(e(this._bufferSize>>>1),this._bufferUnderrun=!1);for(var s=this._currentFragment&&this._currentFragment.get();n<this._bufferSize&&this._currentFragment;)this._resampler.needsData()&&(this._resampler.push(s[this._fragmentIndex++]*this._volume),this._fragmentIndex>=this._fragmentSize&&(this._fragmentIndex=0,this._lastFragment&&this._lastFragment.release(),this._lastFragment=this._currentFragment,this._currentFragment=this._fragmentRing.pop(),s=this._currentFragment&&this._currentFragment.get())),i[n++]=this._resampler.get();n<this._bufferSize&&(this._bufferUnderrun=!0),e(this._bufferSize)}},e}();r.default=s},{"../../../tools/RingBuffer":49,"./LinearResampler":59}],61:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(t){this._cache=t,this._context=null,this._source=null,this._gain=null,this._audio=null,this._volume=0,this._masterVolume=1}return e.prototype.init=function(t,e){this._context=t,this._gain=this._context.createGain(),this._gain.connect(e)},e.prototype.bind=function(t){this._audio||(this._audio=t,this._volume=this._audio.getVolume(),this._updateGain(),this._audio.volumeChanged.addHandler(e._onVolumeChanged,this),this._audio.bufferChanged.addHandler(e._onBufferChanged,this),this._audio.stop.addHandler(e._onStop,this))},e.prototype.unbind=function(){this._audio&&(this._audio.volumeChanged.removeHandler(e._onVolumeChanged,this),this._audio.bufferChanged.removeHandler(e._onBufferChanged,this),this._audio.stop.removeHandler(e._onStop,this),this._source&&(this._source.stop(),this._source=null),this._audio=null)},e.prototype.setMasterVolume=function(t){this._masterVolume=t,this._updateGain()},e._onVolumeChanged=function(t,e){e._volume=t,e._updateGain()},e._onBufferChanged=function(t,e){if(!e._cache.has(t)){var r=e._audio.getBuffer(t),i=e._context.createBuffer(1,r.getLength(),r.getSampleRate());i.getChannelData(0).set(r.getContent()),e._cache.set(t,i)}var n=e._cache.get(t),s=e._context.createBufferSource();e._source&&e._source.stop(),s.loop=!0,s.buffer=n,s.connect(e._gain),s.start(),e._source=s},e._onStop=function(t,e){e._source&&(e._source.stop(),e._source=null)},e.prototype._updateGain=function(){this._gain.gain.value=this._volume*this._masterVolume},e}();r.default=i},{}],62:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("tslib"),n=t("./shader"),u=["webgl","experimental-webgl"],i=function(){function e(t,e){var r,i;void 0===e&&(e={}),this._canvas=t,this._gl=null,this._program=null,this._vertexBuffer=null,this._textureCoordinateBuffer=null,this._currentFrameIndex=0,this._frameCount=0,this._gamma=1,this._aspect=4/3,this._povEmulation=!0,this._animationFrameHandle=0,this._syncRendering=!0,this._video=null,this._interpolation=!0,void 0!==e.aspect&&(this._aspect=e.aspect),void 0!==e.gamma&&(this._gamma=e.gamma),void 0!==e.povEmulation&&(this._povEmulation=e.povEmulation);try{for(var n=o.__values(u),s=n.next();!s.done;s=n.next()){var a=s.value;if(this._gl)break;this._gl=this._canvas.getContext(a,{alpha:!1})}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}if(!this._gl)throw new Error("unable to acquire WebGL context");this._createTextureArrays()}return e.prototype.init=function(){return this._gl.clearColor(0,0,0,1),this._createProgram(),this._createBuffers(),this.resize(),this._allocateTextures(),this._configureTextures(),this._setupAttribs(),this.enableInterpolation(!0),this},e.prototype.close=function(){var e=this;return this._program&&this._gl.deleteProgram(this._program),this._vertexShader&&this._gl.deleteShader(this._vertexShader),this._fragmentShader&&this._gl.deleteShader(this._fragmentShader),this._textures&&this._textures.forEach(function(t){return t&&e._gl.deleteTexture(t)}),this._imageData&&this._imageData.forEach(function(t){return t&&t.release()}),this._vertexBuffer&&this._gl.deleteBuffer(this._vertexBuffer),this._textureCoordinateBuffer&&this._gl.deleteBuffer(this._textureCoordinateBuffer),this},e.prototype.resize=function(t,e){void 0!==t&&void 0!==e||(t=this._canvas.clientWidth,e=this._canvas.clientHeight);var r=window.devicePixelRatio||1;if(this._video){var i=this._video.getWidth(),n=this._video.getHeight();e*this._aspect<=t?3*n<=e&&e*this._aspect>=3*i&&(r=1):3*i<=t&&t/this._aspect>=3*n&&(r=1)}return this._canvas.width=t*r,this._canvas.height=e*r,this._gl.viewport(0,0,t*r,e*r),this._recalculateVertexBuffer(),this._video&&this._draw(),this},e.prototype.getCanvas=function(){return this._canvas},e.prototype.bind=function(t){return this._video||(this.resize(),this._video=t,this._video.newFrame.addHandler(e._frameHandler,this)),this},e.prototype.unbind=function(){return this._cancelDraw(),this._video&&(this._video.newFrame.removeHandler(e._frameHandler,this),this._video=null),this},e.prototype.enableInterpolation=function(t){return t===this._interpolation||(this._interpolation=t,this._configureTextures()),this},e.prototype.interpolationEnabled=function(){return this._interpolation},e.prototype.enableSyncRendering=function(t){return t===this._syncRendering||(t||this._cancelDraw(),this._syncRendering=t),this},e.prototype.syncRenderingEnabled=function(){return this._syncRendering},e.prototype.setGamma=function(t){return this._gamma=t,this},e.prototype.getGamma=function(){return this._gamma},e.prototype.enablePovEmulation=function(t){if(t===this._povEmulation)return this;this._povEmulation=t,this._reinit()},e.prototype.povEmulationEnabled=function(){return this._povEmulation},e._frameHandler=function(t,e){var r=e._imageData[e._currentFrameIndex];e._imageData[e._currentFrameIndex]=t,e._imageDataGeneration[e._currentFrameIndex]++,e._currentFrameIndex=(e._currentFrameIndex+1)%e._numberOfFramesToCompose,e._frameCount<e._numberOfFramesToCompose?e._frameCount++:(e._syncRendering?e._scheduleDraw():e._draw(),r.release())},e.prototype._createTextureArrays=function(){var e=this;this._numberOfFramesToCompose=this._povEmulation?3:1,this._textures&&this._textures.forEach(function(t){return t&&e._gl.deleteTexture(t)}),this._imageData&&this._imageData.forEach(function(t){return t&&t.release()}),this._textures=new Array(this._numberOfFramesToCompose),this._imageData=new Array(this._numberOfFramesToCompose),this._imageDataGeneration=new Array(this._numberOfFramesToCompose),this._textureGeneration=new Array(this._numberOfFramesToCompose);for(var t=0;t<this._numberOfFramesToCompose;t++)this._imageDataGeneration[t]=0,this._textureGeneration[t]=-1},e.prototype._reinit=function(){this._createTextureArrays(),this._createProgram(),this._allocateTextures(),this._configureTextures(),this._setupAttribs(),this._frameCount=0,this._currentFrameIndex=0},e.prototype._scheduleDraw=function(){var t=this;this._animationFrameHandle||(this._animationFrameHandle=requestAnimationFrame(function(){return t._draw(),t._animationFrameHandle=0}))},e.prototype._cancelDraw=function(){0!==this._animationFrameHandle&&(cancelAnimationFrame(this._animationFrameHandle),this._animationFrameHandle=0)},e.prototype._draw=function(){if(!(this._frameCount<this._numberOfFramesToCompose)){for(var t=this._gl,e=0;e<this._numberOfFramesToCompose;e++){var r=(this._currentFrameIndex-e-1+this._numberOfFramesToCompose)%this._numberOfFramesToCompose;this._textureGeneration[r]!==this._imageDataGeneration[r]&&(t.activeTexture(t["TEXTURE"+r]),t.bindTexture(t.TEXTURE_2D,this._textures[r]),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._imageData[r].get()),this._textureGeneration[r]=this._imageDataGeneration[r])}for(e=0;e<this._numberOfFramesToCompose;e++)t.uniform1i(this._getUniformLocation("u_Sampler"+e),(this._currentFrameIndex+this._numberOfFramesToCompose-e-1)%this._numberOfFramesToCompose);t.uniform1f(this._getUniformLocation("u_Gamma"),this._gamma),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},e.prototype._createProgram=function(){var t=this._gl,e=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER),i=t.createProgram();if(t.shaderSource(e,n.vertexShader),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error("failed to compile vertex shader: "+t.getShaderInfoLog(e));if(t.shaderSource(r,this._povEmulation?n.fragmentShaderPov:n.fragmentShaderPlain),t.compileShader(r),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error("failed to compile fragment shader: "+t.getShaderInfoLog(r));if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("failed to link program: "+t.getProgramInfoLog(i));t.useProgram(i),this._program&&t.deleteProgram(this._program),this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._program=i,this._vertexShader=e,this._fragmentShader=r},e.prototype._allocateTextures=function(){for(var t=0;t<this._numberOfFramesToCompose;t++)this._allocateTexture(t)},e.prototype._configureTextures=function(){for(var t=0;t<this._numberOfFramesToCompose;t++)this._configureTexture(t)},e.prototype._allocateTexture=function(t){var e=this._gl,r=e.createTexture();e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,r),this._textures[t]=r},e.prototype._configureTexture=function(t){var e=this._gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,this._textures[t]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._interpolation?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._interpolation?e.LINEAR:e.NEAREST),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)},e.prototype._createBuffers=function(){var t=this._gl,e=t.createBuffer(),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),this._vertexBuffer=e,this._textureCoordinateBuffer=r},e.prototype._recalculateVertexBuffer=function(){var t,e,r,i,n=this._gl,s=this._canvas.width,a=this._canvas.height,o=0<s?2/s:1,u=0<a?2/a:1,c=[(r=this._aspect*a<=s?(e=2,t=this._aspect*a*o,i=1,Math.floor(-this._aspect*a)/2*o):(e=s/this._aspect*u,t=2,i=Math.floor(s/this._aspect)/2*u,-1))+t,i,r,i,r+t,i-e,r,i-e];n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(c),n.STATIC_DRAW)},e.prototype._getAttribLocation=function(t){var e=this._gl.getAttribLocation(this._program,t);if(e<0)throw new Error("unable to locate attribute "+t);return e},e.prototype._getUniformLocation=function(t){var e=this._gl.getUniformLocation(this._program,t);if(e<0)throw new Error("unable to locate uniform "+t);return e},e.prototype._setupAttribs=function(){var t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.enableVertexAttribArray(this._getAttribLocation("a_VertexPosition")),t.vertexAttribPointer(this._getAttribLocation("a_VertexPosition"),2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.enableVertexAttribArray(this._getAttribLocation("a_TextureCoordinate")),t.vertexAttribPointer(this._getAttribLocation("a_TextureCoordinate"),2,t.FLOAT,!1,0,0)},e}();r.default=i},{"./shader":63,tslib:6}],63:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.vertexShader="\n    attribute vec2 a_VertexPosition;\n    attribute vec2 a_TextureCoordinate;\n\n    varying vec2 v_TextureCoordinate;\n\n    void main() {\n        v_TextureCoordinate = a_TextureCoordinate;\n        gl_Position = vec4(a_VertexPosition, 0, 1);\n    }\n",r.fragmentShaderPlain="\n    precision mediump float;\n\n    varying vec2 v_TextureCoordinate;\n\n    uniform sampler2D u_Sampler0;\n    uniform float u_Gamma;\n\n    void main() {\n        vec4 texel = texture2D(u_Sampler0, v_TextureCoordinate);\n\n        gl_FragColor = vec4(pow(texel.rgb, vec3(u_Gamma)), 1.);\n    }\n",r.fragmentShaderPov="\n    precision mediump float;\n\n    varying vec2 v_TextureCoordinate;\n\n    uniform sampler2D u_Sampler0, u_Sampler1, u_Sampler2;\n    uniform float u_Gamma;\n\n    void main() {\n        vec4 compositedTexel =\n            0.4 * texture2D(u_Sampler0, v_TextureCoordinate) +\n            0.4 * texture2D(u_Sampler1, v_TextureCoordinate) +\n            0.2 * texture2D(u_Sampler2, v_TextureCoordinate);\n\n        gl_FragColor = vec4(pow(compositedTexel.rgb, vec3(u_Gamma)), 1.);\n    }\n"},{}],64:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./SwitchProxy"),n=function(){function t(){this._reset=new i.default,this._select=new i.default,this._difficultyPlayer1=new i.default,this._difficultyPlayer2=new i.default,this._color=new i.default,this._boundControlPanel=null}return t.prototype.bind=function(t){this.unbind(),this._boundControlPanel=t,this._reset.bind(this._boundControlPanel.getResetButton()),this._select.bind(this._boundControlPanel.getSelectSwitch()),this._difficultyPlayer1.bind(this._boundControlPanel.getDifficultySwitchP0()),this._difficultyPlayer2.bind(this._boundControlPanel.getDifficultySwitchP1()),this._color.bind(this._boundControlPanel.getColorSwitch()),this._difficultyPlayer1.toggle(!0),this._difficultyPlayer2.toggle(!0)},t.prototype.unbind=function(){this._boundControlPanel&&(this._reset.unbind(),this._select.unbind(),this._difficultyPlayer1.unbind(),this._difficultyPlayer2.unbind(),this._color.unbind(),this._boundControlPanel=null)},t.prototype.reset=function(){return this._reset},t.prototype.select=function(){return this._select},t.prototype.difficultyPlayer1=function(){return this._difficultyPlayer1},t.prototype.difficultyPlayer2=function(){return this._difficultyPlayer2},t.prototype.color=function(){return this._color},t}();r.default=n},{"./SwitchProxy":66}],65:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n,s,o=t("tslib"),a=t("async-mutex"),u=t("microevent.ts"),c=t("../../stella/service/EmulationServiceInterface"),l=t("../../stella/service/worker/EmulationService"),_=t("../../stella/service/DriverManager"),h=t("../../driver/SimpleCanvasVideo"),d=t("../../driver/webgl/WebglVideo"),p=t("../../stella/driver/WebAudio"),f=t("../../stella/driver/KeyboardIO"),m=t("../../stella/driver/TouchIO"),g=t("../../driver/MouseAsPaddle"),v=t("../../driver/Gamepad"),y=t("../../driver/FullscreenVideo"),b=t("../../../machine/stella/cartridge/CartridgeInfo"),w=t("../../../machine/stella/Config"),C=t("../../../tools/base64"),k=t("./ControlPanelProxy"),x=function(){function s(t,e,r){void 0===r&&(r={});var i=this;this._config=null,this._emulationService=null,this._serviceInitialized=null,this._videoDriver=null,this._webglVideo=null,this._fullscreenVideo=null,this._audioDriver=null,this._keyboardIO=null,this._touchIO=null,this._paddle=null,this._gamepad=null,this._controlPanel=new k.default,this._state=s.State.stopped,this._driverManager=new _.default,this._mutex=new a.Mutex,this._canvasElt=t,this._config=o.__assign({smoothScaling:!0,simulatePov:!0,gamma:1,audio:!0,volume:.5,enableKeyboard:!0,enableTouch:!0,touchLeftHanded:!1,touchJoystickSensitivity:15,keyboardTarget:document,fullscreenViaKeyboard:!0,paddleViaMouse:!0,pauseViaKeyboard:!0,pauseViaTouch:!0,fullscreenViaTouch:!0,enableGamepad:!0,resetViaKeyboard:!0},r),this._emulationService=new l.default(e),this.frequencyUpdate=this._emulationService.frequencyUpdate;var n=new u.Event;this._emulationService.stateChanged.addHandler(function(t){return n.dispatch(i._mapState(t))}),this.stateChange=n,this._createDrivers(),this._driverManager.addDriver(this._controlPanel,function(t){return i._controlPanel.bind(t.getControlPanel())}),this._driverManager.bind(this._emulationService),this._serviceInitialized=this._emulationService.init().then(void 0,function(t){throw console.log(t),t})}return s.prototype.setGamma=function(t){return this._webglVideo&&this._webglVideo.setGamma(t),this},s.prototype.getGamma=function(){return this._webglVideo?this._webglVideo.getGamma():1},s.prototype.enablePovSimulation=function(t){return this._webglVideo&&this._webglVideo.enablePovEmulation(t),this},s.prototype.isPovSimulationEnabled=function(){return!!this._webglVideo&&this._webglVideo.povEmulationEnabled()},s.prototype.enableSmoothScaling=function(t){return this._videoDriver.enableInterpolation(t),this},s.prototype.smoothScalingEnabled=function(){return this._videoDriver.interpolationEnabled()},s.prototype.toggleFullscreen=function(t){return void 0===t?this._fullscreenVideo.toggle():t?this._fullscreenVideo.engage():this._fullscreenVideo.disengage(),this},s.prototype.isFullscreen=function(){return this._fullscreenVideo.isEngaged()},s.prototype.setVolume=function(t){return this._audioDriver&&this._audioDriver.setMasterVolume(Math.max(Math.min(t,1),0)),this},s.prototype.audioEnabled=function(){return!!this._audioDriver},s.prototype.getVolume=function(){return this._audioDriver?this._audioDriver.getMasterVolume():0},s.prototype.resize=function(){return this._videoDriver.resize(),this},s.prototype.getState=function(){return this._state},s.prototype.getControlPanel=function(){return this._controlPanel},s.prototype.start=function(n,s,a){var t=this;return void 0===a&&(a={}),this._mutex.runExclusive(function(){return o.__awaiter(t,void 0,void 0,function(){var e,r,i;return o.__generator(this,function(t){switch(t.label){case 0:return"string"==typeof n&&(n=C.decode(n)),e=w.default.create({tvMode:this._convertTvMode(s),pcmAudio:!0}),void 0!==a.randomSeed&&0<a.randomSeed&&(e.randomSeed=a.randomSeed),void 0!==a.emulatePaddles&&(e.emulatePaddles=a.emulatePaddles),void 0!==a.frameStart&&(e.frameStart=a.frameStart),[4,this._serviceInitialized];case 1:return t.sent(),i=(r=this)._mapState,[4,this._emulationService.start(n,e,a.cartridgeType)];case 2:return[2,r._state=i.apply(this,[t.sent()])]}})})})},s.prototype.run=function(e,r,i){return void 0===i&&(i={}),o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(t){switch(t.label){case 0:return[4,this.start(e,r,i)];case 1:return t.sent()===s.State.paused?[2,this.resume()]:[2]}})})},s.prototype.pause=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,this._serviceInitialized];case 1:return t.sent(),[2,this._mutex.runExclusive(function(){return o.__awaiter(e,void 0,void 0,function(){var e,r;return o.__generator(this,function(t){switch(t.label){case 0:return r=(e=this)._mapState,[4,this._emulationService.pause()];case 1:return[2,e._state=r.apply(this,[t.sent()])]}})})})]}})})},s.prototype.resume=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,this._serviceInitialized];case 1:return t.sent(),[2,this._mutex.runExclusive(function(){return o.__awaiter(e,void 0,void 0,function(){var e,r;return o.__generator(this,function(t){switch(t.label){case 0:return r=(e=this)._mapState,[4,this._emulationService.resume()];case 1:return[2,e._state=r.apply(this,[t.sent()])]}})})})]}})})},s.prototype.stop=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,this._serviceInitialized];case 1:return t.sent(),[2,this._mutex.runExclusive(function(){return o.__awaiter(e,void 0,void 0,function(){var e,r;return o.__generator(this,function(t){switch(t.label){case 0:return r=(e=this)._mapState,[4,this._emulationService.stop()];case 1:return[2,e._state=r.apply(this,[t.sent()])]}})})})]}})})},s.prototype.reset=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,this._serviceInitialized];case 1:return t.sent(),[2,this._mutex.runExclusive(function(){return o.__awaiter(e,void 0,void 0,function(){var e,r;return o.__generator(this,function(t){switch(t.label){case 0:return r=(e=this)._mapState,[4,this._emulationService.reset()];case 1:return[2,e._state=r.apply(this,[t.sent()])]}})})})]}})})},s.prototype.lastError=function(){return this._emulationService.getLastError()},s.prototype._convertTvMode=function(t){switch(t){case s.TvMode.ntsc:return 0;case s.TvMode.pal:return 1;case s.TvMode.secam:return 2;default:throw new Error("invalid TV mode '"+t+"'")}},s.prototype._createDrivers=function(){var e=this;try{this._webglVideo=this._videoDriver=new d.default(this._canvasElt,{povEmulation:this._config.simulatePov,gamma:this._config.gamma}).init()}catch(t){this._webglVideo=null,this._videoDriver=new h.default(this._canvasElt).init()}if(this._videoDriver.enableInterpolation(this._config.smoothScaling),this._driverManager.addDriver(this._videoDriver,function(t){return e._videoDriver.bind(t.getVideo())}),this._fullscreenVideo=new y.default(this._videoDriver),this._config.audio)try{this._audioDriver=new p.default,this._audioDriver.init(),this._audioDriver.setMasterVolume(this._config.volume),this._driverManager.addDriver(this._audioDriver,function(t){return e._audioDriver.bind(!0,[t.getPCMChannel()])})}catch(t){console.error("failed to initialize audio: "+(t&&t.message))}var t=function(){switch(e._emulationService.getState()){case c.default.State.paused:e.resume();break;case c.default.State.running:e.pause()}};this._config.enableKeyboard&&(this._keyboardIO=new f.default(this._config.keyboardTarget),this._driverManager.addDriver(this._keyboardIO,function(t){return e._keyboardIO.bind(t.getJoystick(0),t.getJoystick(1),t.getControlPanel())}),this._config.fullscreenViaKeyboard&&this._keyboardIO.toggleFullscreen.addHandler(function(){return e._fullscreenVideo.toggle()}),this._config.pauseViaKeyboard&&this._keyboardIO.togglePause.addHandler(t)),this._config.resetViaKeyboard&&this._keyboardIO.hardReset.addHandler(function(){return e.reset()}),this._config.enableTouch&&(this._touchIO=new m.default(this._canvasElt,this._config.touchJoystickSensitivity,this._config.touchLeftHanded),this._driverManager.addDriver(this._touchIO,function(t){return e._touchIO.bind(t.getJoystick(0),t.getControlPanel())}),this._config.pauseViaTouch&&this._touchIO.togglePause.addHandler(t),this._config.fullscreenViaTouch&&this._touchIO.toggleFullscreen.addHandler(function(){return e._fullscreenVideo.toggle()})),this._config.enableGamepad&&(this._gamepad=new v.default,this._gamepad.init(),this._driverManager.addDriver(this._gamepad,function(t){return e._gamepad.bind({joysticks:[t.getJoystick(0),t.getJoystick(1)],start:t.getControlPanel().getResetButton(),select:t.getControlPanel().getSelectSwitch()})})),this._config.paddleViaMouse&&(this._paddle=new g.default,this._driverManager.addDriver(this._paddle,function(t){return e._paddle.bind(t.getPaddle(0))}))},s.prototype._mapState=function(t){switch(t){case c.default.State.stopped:return s.State.stopped;case c.default.State.running:return s.State.running;case c.default.State.paused:return s.State.paused;case c.default.State.error:return s.State.error;default:throw new Error("cannot happen")}},s}();r.default=x,i=x||(x={}),(n=i.TvMode||(i.TvMode={})).ntsc="ntsc",n.pal="pal",n.secam="secam",i.CartridgeType=b.default.CartridgeType,i.describeCartridgeType=b.default.describeCartridgeType,i.allCartridgeTypes=b.default.getAllTypes,(s=i.State||(i.State={})).running="running",s.paused="paused",s.stopped="stopped",s.error="error",r.default=x},{"../../../machine/stella/Config":44,"../../../machine/stella/cartridge/CartridgeInfo":46,"../../../tools/base64":50,"../../driver/FullscreenVideo":54,"../../driver/Gamepad":55,"../../driver/MouseAsPaddle":56,"../../driver/SimpleCanvasVideo":57,"../../driver/webgl/WebglVideo":62,"../../stella/driver/KeyboardIO":68,"../../stella/driver/TouchIO":69,"../../stella/driver/WebAudio":70,"../../stella/service/DriverManager":72,"../../stella/service/EmulationServiceInterface":73,"../../stella/service/worker/EmulationService":76,"./ControlPanelProxy":64,"async-mutex":2,"microevent.ts":4,tslib:6}],66:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=function(){function e(){this.stateChange=new i.Event,this._state=!1,this._boundSwitch=null}return e.prototype.bind=function(t){this.unbind(),this._boundSwitch=t,this._boundSwitch.toggle(this._state),this._boundSwitch.stateChanged.addHandler(e._onBoundStateChange,this),this._setState(this._boundSwitch.read())},e.prototype.unbind=function(){this._boundSwitch&&(this._boundSwitch.stateChanged.removeHandler(e._onBoundStateChange,this),this._boundSwitch=null)},e.prototype.toggle=function(t){return this._boundSwitch?this._boundSwitch.toggle(t):this._setState(t),this},e.prototype.read=function(){return this._state},e._onBoundStateChange=function(t,e){e._setState(t)},e.prototype._setState=function(t){t!==this._state&&(this._state=t,this.stateChange.dispatch(this._state))},e}();r.default=n},{"microevent.ts":4}],67:[function(t,e,r){"use strict";var i=t("./Stellerator");e.exports={Stellerator:i.default}},{"./Stellerator":65}],68:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("tslib"),i=t("microevent.ts");function n(t){return{type:0,swtch:t}}function s(t){return{type:1,trigger:t}}var a=function(){function r(t,e){void 0===e&&(e=r.defaultMappings),this._target=t,this.toggleFullscreen=new i.Event,this.hardReset=new i.Event,this.togglePause=new i.Event,this._keydownListener=null,this._keyupListener=null,this._joystick0=null,this._joystick1=null,this._controlPanel=null,this._dispatchTable={},this._compiledMappings=new Map,this._compileMappings(e)}return r.prototype.bind=function(t,e,r){var o=this;this._joystick0||(this._joystick0=t,this._joystick1=e,this._controlPanel=r,this._updateActionTable(),this._keydownListener=function(t){if(o._compiledMappings.has(t.keyCode)){var e=(t.shiftKey?4:0)|(t.ctrlKey?1:0)|(t.altKey?2:0);if(o._compiledMappings.get(t.keyCode).has(e)){var r=o._compiledMappings.get(t.keyCode).get(e);if(void 0!==r){t.preventDefault();var i=o._dispatchTable[r];switch(i.type){case 0:i.swtch.toggle(!0);break;case 1:i.trigger.dispatch(void 0)}}}}},this._keyupListener=function(t){var e,r;if(o._compiledMappings.has(t.keyCode))try{for(var i=u.__values(o._compiledMappings.get(t.keyCode).values()),n=i.next();!n.done;n=i.next()){var s=n.value;t.preventDefault();var a=o._dispatchTable[s];switch(a.type){case 0:a.swtch.toggle(!1)}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},this._target.addEventListener("keydown",this._keydownListener),this._target.addEventListener("keyup",this._keyupListener))},r.prototype.unbind=function(){this._joystick0&&(this._target.removeEventListener("keydown",this._keydownListener),this._target.removeEventListener("keyup",this._keyupListener),this._joystick0=this._joystick1=this._controlPanel=null,this._keydownListener=this._keyupListener=null)},r.prototype._updateActionTable=function(){this._dispatchTable[12]=s(this.toggleFullscreen),this._dispatchTable[13]=s(this.hardReset),this._dispatchTable[14]=s(this.togglePause),this._dispatchTable[0]=n(this._controlPanel.getSelectSwitch()),this._dispatchTable[1]=n(this._controlPanel.getResetButton()),this._dispatchTable[2]=n(this._joystick0.getLeft()),this._dispatchTable[3]=n(this._joystick0.getRight()),this._dispatchTable[4]=n(this._joystick0.getUp()),this._dispatchTable[5]=n(this._joystick0.getDown()),this._dispatchTable[10]=n(this._joystick0.getFire()),this._dispatchTable[6]=n(this._joystick1.getLeft()),this._dispatchTable[7]=n(this._joystick1.getRight()),this._dispatchTable[8]=n(this._joystick1.getUp()),this._dispatchTable[9]=n(this._joystick1.getDown()),this._dispatchTable[11]=n(this._joystick1.getFire())},r.prototype._compileMappings=function(t){var i=this;t.forEach(function(t){var e=t.action;(Array.isArray(t.spec)?t.spec:[t.spec]).forEach(function(t){return function(t,e,r){if(0!=(-8&r))throw new Error("invalid modifier set "+r);i._compiledMappings.has(e)||i._compiledMappings.set(e,new Map),i._compiledMappings.get(e).set(r,t)}(e,"object"==typeof t?t.keycode:t,"object"==typeof t?t.modifiers:0)})})},r}();((r.default=a)||(a={})).defaultMappings=[{action:0,spec:{keycode:32,modifiers:4}},{action:1,spec:{keycode:13,modifiers:4}},{action:2,spec:[65,37]},{action:3,spec:[68,39]},{action:4,spec:[87,38]},{action:5,spec:[83,40]},{action:10,spec:[32,86]},{action:6,spec:74},{action:7,spec:76},{action:8,spec:73},{action:9,spec:75},{action:11,spec:66},{action:12,spec:13},{action:13,spec:{keycode:82,modifiers:4}},{action:14,spec:80}],r.default=a},{"microevent.ts":4,tslib:6}],69:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=t("./touch/DoubleTapDetector"),s=function(){function t(t,e,r){void 0===e&&(e=15),void 0===r&&(r=!1);var _=this;this._canvas=t,this._joystickSensitivity=e,this._leftHanded=r,this._onTouchStart=function(t){for(var e=!1,r=0;r<t.changedTouches.length;r++){var i=new a(t.changedTouches.item(r),_._canvas),n=i.touch.identifier;if((_._leftHanded?.5<i.x:i.x<=.5)?i.y<=.5?i.type="alt":i.type=_._isAlt?"pause":"fire":i.y<=.5?i.type=_._isAlt?"select":"joystick":i.type=_._isAlt?"reset":"joystick",!_._pendingTouches.has(n)&&!_._pendingTouches.has(i.type)){switch(_._pendingTouches.set(n,i),_._pendingTouches.set(i.type,i),i.type){case"alt":_._isAlt=!0,_._fullscreenDoubleTapDetector.startTouch();break;case"fire":_._joystick.getFire().toggle(!0);break;case"pause":_.togglePause.dispatch(void 0),_._fullscreenDoubleTapDetector.cancelTouch();break;case"select":_._select.toggle(!0),_._fullscreenDoubleTapDetector.cancelTouch();break;case"reset":_._reset.toggle(!0),_._fullscreenDoubleTapDetector.cancelTouch();break;case"joystick":break;default:throw new Error("invalid touch type")}(_._cancelEvent(i)||_._fullscreenDoubleTapDetector.isDispatching())&&(e=!0)}}e&&t.preventDefault()},this._onTouchEnd=function(t){for(var e=!1,r=0;r<t.changedTouches.length;r++){var i=_._pendingTouches.get(t.changedTouches.item(r).identifier);if(i){switch((_._cancelEvent(i)||_._fullscreenDoubleTapDetector.isDispatching())&&(e=!0),i.type){case"alt":_._isAlt=!1,_._fullscreenDoubleTapDetector.endTouch();break;case"fire":_._joystick.getFire().toggle(!1);break;case"select":_._select.toggle(!1);break;case"reset":_._reset.toggle(!1);break;case"joystick":_._joystick.getDown().toggle(!1),_._joystick.getUp().toggle(!1),_._joystick.getLeft().toggle(!1),_._joystick.getRight().toggle(!1);break;case"pause":break;default:throw new Error("invalid touch type")}_._pendingTouches.delete(i.type),_._pendingTouches.delete(i.touch.identifier)}}e&&t.preventDefault()},this._onTouchMove=function(t){for(var e=!1,r=0;r<t.changedTouches.length;r++){var i=t.changedTouches.item(r),n=_._pendingTouches.get(i.identifier);if(n&&(_._cancelEvent(n)&&(e=!0),"joystick"===n.type)){var s=i.clientX-n.touch.clientX,a=i.clientY-n.touch.clientY,o=Math.sqrt(s*s+a*a),u=Math.abs(a/o),c=Math.abs(s/o),l=o>_._joystickSensitivity;_._joystick.getLeft().toggle(l&&s<0&&.5<c),_._joystick.getRight().toggle(l&&0<s&&.5<c),_._joystick.getUp().toggle(l&&a<0&&.5<u),_._joystick.getDown().toggle(l&&0<a&&.5<u)}}e&&t.preventDefault()},this.togglePause=new i.Event,this._fullscreenDoubleTapDetector=new n.default,this._bound=!1,this._joystick=null,this._select=null,this._reset=null,this._isAlt=!1,this._pendingTouches=new Map,this.toggleFullscreen=this._fullscreenDoubleTapDetector.trigger}return t.prototype.bind=function(t,e){this._bound||(this._bound=!0,this._joystick=t,this._select=e.getSelectSwitch(),this._reset=e.getResetButton(),this._bindListeners())},t.prototype.unbind=function(){this._bound&&(this._unbindListeners(),this._bound=!1,this._joystick=this._reset=this._select=null)},t.prototype._bindListeners=function(){this._canvas.addEventListener("touchstart",this._onTouchStart),this._canvas.addEventListener("touchend",this._onTouchEnd),this._canvas.addEventListener("touchmove",this._onTouchMove)},t.prototype._unbindListeners=function(){this._canvas.removeEventListener("touchstart",this._onTouchStart),this._canvas.removeEventListener("touchend",this._onTouchEnd),this._canvas.removeEventListener("touchmove",this._onTouchMove)},t.prototype._cancelEvent=function(t){return"alt"!==t.type},t}(),a=function(t,e){this.touch=t,this.type="unknown";var r=e.getBoundingClientRect();this.x=(t.clientX-r.left)/r.width,this.y=(t.clientY-r.top)/r.height};r.default=s},{"./touch/DoubleTapDetector":71,"microevent.ts":4}],70:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("../../driver/WebAudio"),s=function(){function t(t){this._fragmentSize=t,this._pcmAudio=!1,this._volume=1}return t.prototype.init=function(){},t.prototype.bind=function(t,e){if(!this._channels){this._channels=i.__spread(e),this._driver&&this._pcmAudio===t||(this._driver&&this._driver.close(),this._driver=t?new n.default(0,this._channels.length,this._fragmentSize):new n.default(this._channels.length,0,this._fragmentSize),this._driver.init()),t?this._driver.bind([],this._channels):this._driver.bind(this._channels,[]);for(var r=0;r<this._channels.length;r++)this._driver.setMasterVolume(r,this._volume);this._pcmAudio=t}},t.prototype.unbind=function(){this._channels&&(this._driver.unbind(),this._channels=null)},t.prototype.setMasterVolume=function(t){if(this._volume=t,this._channels)for(var e=0;e<this._channels.length;e++)this._driver.setMasterVolume(e,this._volume)},t.prototype.getMasterVolume=function(){return this._volume},t.prototype.pause=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this._driver?[4,this._driver.pause()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.resume=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this._driver?[4,this._driver.resume()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t}();r.default=s},{"../../driver/WebAudio":58,tslib:6}],71:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("microevent.ts"),n=function(){function t(t,e){void 0===t&&(t=500),void 0===e&&(e=200),this._maxTapLength=t,this._timeout=e,this.trigger=new i.Event,this._dispatch=!1,this._touching=!1,this._lastTouchEligible=!1,this._lastTouchStart=0,this._lastTouchEnd=0}return t.prototype.startTouch=function(){this._lastTouchStart=Date.now(),this._touching||(this._touching=!0,this._dispatch=this._lastTouchEligible&&this._lastTouchStart-this._lastTouchEnd<this._timeout)},t.prototype.endTouch=function(){this._lastTouchEnd=Date.now(),this._dispatch&&(this._dispatch=!1,this.trigger.dispatch(void 0)),this._touching&&(this._touching=!1,this._lastTouchEligible=this._lastTouchStart-this._lastTouchEnd<this._maxTapLength)},t.prototype.cancelTouch=function(){this.endTouch(),this._lastTouchEligible=!1},t.prototype.isDispatching=function(){return this._dispatch},t}();r.default=n},{"microevent.ts":4}],72:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n=t("./EmulationServiceInterface"),s=function(){function r(){this._drivers=new Map,this._driversBound=!1}return r.prototype.bind=function(t){return this._driversBound||(this._emulationService=t,this._shouldBindDrivers()&&this._bindDrivers(),this._emulationService.stateChanged.addHandler(r._onEmuStateChange,this)),this},r.prototype.unbind=function(){return this._emulationService&&(this._unbindDrivers(),this._emulationService.stateChanged.removeHandler(r._onEmuStateChange,this),this._emulationService=null),this},r.prototype.addDriver=function(t,e){return this._drivers.set(t,new r.DriverContext(t,e)),this._driversBound&&e(this._emulationService.getEmulationContext(),t),this},r.prototype.removeDriver=function(t){return this._drivers.get(t)&&(t.unbind(),this._drivers.delete(t)),this},r._onEmuStateChange=function(t,e){e._shouldBindDrivers(t)?e._bindDrivers():e._unbindDrivers()},r.prototype._shouldBindDrivers=function(t){return void 0===t&&(t=this._emulationService?this._emulationService.getState():void 0),this._emulationService&&(t===n.default.State.running||t===n.default.State.paused)},r.prototype._bindDrivers=function(){var e=this;this._driversBound||(this._drivers.forEach(function(t){return t.binder(e._emulationService.getEmulationContext(),t.driver)}),this._driversBound=!0)},r.prototype._unbindDrivers=function(){this._driversBound&&(this._drivers.forEach(function(t){return t.driver.unbind()}),this._driversBound=!1)},r}();r.default=s,i=function(t,e){this.driver=t,this.binder=e},(s||(s={})).DriverContext=i,r.default=s},{"./EmulationServiceInterface":73}],73:[function(t,e,r){"use strict";var i,n,s;Object.defineProperty(r,"__esModule",{value:!0}),n=i||(i={}),(s=n.State||(n.State={}))[s.stopped=0]="stopped",s[s.running=1]="running",s[s.paused=2]="paused",s[s.error=3]="error",r.default=i},{}],74:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../../machine/io/DigitalJoystick"),n=t("../../../../machine/stella/ControlPanel"),s=t("../../../../machine/io/Paddle"),a=t("./messages"),o=function(){function t(t){this._rpc=t,this._joysticks=new Array(2),this._paddles=new Array(4),this._controlPanel=new n.default;for(var e=0;e<2;e++)this._joysticks[e]=new i.default;for(e=0;e<4;e++)this._paddles[e]=new s.default}return t.prototype.sendUpdate=function(){this._rpc.signal(a.SIGNAL_TYPE.controlStateUpdate,{joystickState:this._joysticks.map(t._joystickState),paddleState:this._paddles.map(t._paddleState),controlPanelState:t._controlPanelState(this._controlPanel)})},t.prototype.getJoystick=function(t){if(t<0||1<t)throw new Error("invalid joystick index "+t);return this._joysticks[t]},t.prototype.getControlPanel=function(){return this._controlPanel},t.prototype.getPaddle=function(t){if(t<0||3<t)throw new Error("invalid paddle index "+t);return this._paddles[t]},t._joystickState=function(t){return{up:t.getUp().read(),down:t.getDown().read(),left:t.getLeft().read(),right:t.getRight().read(),fire:t.getFire().read()}},t._paddleState=function(t){return{value:t.getValue(),fire:t.getFire().read()}},t._controlPanelState=function(t){return{difficulty0:t.getDifficultySwitchP0().read(),difficulty1:t.getDifficultySwitchP1().read(),select:t.getSelectSwitch().read(),reset:t.getResetButton().read(),color:t.getColorSwitch().read()}},t}();r.default=o},{"../../../../machine/io/DigitalJoystick":41,"../../../../machine/io/Paddle":42,"../../../../machine/stella/ControlPanel":45,"./messages":80}],75:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e,r,i){if(this._videoProxy=t,this._controlProxy=e,this._waveformChannels=r,this._pcmChannel=i,this._config=null,2!==this._waveformChannels.length)throw new Error("invalid channel count "+this._waveformChannels.length)}return t.prototype.setConfig=function(t){this._config=t},t.prototype.getConfig=function(){return this._config},t.prototype.getVideo=function(){return this._videoProxy},t.prototype.getJoystick=function(t){return this._controlProxy.getJoystick(t)},t.prototype.getControlPanel=function(){return this._controlProxy.getControlPanel()},t.prototype.getPaddle=function(t){return this._controlProxy.getPaddle(t)},t.prototype.getWaveformChannels=function(){return this._waveformChannels},t.prototype.getPCMChannel=function(){return this._pcmChannel},t.prototype.getVideoProxy=function(){return this._videoProxy},t}();r.default=i},{}],76:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("tslib"),i=t("microevent.ts"),n=t("worker-rpc"),o=t("../EmulationServiceInterface"),s=t("./EmulationContext"),u=t("./VideoProxy"),c=t("./ControlProxy"),l=t("./WaveformAudioProxy"),_=t("./PCMAudioProxy"),h=t("async-mutex"),d=t("./messages"),p=function(){function t(t,e){this._stellaWorkerUri=t,this._videoWorkerUri=e,this.stateChanged=new i.Event,this.frequencyUpdate=new i.Event,this._rateLimitEnforced=!0,this._mutex=new h.Mutex,this._worker=null,this._rpc=null,this._state=o.default.State.stopped,this._lastError=null,this._emulationContext=null,this._frequency=0,this._waveformChannels=new Array(2),this._pcmChannel=null,this._controlProxy=null,this._controlProxyUpdateHandle=null,this._proxyState=0,this._saveConfig=null}return t.prototype.init=function(){var r=this;this._worker=new Worker(this._stellaWorkerUri),this._rpc=new n.RpcProvider(function(t,e){return r._worker.postMessage(t,e)}),this._pcmChannel=new _.default(0,this._rpc).init();for(var t=0;t<2;t++)this._waveformChannels[t]=new l.default(t,this._rpc).init();var e=new u.default(this._rpc),i=new c.default(this._rpc);return e.init(),this._emulationContext=new s.default(e,i,this._waveformChannels,this._pcmChannel),this._worker.onmessage=function(t){return r._rpc.dispatch(t.data)},this._rpc.registerSignalHandler(d.SIGNAL_TYPE.emulationFrequencyUpdate,this._onFrequencyUpdate.bind(this)).registerSignalHandler(d.SIGNAL_TYPE.emulationError,this._onEmulationError.bind(this)),this._controlProxy=i,this._startVideoProcessingPipeline().then(function(){return r.setRateLimit(r._rateLimitEnforced)})},t.prototype.start=function(r,i,n,s){return a.__awaiter(this,void 0,void 0,function(){var e=this;return a.__generator(this,function(t){switch(t.label){case 0:return[4,this.stop()];case 1:return t.sent(),[2,this._mutex.runExclusive(function(){return a.__awaiter(e,void 0,void 0,function(){var e;return a.__generator(this,function(t){switch(t.label){case 0:return[4,this._rpc.rpc(d.RPC_TYPE.emulationStart,{buffer:r,config:i,cartridgeType:n,videoProcessing:s})];case 1:return(e=t.sent())!==o.default.State.paused?[3,3]:(this._saveConfig=i,this._emulationContext.setConfig(i),[4,this._startProxies(i)]);case 2:return t.sent(),[3,4];case 3:this._saveConfig=null,t.label=4;case 4:return[2,this._applyState(e)]}})})})]}})})},t.prototype.pause=function(){var e=this;return this._mutex.runExclusive(function(){return e._rpc.rpc(d.RPC_TYPE.emulationPause).then(function(t){return e._pauseProxies(),e._applyState(t)})})},t.prototype.stop=function(){var e=this;return this._mutex.runExclusive(function(){return e._rpc.rpc(d.RPC_TYPE.emulationStop).then(function(t){return e._stopProxies(),e._applyState(t)})})},t.prototype.reset=function(){var t=this;return this._mutex.runExclusive(function(){return a.__awaiter(t,void 0,void 0,function(){var e;return a.__generator(this,function(t){switch(t.label){case 0:return[4,this._rpc.rpc(d.RPC_TYPE.emulationReset)];case 1:return e=t.sent(),this._state!==o.default.State.error||e!==o.default.State.running&&e!==o.default.State.paused||!this._saveConfig?[3,3]:[4,this._startProxies(this._saveConfig)];case 2:t.sent(),t.label=3;case 3:return[2,this._applyState(e)]}})})})},t.prototype.resume=function(){var e=this;return this._mutex.runExclusive(function(){return e._rpc.rpc(d.RPC_TYPE.emulationResume).then(function(t){return e._resumeProxies(),e._applyState(t)})})},t.prototype.setRateLimit=function(t){return this._rateLimitEnforced=t,this._rpc.rpc(d.RPC_TYPE.emulationSetRateLimit,t)},t.prototype.getFrequency=function(){return this._frequency},t.prototype.getRateLimit=function(){return this._rateLimitEnforced},t.prototype.getState=function(){return this._state},t.prototype.getLastError=function(){return this._lastError},t.prototype.getEmulationContext=function(){switch(this._state){case o.default.State.running:case o.default.State.paused:return this._emulationContext;default:return null}},t.prototype._fetchLastError=function(){return this._rpc.rpc(d.RPC_TYPE.emulationFetchLastError).then(function(t){return t?new Error(t):null})},t.prototype._applyState=function(e){var r=this;return e===o.default.State.error?this._fetchLastError().then(function(t){return r._state=e,r._lastError=t,r._stopProxies(),r.stateChanged.dispatch(e),e}):(this._state=e,this.stateChanged.dispatch(e),e)},t.prototype._onFrequencyUpdate=function(t){this._frequency=t,this.frequencyUpdate.dispatch(this._frequency)},t.prototype._onEmulationError=function(t){this._lastError=new Error(t||""),this._stopProxies(),this._state=o.default.State.error,this.stateChanged.dispatch(this._state)},t.prototype._startProxies=function(r){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(t){switch(t.label){case 0:return[4,this._emulationContext.getVideoProxy().start()];case 1:t.sent(),e=0,t.label=2;case 2:return e<this._waveformChannels.length?[4,this._waveformChannels[e].start(r)]:[3,5];case 3:t.sent(),t.label=4;case 4:return e++,[3,2];case 5:return[4,this._pcmChannel.start()];case 6:return t.sent(),this._startControlUpdates(),this._proxyState=1,[2]}})})},t.prototype._stopProxies=function(){0!==this._proxyState&&(this._emulationContext.getVideoProxy().stop(),this._pcmChannel.stop(),this._stopControlUpdates(),this._proxyState=0)},t.prototype._pauseProxies=function(){1===this._proxyState&&(this._stopControlUpdates(),this._proxyState=2)},t.prototype._resumeProxies=function(){2===this._proxyState&&(this._startControlUpdates(),this._proxyState=1)},t.prototype._startControlUpdates=function(){var t=this;null===this._controlProxyUpdateHandle&&(this._controlProxyUpdateHandle=setInterval(function(){return t._controlProxy.sendUpdate()},25))},t.prototype._stopControlUpdates=function(){null!==this._controlProxyUpdateHandle&&(clearInterval(this._controlProxyUpdateHandle),this._controlProxyUpdateHandle=null)},t.prototype._startVideoProcessingPipeline=function(){return a.__awaiter(this,void 0,void 0,function(){var e,r,i;return a.__generator(this,function(t){switch(t.label){case 0:return e=null,this._videoWorkerUri?(e=new MessageChannel,r=new Worker(this._videoWorkerUri),i=new n.RpcProvider(function(t,e){return r.postMessage(t,e)}),r.onmessage=function(t){return i.dispatch(t.data)},[4,i.rpc("/use-port",e.port1,[e.port1])]):[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this._rpc.rpc(d.RPC_TYPE.setup,{videoProcessorPort:e&&e.port2},e?[e.port2]:[])];case 3:return t.sent(),[2]}})})},t}();r.default=p},{"../EmulationServiceInterface":73,"./ControlProxy":74,"./EmulationContext":75,"./PCMAudioProxy":77,"./VideoProxy":78,"./WaveformAudioProxy":79,"./messages":80,"async-mutex":2,"microevent.ts":4,tslib:6,"worker-rpc":8}],77:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("microevent.ts"),s=t("../../../../tools/pool/Pool"),a=t("./messages"),o=function(){function r(t,e){this._index=t,this._rpc=e,this.newFrame=new n.Event,this.togglePause=new n.Event,this._sampleRate=0,this._frameSize=0,this._paused=!1,this._framePool=new s.default(function(){return null}),this._frameMap=new WeakMap,this._enabled=!1,this._signalReturnFrame="",this._framePool.event.release.addHandler(r._onReleaseFragment,this),this._signalReturnFrame=a.SIGNAL_TYPE.pcmAudioReturnFrame(this._index)}return r.prototype.init=function(){return this._rpc.registerSignalHandler(a.SIGNAL_TYPE.pcmAudioNewFrame(this._index),this._onNewFrame.bind(this)).registerSignalHandler(a.SIGNAL_TYPE.pcmAudioTogglePause(this._index),this._onTogglePause.bind(this)),this},r.prototype.start=function(){return i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(t){switch(t.label){case 0:return this._enabled?[2]:[4,this._rpc.rpc(a.RPC_TYPE.getPCMAudioParameters(this._index))];case 1:return e=t.sent(),this._sampleRate=e.sampleRate,this._frameSize=e.frameSize,this._paused=e.paused,this._enabled=!0,[2]}})})},r.prototype.stop=function(){this._enabled=!1},r.prototype.isPaused=function(){return this._paused},r.prototype.getSampleRate=function(){return this._sampleRate},r.prototype.getFrameSize=function(){return this._frameSize},r._onReleaseFragment=function(t,e){e._frameMap.has(t)&&e._rpc.signal(e._signalReturnFrame,{id:e._frameMap.get(t),buffer:t.buffer},[t.buffer])},r.prototype._onNewFrame=function(t){if(this._enabled){var e=this._framePool.get(),r=new Float32Array(t.buffer);e.adopt(r),this._frameMap.set(r,t.id),this.newFrame.dispatch(e)}},r.prototype._onTogglePause=function(t){t.paused!==this._paused&&(this._paused=t.paused,this.togglePause.dispatch(this._paused))},r}();r.default=o},{"../../../../tools/pool/Pool":52,"./messages":80,"microevent.ts":4,tslib:6}],78:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("microevent.ts"),s=t("./messages"),a=function(){function t(t){this._rpc=t,this.newFrame=new n.Event,this._active=!1,this._width=0,this._height=0,this._ids=null}return t.prototype.init=function(){this._rpc.registerSignalHandler(s.SIGNAL_TYPE.videoNewFrame,this._onNewFrame.bind(this))},t.prototype.start=function(){return i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(t){switch(t.label){case 0:return this._active&&this.stop(),[4,this._rpc.rpc(s.RPC_TYPE.getVideoParameters)];case 1:return e=t.sent(),this._active=!0,this._width=e.width,this._height=e.height,this._ids=new Set,[2]}})})},t.prototype.stop=function(){this._active=!1,this._ids=null},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype._onNewFrame=function(t){var e=this;if(this._active)if(this._width===t.width&&this._height===t.height){this._ids.add(t.id);var r=new ImageData(new Uint8ClampedArray(t.buffer),t.width,t.height);this.newFrame.dispatch({get:function(){return r},release:function(){e._active&&e._ids.has(t.id)&&e._rpc.signal(s.SIGNAL_TYPE.videoReturnSurface,{id:t.id,buffer:t.buffer},[t.buffer])},dispose:function(){},adopt:function(){throw new Error("adopt is not implemented")}})}else console.warn("surface dimensions do not match; ignoring frame");else console.warn("video proxy deactivated: ignoring frame")},t}();r.default=a},{"./messages":80,"microevent.ts":4,tslib:6}],79:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("tslib"),n=t("microevent.ts"),s=t("../../../../machine/stella/tia/ToneGenerator"),a=t("./messages"),o=function(){function t(t,e){this._index=t,this._rpc=e,this.bufferChanged=new n.Event,this.volumeChanged=new n.Event,this.stop=new n.Event,this._toneGenerator=new s.default,this._volume=0}return t.prototype.init=function(){return this._rpc.registerSignalHandler(a.SIGNAL_TYPE.waveformAudioBufferChange,this._onBufferChangeSignal.bind(this)).registerSignalHandler(a.SIGNAL_TYPE.waveformAudioVolumeChange,this._onVolumeChangeSignal.bind(this)).registerSignalHandler(a.SIGNAL_TYPE.audioStop,this._onStopSignal.bind(this)),this},t.prototype.start=function(r){return i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(t){switch(t.label){case 0:return[4,this._rpc.rpc(a.RPC_TYPE.getWaveformAudioParameters(this._index))];case 1:return e=t.sent(),this._toneGenerator.setConfig(r),this.setVolume(e.volume),[2]}})})},t.prototype.setVolume=function(t){return this._volume=t,this},t.prototype.getVolume=function(){return this._volume},t.prototype.getBuffer=function(t){return this._toneGenerator.getBuffer(t)},t.prototype._onVolumeChangeSignal=function(t){t.index===this._index&&(this._volume=t.value,this.volumeChanged.dispatch(this._volume))},t.prototype._onBufferChangeSignal=function(t){t.index===this._index&&this.bufferChanged.dispatch(t.key)},t.prototype._onStopSignal=function(t){t===this._index&&this.stop.dispatch(void 0)},t}();r.default=o},{"../../../../machine/stella/tia/ToneGenerator":47,"./messages":80,"microevent.ts":4,tslib:6}],80:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RPC_TYPE={emulationPause:"emulation/pause",emulationReset:"emulation/reset",emulationResume:"emulation/resume",emulationSetRateLimit:"emulation/setRateLimit",emulationStart:"emulation/start",emulationStop:"emulation/stop",emulationFetchLastError:"emulation/fetchLastError",getVideoParameters:"video/getParameters",getWaveformAudioParameters:function(t){return"audio/waveform/getParameters/"+t},getPCMAudioParameters:function(t){return"audio/pcm/getParameters/"+t},setup:"/setup"},Object.freeze(r.RPC_TYPE),r.SIGNAL_TYPE={emulationError:"emulation/error",emulationFrequencyUpdate:"emulation/frequencyUpdate",videoNewFrame:"video/newFrame",videoReturnSurface:"video/returnSurface",controlStateUpdate:"control/stateUpdate",waveformAudioVolumeChange:"audio/waveform/volumeChange",waveformAudioBufferChange:"audio/waveform/bufferChange",pcmAudioNewFrame:function(t){return"audio/pcm/newFrame/"+t},pcmAudioTogglePause:function(t){return"audio/pcm/togglePause/"+t},pcmAudioReturnFrame:function(t){return"audio/pcm/returnFrame/"+t},audioStop:"audio/stop"},Object.freeze(r.SIGNAL_TYPE)},{}]},{},[67])(67)});
//# sourceMappingURL=stellerator_embedded.min.js.map