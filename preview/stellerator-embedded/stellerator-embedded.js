!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.$6502=e():t.$6502=e()}(self,(()=>(()=>{"use strict";var t={5078:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=i(655),r=i(2403),a=function(){function t(t){this._semaphore=new r.default(1,t)}return t.prototype.acquire=function(){return s.__awaiter(this,void 0,void 0,(function(){return s.__generator(this,(function(t){switch(t.label){case 0:return[4,this._semaphore.acquire()];case 1:return[2,t.sent()[1]]}}))}))},t.prototype.runExclusive=function(t){return this._semaphore.runExclusive((function(){return t()}))},t.prototype.isLocked=function(){return this._semaphore.isLocked()},t.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},t.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},t.prototype.cancel=function(){return this._semaphore.cancel()},t}();e.default=a},2403:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=i(655),r=i(1764),a=function(){function t(t,e){void 0===e&&(e=r.E_CANCELED),this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}return t.prototype.acquire=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i,s){e._weightedQueues[t-1]||(e._weightedQueues[t-1]=[]),e._weightedQueues[t-1].push({resolve:i,reject:s}),e._dispatch()}))},t.prototype.runExclusive=function(t,e){return void 0===e&&(e=1),s.__awaiter(this,void 0,void 0,(function(){var i,r,a;return s.__generator(this,(function(s){switch(s.label){case 0:return[4,this.acquire(e)];case 1:i=s.sent(),r=i[0],a=i[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,t(r)];case 3:return[2,s.sent()];case 4:return a(),[7];case 5:return[2]}}))}))},t.prototype.waitForUnlock=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i){e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),e._weightedWaiters[t-1].push(i),e._dispatch()}))},t.prototype.isLocked=function(){return this._value<=0},t.prototype.getValue=function(){return this._value},t.prototype.setValue=function(t){this._value=t,this._dispatch()},t.prototype.release=function(t){if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},t.prototype.cancel=function(){var t=this;this._weightedQueues.forEach((function(e){return e.forEach((function(e){return e.reject(t._cancelError)}))})),this._weightedQueues=[]},t.prototype._dispatch=function(){for(var t,e=this._value;e>0;e--){var i=null===(t=this._weightedQueues[e-1])||void 0===t?void 0:t.shift();if(i){var s=this._value,r=e;this._value-=e,e=this._value+1,i.resolve([s,this._newReleaser(r)])}}this._drainUnlockWaiters()},t.prototype._newReleaser=function(t){var e=this,i=!1;return function(){i||(i=!0,e.release(t))}},t.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach((function(t){return t()})),this._weightedWaiters[t-1]=[])},t}();e.default=a},1764:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.E_CANCELED=e.E_ALREADY_LOCKED=e.E_TIMEOUT=void 0,e.E_TIMEOUT=new Error("timeout while waiting for mutex to become available"),e.E_ALREADY_LOCKED=new Error("mutex already locked"),e.E_CANCELED=new Error("request for lock canceled")},8125:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tryAcquire=e.withTimeout=e.Semaphore=e.Mutex=void 0;var s=i(655),r=i(5078);Object.defineProperty(e,"Mutex",{enumerable:!0,get:function(){return r.default}});var a=i(2403);Object.defineProperty(e,"Semaphore",{enumerable:!0,get:function(){return a.default}});var n=i(1960);Object.defineProperty(e,"withTimeout",{enumerable:!0,get:function(){return n.withTimeout}});var o=i(3143);Object.defineProperty(e,"tryAcquire",{enumerable:!0,get:function(){return o.tryAcquire}}),s.__exportStar(i(1764),e)},3143:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tryAcquire=void 0;var s=i(1764),r=i(1960);e.tryAcquire=function(t,e){return void 0===e&&(e=s.E_ALREADY_LOCKED),(0,r.withTimeout)(t,0,e)}},1960:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.withTimeout=void 0;var s=i(655),r=i(1764);e.withTimeout=function(t,e,i){var a=this;return void 0===i&&(i=r.E_TIMEOUT),{acquire:function(r){if(void 0!==r&&r<=0)throw new Error("invalid weight ".concat(r,": must be positive"));return new Promise((function(n,o){return s.__awaiter(a,void 0,void 0,(function(){var a,_,h,c;return s.__generator(this,(function(s){switch(s.label){case 0:a=!1,_=setTimeout((function(){a=!0,o(i)}),e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t.acquire(r)];case 2:return h=s.sent(),a?(Array.isArray(h)?h[1]:h)():(clearTimeout(_),n(h)),[3,4];case 3:return c=s.sent(),a||(clearTimeout(_),o(c)),[3,4];case 4:return[2]}}))}))}))},runExclusive:function(t,e){return s.__awaiter(this,void 0,void 0,(function(){var i,r;return s.__generator(this,(function(s){switch(s.label){case 0:i=function(){},s.label=1;case 1:return s.trys.push([1,,7,8]),[4,this.acquire(e)];case 2:return r=s.sent(),Array.isArray(r)?(i=r[1],[4,t(r[0])]):[3,4];case 3:return[2,s.sent()];case 4:return i=r,[4,t()];case 5:return[2,s.sent()];case 6:return[3,8];case 7:return i(),[7];case 8:return[2]}}))}))},release:function(e){t.release(e)},cancel:function(){return t.cancel()},waitForUnlock:function(s){if(void 0!==s&&s<=0)throw new Error("invalid weight ".concat(s,": must be positive"));return new Promise((function(r,a){t.waitForUnlock(s).then(r),setTimeout((function(){return a(i)}),e)}))},isLocked:function(){return t.isLocked()},getValue:function(){return t.getValue()},setValue:function(e){return t.setValue(e)}}}},37:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var i=[];i[0]=function(){return function(){}},i[1]=function(t,e){return void 0===e?t:function(i){t(i,e)}};var s=function(){function t(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return t.prototype.addHandler=function(t,e){return this.isHandlerAttached(t,e)||(this._handlers.push(t),this._contexts.push(e),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.removeHandler=function(t,e){var i=this._getHandlerIndex(t,e);return void 0!==i&&(this._handlers.splice(i,1),this._contexts.splice(i,1),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.isHandlerAttached=function(t,e){return void 0!==this._getHandlerIndex(t,e)},t.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},t.prototype._getHandlerIndex=function(t,e){var i,s=this._handlers.length;for(i=0;i<s&&(this._handlers[i]!==t||this._contexts[i]!==e);i++);return i<s?i:void 0},t.prototype._createDispatcher=function(){var t;this.dispatch=(t=this._handlers.length,i[t]||(i[t]=function(t){for(var e="return function dispatcher"+t+"(payload) {\n",i=[],s=[],r=0;r<t;r++)i.push("cb"+r),s.push("ctx"+r),e+="    cb"+r+"(payload, ctx"+r+");\n";return e+="};",new(Function.bind.apply(Function,[void 0].concat(i.concat(s),[e])))}(t)),i[t]).apply(this,this._handlers.concat(this._contexts))},t}();e.default=s},7819:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=i(37);e.Event=s.default},9993:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.opNmi=e.opIrq=e.opBoot=void 0;const s=i(655),r=s.__importDefault(i(697)),a=s.__importDefault(i(4874)),n=s.__importStar(i(5202));function o(t,e){t.p=e.readWord(65532)}function _(t,e,i){const s=t.p;t.nmi&&(i=65530),t.nmi=t.irq=!1,e.write(t.s+256,s>>>8&255),t.s=t.s+255&255,e.write(t.s+256,255&s),t.s=t.s+255&255,e.write(t.s+256,-17&t.flags),t.s=t.s+255&255,t.flags|=4,t.p=e.readWord(i)}function h(t,e){_(t,e,65534)}function c(t,e){_(t,e,65530)}e.opBoot=o,e.opIrq=h,e.opNmi=c,e.default=class{constructor(t,e){this._bus=t,this._rng=e,this.executionState=0,this.state=new a.default.State,this._opCycles=0,this._instructionCallback=null,this._invalidInstructionCallback=null,this._interruptPending=!1,this._nmiPending=!1,this._interuptCheck=0,this._halted=!1,this._operand=0,this._lastInstructionPointer=0,this._currentAddressingMode=12,this._dereference=!1,this.reset()}setInterrupt(t){return this._interruptPending=t,this}isInterrupt(){return this._interruptPending}nmi(){return this._nmiPending=!0,this}halt(){return this._halted=!0,this}resume(){return this._halted=!1,this}isHalt(){return this._halted}setInvalidInstructionCallback(t){return this._invalidInstructionCallback=t,this}getInvalidInstructionCallback(){return this._invalidInstructionCallback}getLastInstructionPointer(){return this._lastInstructionPointer}reset(){return this.state.a=this._rng?this._rng.int(255):0,this.state.x=this._rng?this._rng.int(255):0,this.state.y=this._rng?this._rng.int(255):0,this.state.s=253,this.state.p=this._rng?this._rng.int(65535):0,this.state.flags=52|(this._rng?this._rng.int(255):0),this.state.irq=!1,this.state.nmi=!1,this.executionState=0,this._opCycles=7,this._interruptPending=!1,this._nmiPending=!1,this._instructionCallback=o,this}cycle(){if(this._halted)return this;switch(this.executionState){case 0:case 2:0==--this._opCycles&&(this._dereference&&(this._operand=this._bus.read(this._operand)),1===this._interuptCheck&&this._checkForInterrupts(),this._instructionCallback(this.state,this._bus,this._operand,this._currentAddressingMode),this.executionState=1,0===this._interuptCheck&&this._checkForInterrupts());break;case 1:if(this.state.nmi)return this._instructionCallback=c,this._opCycles=6,this.state.nmi=this.state.irq=!1,this._interuptCheck=1,this.executionState=2,this;if(this.state.irq)return this._instructionCallback=h,this._opCycles=6,this.state.nmi=this.state.irq=!1,this._interuptCheck=1,this.executionState=2,this;this._fetch()}return this}_fetch(){const t=r.default.opcodes[this._bus.read(this.state.p)];let e,i,s=t.addressingMode,a=!1,o=!1;switch(this._lastInstructionPointer=this.state.p,this._currentAddressingMode=s,this._interuptCheck=0,t.operation){case 0:this._opCycles=0,this._instructionCallback=n.opAdc,a=!0;break;case 1:this._opCycles=0,this._instructionCallback=n.opAnd,a=!0;break;case 2:0===s?(this._opCycles=1,this._instructionCallback=n.opAslAcc):(this._opCycles=3,this._instructionCallback=n.opAslMem,o=!0);break;case 3:1&this.state.flags?(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=n.opJmp,this._opCycles=0);break;case 4:1&this.state.flags?(this._instructionCallback=n.opJmp,this._opCycles=0):(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 5:2&this.state.flags?(this._instructionCallback=n.opJmp,this._opCycles=0):(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 6:this._opCycles=0,this._instructionCallback=n.opBit,a=!0;break;case 7:128&this.state.flags?(this._instructionCallback=n.opJmp,this._opCycles=0):(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 8:2&this.state.flags?(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=n.opJmp,this._opCycles=0);break;case 9:128&this.state.flags?(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=n.opJmp,this._opCycles=0);break;case 11:64&this.state.flags?(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1):(this._instructionCallback=n.opJmp,this._opCycles=0);break;case 12:64&this.state.flags?(this._instructionCallback=n.opJmp,this._opCycles=0):(s=0,this._instructionCallback=n.opNop,this.state.p=this.state.p+1&65535,this._opCycles=1);break;case 10:this._opCycles=6,this._instructionCallback=n.opBrk,this._interuptCheck=1;break;case 13:this._opCycles=1,this._instructionCallback=n.opClc;break;case 14:this._opCycles=1,this._instructionCallback=n.opCld;break;case 15:this._opCycles=1,this._instructionCallback=n.opCli,this._interuptCheck=1;break;case 16:this._opCycles=1,this._instructionCallback=n.opClv;break;case 17:this._opCycles=0,this._instructionCallback=n.opCmp,a=!0;break;case 18:this._opCycles=0,this._instructionCallback=n.opCpx,a=!0;break;case 19:this._opCycles=0,this._instructionCallback=n.opCpy,a=!0;break;case 20:this._opCycles=3,this._instructionCallback=n.opDec,o=!0;break;case 21:this._opCycles=1,this._instructionCallback=n.opDex;break;case 22:this._opCycles=1,this._instructionCallback=n.opDey;break;case 23:this._opCycles=0,this._instructionCallback=n.opEor,a=!0;break;case 24:this._opCycles=3,this._instructionCallback=n.opInc,o=!0;break;case 25:this._opCycles=1,this._instructionCallback=n.opInx;break;case 26:this._opCycles=1,this._instructionCallback=n.opIny;break;case 27:this._opCycles=0,this._instructionCallback=n.opJmp;break;case 28:this._opCycles=5,this._instructionCallback=n.opJsr;break;case 29:this._opCycles=1===s?0:1,this._instructionCallback=n.opLda;break;case 30:this._opCycles=1===s?0:1,this._instructionCallback=n.opLdx;break;case 31:this._opCycles=1===s?0:1,this._instructionCallback=n.opLdy;break;case 32:0===s?(this._opCycles=1,this._instructionCallback=n.opLsrAcc):(this._opCycles=3,this._instructionCallback=n.opLsrMem,o=!0);break;case 33:this._opCycles=1,this._instructionCallback=n.opNop;break;case 56:case 57:this._opCycles=0,a=!0,this._instructionCallback=n.opNop;break;case 34:this._opCycles=0,this._instructionCallback=n.opOra,a=!0;break;case 36:this._opCycles=2,this._instructionCallback=n.opPhp;break;case 35:this._opCycles=2,this._instructionCallback=n.opPha;break;case 37:this._opCycles=3,this._instructionCallback=n.opPla;break;case 38:this._opCycles=3,this._instructionCallback=n.opPlp,this._interuptCheck=1;break;case 39:0===s?(this._opCycles=1,this._instructionCallback=n.opRolAcc):(this._opCycles=3,this._instructionCallback=n.opRolMem,o=!0);break;case 40:0===s?(this._opCycles=1,this._instructionCallback=n.opRorAcc):(this._opCycles=3,this._instructionCallback=n.opRorMem,o=!0);break;case 41:this._opCycles=5,this._instructionCallback=n.opRti;break;case 42:this._opCycles=5,this._instructionCallback=n.opRts;break;case 43:this._opCycles=0,this._instructionCallback=n.opSbc,a=!0;break;case 44:this._opCycles=1,this._instructionCallback=n.opSec;break;case 45:this._opCycles=1,this._instructionCallback=n.opSed;break;case 46:this._opCycles=1,this._instructionCallback=n.opSei,this._interuptCheck=1;break;case 47:this._opCycles=1,this._instructionCallback=n.opSta,o=!0;break;case 48:this._opCycles=1,this._instructionCallback=n.opStx,o=!0;break;case 49:this._opCycles=1,this._instructionCallback=n.opSty,o=!0;break;case 50:this._opCycles=1,this._instructionCallback=n.opTax;break;case 51:this._opCycles=1,this._instructionCallback=n.opTay;break;case 52:this._opCycles=1,this._instructionCallback=n.opTsx;break;case 53:this._opCycles=1,this._instructionCallback=n.opTxa;break;case 54:this._opCycles=1,this._instructionCallback=n.opTxs;break;case 55:this._opCycles=1,this._instructionCallback=n.opTya;break;case 62:this._opCycles=0,this._instructionCallback=n.opArr;break;case 58:this._opCycles=0,this._instructionCallback=n.opAlr;break;case 59:this._opCycles=0,this._instructionCallback=n.opAxs;break;case 60:this._opCycles=3,this._instructionCallback=n.opDcp,o=!0;break;case 61:this._opCycles=0,this._instructionCallback=n.opLax,a=!0;break;case 63:this._opCycles=3,this._instructionCallback=n.opSlo,o=!0,a=!1;break;case 64:this._opCycles=1,this._instructionCallback=n.opAax;break;case 65:this._opCycles=0,this._instructionCallback=n.opLar,a=!0;break;case 66:this._opCycles=3,this._instructionCallback=n.opIsc,o=!0;break;case 67:this._opCycles=0,this._instructionCallback=n.opAac;break;case 68:this._opCycles=0,this._instructionCallback=n.opAtx;break;case 69:this._opCycles=3,a=!1,o=!0,this._instructionCallback=n.opRra;break;case 70:this._opCycles=3,a=!1,o=!0,this._instructionCallback=n.opRla;break;default:return void(this._invalidInstructionCallback&&this._invalidInstructionCallback(this))}switch(this.state.p=this.state.p+1&65535,s){case 1:this._operand=this._bus.read(this.state.p),a=!1,this.state.p=this.state.p+1&65535,this._opCycles++;break;case 2:this._operand=this._bus.read(this.state.p),this.state.p=this.state.p+1&65535,this._opCycles++;break;case 3:this._operand=this._bus.readWord(this.state.p),this.state.p=this.state.p+2&65535,this._opCycles+=2;break;case 4:e=this._bus.readWord(this.state.p),this._operand=255==(255&e)?this._bus.read(e)+(this._bus.read(65280&e)<<8):this._bus.readWord(e),this.state.p=this.state.p+2&65535,this._opCycles+=4;break;case 5:e=this._bus.read(this.state.p),e=128&e?-(255&~(e-1)):e,this._operand=this.state.p+e+65537&65535,this.state.p=this.state.p+1&65535,this._opCycles+=(65280&this._operand)!=(65280&this.state.p)?3:2;break;case 6:i=this._bus.read(this.state.p),this._bus.read(i),this._operand=i+this.state.x&255,this.state.p=this.state.p+1&65535,this._opCycles+=2;break;case 7:e=this._bus.readWord(this.state.p),this._operand=e+this.state.x&65535,(65280&this._operand)!=(65280&e)&&this._bus.read(65280&e|255&this._operand),this._opCycles+=o||(65280&this._operand)!=(65280&e)?3:2,this.state.p=this.state.p+2&65535;break;case 9:i=this._bus.read(this.state.p),this._bus.read(i),this._operand=i+this.state.y&255,this.state.p=this.state.p+1&65535,this._opCycles+=2;break;case 10:e=this._bus.readWord(this.state.p),this._operand=e+this.state.y&65535,(65280&this._operand)!=(65280&e)&&this._bus.read(65280&e|255&this._operand),this._opCycles+=o||(65280&this._operand)!=(65280&e)?3:2,this.state.p=this.state.p+2&65535;break;case 8:i=this._bus.read(this.state.p),this._bus.read(i),e=i+this.state.x&255,this._operand=255===e?this._bus.read(255)+(this._bus.read(0)<<8):this._bus.readWord(e),this._opCycles+=4,this.state.p=this.state.p+1&65535;break;case 11:e=this._bus.read(this.state.p),e=255===e?this._bus.read(255)+(this._bus.read(0)<<8):this._bus.readWord(e),this._operand=e+this.state.y&65535,(65280&this._operand)!=(65280&e)&&this._bus.read(65280&e|255&this._operand),this._opCycles+=o||(65280&e)!=(65280&this._operand)?4:3,this.state.p=this.state.p+1&65535}this._dereference=a,a&&this._opCycles++,this.executionState=2}_checkForInterrupts(){this._nmiPending&&(this.state.irq=!1,this.state.nmi=!0,this._nmiPending=!1),!this._interruptPending||this.state.nmi||4&this.state.flags||(this.state.irq=!0)}}},4874:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,function(t){t.State=class{constructor(){this.a=0,this.x=0,this.y=0,this.s=0,this.p=0,this.flags=0,this.irq=!1,this.nmi=!1}}}(i||(i={})),e.default=i},7438:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=s.__importDefault(i(6962)),a=s.__importDefault(i(9993));class n{constructor(t){this._type=t}create(t,e){switch(this._type){case n.Type.stateMachine:return new r.default(t,e);case n.Type.batchedAccess:return new a.default(t,e);default:throw new Error("invalid CPU type")}}}!function(t){let e;!function(t){t[t.stateMachine=0]="stateMachine",t[t.batchedAccess=1]="batchedAccess"}(e=t.Type||(t.Type={}))}(n||(n={})),e.default=n},697:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(t,e,i=e){this.operation=t,this.addressingMode=e,this.effectiveAddressingMode=i}getSize(){switch(this.effectiveAddressingMode){case 1:case 2:case 6:case 9:case 8:case 11:case 5:return 2;case 3:case 7:case 10:case 4:return 3;default:return 1}}}e.default=i,function(t){let e;!function(t){t[t.adc=0]="adc",t[t.and=1]="and",t[t.asl=2]="asl",t[t.bcc=3]="bcc",t[t.bcs=4]="bcs",t[t.beq=5]="beq",t[t.bit=6]="bit",t[t.bmi=7]="bmi",t[t.bne=8]="bne",t[t.bpl=9]="bpl",t[t.brk=10]="brk",t[t.bvc=11]="bvc",t[t.bvs=12]="bvs",t[t.clc=13]="clc",t[t.cld=14]="cld",t[t.cli=15]="cli",t[t.clv=16]="clv",t[t.cmp=17]="cmp",t[t.cpx=18]="cpx",t[t.cpy=19]="cpy",t[t.dec=20]="dec",t[t.dex=21]="dex",t[t.dey=22]="dey",t[t.eor=23]="eor",t[t.inc=24]="inc",t[t.inx=25]="inx",t[t.iny=26]="iny",t[t.jmp=27]="jmp",t[t.jsr=28]="jsr",t[t.lda=29]="lda",t[t.ldx=30]="ldx",t[t.ldy=31]="ldy",t[t.lsr=32]="lsr",t[t.nop=33]="nop",t[t.ora=34]="ora",t[t.pha=35]="pha",t[t.php=36]="php",t[t.pla=37]="pla",t[t.plp=38]="plp",t[t.rol=39]="rol",t[t.ror=40]="ror",t[t.rti=41]="rti",t[t.rts=42]="rts",t[t.sbc=43]="sbc",t[t.sec=44]="sec",t[t.sed=45]="sed",t[t.sei=46]="sei",t[t.sta=47]="sta",t[t.stx=48]="stx",t[t.sty=49]="sty",t[t.tax=50]="tax",t[t.tay=51]="tay",t[t.tsx=52]="tsx",t[t.txa=53]="txa",t[t.txs=54]="txs",t[t.tya=55]="tya",t[t.dop=56]="dop",t[t.top=57]="top",t[t.alr=58]="alr",t[t.axs=59]="axs",t[t.dcp=60]="dcp",t[t.lax=61]="lax",t[t.arr=62]="arr",t[t.slo=63]="slo",t[t.aax=64]="aax",t[t.lar=65]="lar",t[t.isc=66]="isc",t[t.aac=67]="aac",t[t.atx=68]="atx",t[t.rra=69]="rra",t[t.rla=70]="rla",t[t.invalid=71]="invalid"}(e=t.OperationMap||(t.OperationMap={})),t.opcodes=new Array(256)}(i||(i={})),e.default=i,function(t){let e;!function(e){for(let e=0;e<256;e++)t.opcodes[e]=new t(71,12);let i,s,r;for(let e=0;e<8;e++){switch(e){case 0:i=34;break;case 1:i=1;break;case 2:i=23;break;case 3:i=0;break;case 4:i=47;break;case 5:i=29;break;case 6:i=17;break;case 7:i=43}for(let a=0;a<8;a++){switch(a){case 0:s=8;break;case 1:s=2;break;case 2:s=1;break;case 3:s=3;break;case 4:s=11;break;case 5:s=6;break;case 6:s=10;break;case 7:s=7}47===i&&1===s&&(s=12),71!==i&&12!==s&&(r=e<<5|a<<2|1,t.opcodes[r]=new t(i,s))}}function a(e,i,s,r){if(71!==t.opcodes[e].operation)throw new Error("entry for opcode "+e+" already exists");t.opcodes[e]=new t(i,s,r)}a(6,2,2),a(10,2,0),a(14,2,3),a(22,2,6),a(30,2,7),a(38,39,2),a(42,39,0),a(46,39,3),a(54,39,6),a(62,39,7),a(70,32,2),a(74,32,0),a(78,32,3),a(86,32,6),a(94,32,7),a(102,40,2),a(106,40,0),a(110,40,3),a(118,40,6),a(126,40,7),a(134,48,2),a(142,48,3),a(150,48,9),a(162,30,1),a(166,30,2),a(174,30,3),a(182,30,9),a(190,30,10),a(198,20,2),a(206,20,3),a(214,20,6),a(222,20,7),a(230,24,2),a(238,24,3),a(246,24,6),a(254,24,7),a(36,6,2),a(44,6,3),a(76,27,3),a(108,27,4),a(132,49,2),a(140,49,3),a(148,49,6),a(160,31,1),a(164,31,2),a(172,31,3),a(180,31,6),a(188,31,7),a(192,19,1),a(196,19,2),a(204,19,3),a(224,18,1),a(228,18,2),a(236,18,3),a(16,9,5),a(48,7,5),a(80,11,5),a(112,12,5),a(144,3,5),a(176,4,5),a(208,8,5),a(240,5,5),a(0,10,0),a(32,28,0,3),a(64,41,0),a(96,42,0),a(8,36,0),a(40,38,0),a(72,35,0),a(104,37,0),a(136,22,0),a(168,51,0),a(200,26,0),a(232,25,0),a(24,13,0),a(56,44,0),a(88,15,0),a(120,46,0),a(152,55,0),a(184,16,0),a(216,14,0),a(248,45,0),a(138,53,0),a(154,54,0),a(170,50,0),a(186,52,0),a(202,21,0),a(234,33,0),a(26,33,0),a(58,33,0),a(90,33,0),a(122,33,0),a(218,33,0),a(250,33,0),a(4,56,2),a(20,56,6),a(52,56,6),a(68,56,2),a(84,56,6),a(100,56,2),a(116,56,6),a(128,56,1),a(130,56,1),a(137,56,1),a(194,56,1),a(212,56,6),a(226,56,1),a(244,56,6),a(12,57,3),a(28,57,7),a(60,57,7),a(92,57,7),a(124,57,7),a(220,57,7),a(252,57,7),a(235,43,1),a(75,58,1),a(203,59,1),a(199,60,2),a(215,60,6),a(207,60,3),a(223,60,7),a(219,60,10),a(195,60,8),a(211,60,11),a(167,61,2),a(183,61,9),a(175,61,3),a(191,61,10),a(163,61,8),a(179,61,11),a(107,62,1),a(7,63,2),a(23,63,6),a(15,63,3),a(31,63,7),a(27,63,10),a(3,63,8),a(19,63,11),a(135,64,2),a(151,64,9),a(131,64,8),a(143,64,3),a(187,65,10),a(231,66,2),a(247,66,6),a(239,66,3),a(255,66,7),a(251,66,10),a(227,66,8),a(243,66,11),a(11,67,1),a(43,67,1),a(171,68,1),a(103,69,2),a(119,69,6),a(111,69,3),a(127,69,7),a(123,69,10),a(99,69,8),a(115,69,11),a(39,70,2),a(55,70,6),a(47,70,3),a(63,70,7),a(59,70,10),a(35,70,8),a(51,70,11)}(e=t.__init||(t.__init={}))}(i||(i={})),e.default=i},6962:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=s.__importDefault(i(4874)),a=i(1485),n=s.__importDefault(i(8738));e.default=class{constructor(t,e){this._bus=t,this._rng=e,this.executionState=0,this.state=new r.default.State,this._invalidInstructionCallback=null,this._interruptPending=!1,this._nmiPending=!1,this._halt=!1,this._pollInterruptsAfterLastInstruction=!1,this._lastInstructionPointer=0,this._operations=new Array(255),this._opBoot=(0,a.boot)(this.state),this._opIrq=(0,a.irq)(this.state),this._opNmi=(0,a.nmi)(this.state);const i=new n.default(this.state);for(let t=0;t<256;t++)this._operations[t]=i.compile(t);this.reset()}reset(){return this.state.a=this._rng?this._rng.int(255):0,this.state.x=this._rng?this._rng.int(255):0,this.state.y=this._rng?this._rng.int(255):0,this.state.s=253,this.state.p=this._rng?this._rng.int(65535):0,this.state.flags=52|(this._rng?this._rng.int(255):0),this.state.irq=!1,this.state.nmi=!1,this.executionState=0,this._interruptPending=!1,this._nmiPending=!1,this._halt=!1,this._lastResult=this._opBoot.reset(void 0),this._lastInstructionPointer=0,this}setInterrupt(t){return this._interruptPending=t,this}isInterrupt(){return this._interruptPending}nmi(){return this._nmiPending=!0,this}halt(){return this._halt=!0,this}resume(){return this._halt=!1,this}isHalt(){return this._halt}setInvalidInstructionCallback(t){return this._invalidInstructionCallback=t,this}getInvalidInstructionCallback(){return this._invalidInstructionCallback}getLastInstructionPointer(){return this._lastInstructionPointer}cycle(){if(this._halt&&(!this._lastResult||0===this._lastResult.cycleType))return this;if(1===this.executionState)return this._fetch(),this;let t;switch(this._lastResult.cycleType){case 0:t=this._bus.read(this._lastResult.address);break;case 1:t=this._lastResult.value,this._bus.write(this._lastResult.address,t);break;default:throw new Error("invalid cycle type")}return this._lastResult.pollInterrupts&&(this._pollInterrupts(),this._lastResult.pollInterrupts=!1,this._pollInterruptsAfterLastInstruction=!1),this._lastResult=this._lastResult.nextStep(t),null===this._lastResult&&(this.executionState=1),this}_fetch(){let t;this._pollInterruptsAfterLastInstruction&&this._pollInterrupts(),this._lastInstructionPointer=this.state.p;const e=this._bus.read(this.state.p);this.state.nmi?(t=this._opNmi,this._pollInterruptsAfterLastInstruction=!1):this.state.irq?(t=this._opIrq,this._pollInterruptsAfterLastInstruction=!1):(t=this._operations[e],this.state.p=this.state.p+1&65535,this._pollInterruptsAfterLastInstruction=!0),t?(this.executionState=2,this._lastResult=t.reset(void 0)):this._invalidInstructionCallback&&this._invalidInstructionCallback(this)}_pollInterrupts(){if(this.state.irq=!1,this._nmiPending)return this.state.nmi=!0,void(this._nmiPending=!1);!this._interruptPending||this.state.nmi||4&this.state.flags||(this.state.irq=!0)}}},5202:(t,e)=>{function i(t,e){t.s=t.s+1&255,t.flags=-17&(32|e.read(256+t.s))}function s(t,e){t.flags=-131&t.flags|128&e|(e?0:2)}function r(t,e,i){if(8&t.flags){const e=(15&i)+(15&t.a)+(1&t.flags),s=(i>>>4)+(t.a>>>4)+(e>9?1:0);t.a=e%10|s%10<<4,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|(s>9?1:0)}else{const e=t.a+i+(1&t.flags),s=255&e;t.flags=-196&t.flags|128&s|(s?0:2)|e>>>8|(~(i^t.a)&(s^i)&128)>>>1,t.a=s}}function a(t,e,i){t.a&=i,s(t,t.a)}function n(t,e,i){if(8&t.flags){const e=(15&t.a)-(15&i)-(1&~t.flags),s=(t.a>>>4)-(i>>>4)-(e<0?1:0);t.a=(e<0?10+e:e)|(s<0?10+s:s)<<4,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|(s<0?0:1)}else{i=255&~i;const e=t.a+i+(1&t.flags),s=255&e;t.flags=-196&t.flags|128&s|(s?0:2)|e>>>8|(~(i^t.a)&(s^i)&128)>>>1,t.a=s}}Object.defineProperty(e,"__esModule",{value:!0}),e.opTxa=e.opTsx=e.opTay=e.opTax=e.opSty=e.opStx=e.opSta=e.opSei=e.opSed=e.opSec=e.opSbc=e.opRts=e.opRti=e.opRorMem=e.opRorAcc=e.opRolMem=e.opRolAcc=e.opPla=e.opPha=e.opPlp=e.opPhp=e.opOra=e.opNop=e.opLsrMem=e.opLsrAcc=e.opLdy=e.opLdx=e.opLda=e.opJsr=e.opJmp=e.opIny=e.opInx=e.opInc=e.opDey=e.opEor=e.opDex=e.opDec=e.opCpy=e.opCpx=e.opCmp=e.opClv=e.opCli=e.opCld=e.opClc=e.opBrk=e.opBit=e.opAslMem=e.opAslAcc=e.opAnd=e.opAdc=void 0,e.opRla=e.opRra=e.opAtx=e.opAac=e.opIsc=e.opLar=e.opAax=e.opSlo=e.opArr=e.opLax=e.opDcp=e.opAxs=e.opAlr=e.opTya=e.opTxs=void 0,e.opAdc=r,e.opAnd=a,e.opAslAcc=function(t){const e=t.a;t.a=t.a<<1&255,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},e.opAslMem=function(t,e,i){const s=e.read(i),r=s<<1&255;e.write(i,r),t.flags=-132&t.flags|128&r|(r?0:2)|s>>>7},e.opBit=function(t,e,i){t.flags=-195&t.flags|192&i|(i&t.a?0:2)},e.opBrk=function(t,e){const i=t.p+1&65535;let s=65534;t.nmi&&(s=65530,t.nmi=!1),t.nmi=t.irq=!1,e.write(t.s+256,i>>>8&255),t.s=t.s+255&255,e.write(t.s+256,255&i),t.s=t.s+255&255,e.write(t.s+256,16|t.flags),t.s=t.s+255&255,t.flags|=4,t.p=e.readWord(s)},e.opClc=function(t){t.flags&=-2},e.opCld=function(t){t.flags&=-9},e.opCli=function(t){t.flags&=-5},e.opClv=function(t){t.flags&=-65},e.opCmp=function(t,e,i){const s=t.a+(255&~i)+1;t.flags=-132&t.flags|128&s|(255&s?0:2)|s>>>8},e.opCpx=function(t,e,i){const s=t.x+(255&~i)+1;t.flags=-132&t.flags|128&s|(255&s?0:2)|s>>>8},e.opCpy=function(t,e,i){const s=t.y+(255&~i)+1;t.flags=-132&t.flags|128&s|(255&s?0:2)|s>>>8},e.opDec=function(t,e,i){const r=e.read(i)+255&255;e.write(i,r),s(t,r)},e.opDex=function(t){t.x=t.x+255&255,s(t,t.x)},e.opEor=function(t,e,i){t.a=t.a^i,s(t,t.a)},e.opDey=function(t){t.y=t.y+255&255,s(t,t.y)},e.opInc=function(t,e,i){const r=e.read(i)+1&255;e.write(i,r),s(t,r)},e.opInx=function(t){t.x=t.x+1&255,s(t,t.x)},e.opIny=function(t){t.y=t.y+1&255,s(t,t.y)},e.opJmp=function(t,e,i){t.p=i},e.opJsr=function(t,e,i){const s=t.p+1&65535,r=e.read(t.p);e.read(256+t.s),e.write(256+t.s,s>>>8),t.s=t.s+255&255,e.write(256+t.s,255&s),t.s=t.s+255&255,t.p=r|e.read(t.p+1&65535)<<8},e.opLda=function(t,e,i,r){t.a=1===r?i:e.read(i),s(t,t.a)},e.opLdx=function(t,e,i,r){t.x=1===r?i:e.read(i),s(t,t.x)},e.opLdy=function(t,e,i,r){t.y=1===r?i:e.read(i),s(t,t.y)},e.opLsrAcc=function(t){const e=t.a;t.a=t.a>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},e.opLsrMem=function(t,e,i){const s=e.read(i),r=s>>>1;e.write(i,r),t.flags=-132&t.flags|128&r|(r?0:2)|1&s},e.opNop=function(){},e.opOra=function(t,e,i){t.a|=i,s(t,t.a)},e.opPhp=function(t,e){e.write(256+t.s,16|t.flags),t.s=t.s+255&255},e.opPlp=function(t,e){i(t,e)},e.opPha=function(t,e){e.write(256+t.s,t.a),t.s=t.s+255&255},e.opPla=function(t,e){t.s=t.s+1&255,t.a=e.read(256+t.s),s(t,t.a)},e.opRolAcc=function(t){const e=t.a;t.a=t.a<<1&255|1&t.flags,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},e.opRolMem=function(t,e,i){const s=e.read(i),r=s<<1&255|1&t.flags;e.write(i,r),t.flags=-132&t.flags|128&r|(r?0:2)|s>>>7},e.opRorAcc=function(t){const e=t.a;t.a=t.a>>>1|(1&t.flags)<<7,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},e.opRorMem=function(t,e,i){const s=e.read(i),r=s>>>1|(1&t.flags)<<7;e.write(i,r),t.flags=-132&t.flags|128&r|(r?0:2)|1&s},e.opRti=function(t,e){let s;i(t,e),t.s=t.s+1&255,s=e.read(256+t.s),t.s=t.s+1&255,s|=e.read(256+t.s)<<8,t.p=s},e.opRts=function(t,e){let i;e.read(256+t.s),t.s=t.s+1&255,i=e.read(256+t.s),t.s=t.s+1&255,i+=e.read(256+t.s)<<8,t.p=i+1&65535},e.opSbc=n,e.opSec=function(t){t.flags|=1},e.opSed=function(t){t.flags|=8},e.opSei=function(t){t.flags|=4},e.opSta=function(t,e,i){e.write(i,t.a)},e.opStx=function(t,e,i){e.write(i,t.x)},e.opSty=function(t,e,i){e.write(i,t.y)},e.opTax=function(t){t.x=t.a,s(t,t.a)},e.opTay=function(t){t.y=t.a,s(t,t.a)},e.opTsx=function(t){t.x=t.s,s(t,t.x)},e.opTxa=function(t){t.a=t.x,s(t,t.a)},e.opTxs=function(t){t.s=t.x},e.opTya=function(t){t.a=t.y,s(t,t.a)},e.opAlr=function(t,e,i){const s=t.a&i;t.a=s>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&s},e.opAxs=function(t,e,i){const s=(t.a&t.x)+(255&~i)+1;t.x=255&s,t.flags=-132&t.flags|128&t.x|(255&t.x?0:2)|s>>>8},e.opDcp=function(t,e,i){const s=e.read(i)+255&255;e.write(i,s);const r=t.a+(255&~s)+1;t.flags=-132&t.flags|128&r|(255&r?0:2)|r>>>8},e.opLax=function(t,e,i){t.a=i,t.x=i,s(t,i)},e.opArr=function(t,e,i){t.a=(t.a&i)>>>1|(1&t.flags?128:0),t.flags=-196&t.flags|(64&t.a)>>>6|(t.a?0:2)|128&t.a|64&t.a^(32&t.a)<<1},e.opSlo=function(t,e,i){let r=e.read(i);t.flags=-2&t.flags|r>>>7,r=r<<1&255,e.write(i,r),t.a=t.a|r,s(t,t.a)},e.opAax=function(t,e,i){const r=t.x&t.a;e.write(i,r),s(t,r)},e.opLar=function(t,e,i){t.s=t.a=t.x=t.s&i,s(t,t.a)},e.opIsc=function(t,e,i){const s=e.read(i)+1&255;e.write(i,s),n(t,0,s)},e.opAac=function(t,e,i){t.a&=i,s(t,t.a),t.flags=-2&t.flags|(128&t.a)>>>7},e.opAtx=function(t,e,i){t.a&=i,t.x=t.a,s(t,t.a)},e.opRra=function(t,e,i){const s=e.read(i),a=s>>>1|(1&t.flags)<<7;e.write(i,a),t.flags=-2&t.flags|1&s,r(t,0,a)},e.opRla=function(t,e,i){const s=e.read(i),r=s<<1&255|1&t.flags;e.write(i,r),t.flags=-2&t.flags|s>>>7,a(t,0,r)}},8738:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=s.__importDefault(i(697)),a=i(8931),n=i(3061),o=s.__importStar(i(2049)),_=i(369),h=i(1485);e.default=class{constructor(t){this._state=t}compile(t){const e=r.default.opcodes[t];switch(e.operation){case 0:return this._createAddressing(e.addressingMode,o.adc,{deref:!0});case 1:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.a=e.a&t))),{deref:!0});case 2:return 0===e.addressingMode?(0,n.nullaryOneCycle)(this._state,o.aslImmediate):this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.aslRmw).reset,{writeOp:!0});case 6:return this._createAddressing(e.addressingMode,o.bit,{deref:!0});case 10:return(0,h.brk)(this._state);case 17:return this._createAddressing(e.addressingMode,((t,e)=>(o.cmp(t,e,(t=>t.a)),null)),{deref:!0});case 18:return this._createAddressing(e.addressingMode,((t,e)=>(o.cmp(t,e,(t=>t.x)),null)),{deref:!0});case 19:return this._createAddressing(e.addressingMode,((t,e)=>(o.cmp(t,e,(t=>t.y)),null)),{deref:!0});case 20:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,((t,e)=>o.genRmw(t,e,(t=>t-1&255)))).reset,{writeOp:!0});case 21:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.x=t.x-1&255))));case 22:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.y=t.y-1&255))));case 24:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,((t,e)=>o.genRmw(t,e,(t=>t+1&255)))).reset,{writeOp:!0});case 25:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.x=t.x+1&255))));case 26:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.y=t.y+1&255))));case 23:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.a=e.a^t))),{deref:!0});case 27:return this._createAddressing(e.addressingMode,((t,e)=>(e.p=t,null)));case 28:return(0,n.jsr)(this._state);case 29:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.a=t))),{deref:!0});case 30:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.x=t))),{deref:!0});case 31:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.y=t))),{deref:!0});case 32:return 0===e.addressingMode?(0,n.nullaryOneCycle)(this._state,o.lsrImmediate):this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.lsrRmw).reset,{writeOp:!0});case 33:return(0,n.nullaryOneCycle)(this._state,(()=>{}));case 34:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.a|=t))),{deref:!0});case 35:return(0,n.push)(this._state,(t=>t.a));case 36:return(0,n.push)(this._state,(t=>16|t.flags));case 37:return(0,n.pull)(this._state,((t,e)=>o.genNullary(t,(t=>t.a=e))));case 38:return(0,n.pull)(this._state,((t,e)=>t.flags=-17&(32|e)));case 39:return 0===e.addressingMode?(0,n.nullaryOneCycle)(this._state,o.rolImmediate):this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.rolRmw).reset,{writeOp:!0});case 40:return 0===e.addressingMode?(0,n.nullaryOneCycle)(this._state,o.rorImmediate):this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.rorRmw).reset,{writeOp:!0});case 41:return(0,n.rti)(this._state);case 42:return(0,n.rts)(this._state);case 43:return this._createAddressing(e.addressingMode,o.sbc,{deref:!0});case 48:return this._createAddressing(e.addressingMode,(0,n.write)(this._state,(t=>t.x)).reset,{writeOp:!0});case 49:return this._createAddressing(e.addressingMode,(0,n.write)(this._state,(t=>t.y)).reset,{writeOp:!0});case 50:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.x=t.a))));case 51:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.y=t.a))));case 52:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.x=t.s))));case 53:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.a=t.x))));case 54:return(0,n.nullaryOneCycle)(this._state,(t=>t.s=t.x));case 55:return(0,n.nullaryOneCycle)(this._state,(t=>o.genNullary(t,(t=>t.a=t.y))));case 3:return(0,n.branch)(this._state,(t=>0==(1&t)));case 4:return(0,n.branch)(this._state,(t=>(1&t)>0));case 8:return(0,n.branch)(this._state,(t=>0==(2&t)));case 5:return(0,n.branch)(this._state,(t=>(2&t)>0));case 9:return(0,n.branch)(this._state,(t=>0==(128&t)));case 7:return(0,n.branch)(this._state,(t=>(128&t)>0));case 11:return(0,n.branch)(this._state,(t=>0==(64&t)));case 12:return(0,n.branch)(this._state,(t=>(64&t)>0));case 44:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags|=1));case 45:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags|=8));case 46:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags|=4));case 47:return this._createAddressing(e.addressingMode,(0,n.write)(this._state,(t=>t.a)).reset,{writeOp:!0});case 13:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags&=-2));case 14:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags&=-9));case 15:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags&=-5));case 16:return(0,n.nullaryOneCycle)(this._state,(t=>t.flags&=-65));case 56:case 57:return this._createAddressing(e.addressingMode,(()=>null),{deref:!0});case 67:return this._createAddressing(e.addressingMode,o.aac);case 64:return this._createAddressing(e.addressingMode,(0,n.write)(this._state,o.aax).reset,{writeOp:!0});case 58:return this._createAddressing(e.addressingMode,o.alr,{deref:!0});case 62:return this._createAddressing(e.addressingMode,((t,e)=>(o.arr(t,e),null)),{deref:!0});case 59:return this._createAddressing(e.addressingMode,o.axs,{deref:!0});case 68:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.x=e.a=e.a&t))),{deref:!0});case 60:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.dcp).reset,{writeOp:!0});case 66:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.isc).reset,{writeOp:!0});case 61:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.a=e.x=t))),{deref:!0});case 65:return this._createAddressing(e.addressingMode,((t,e)=>o.genUnary(t,e,((t,e)=>e.s=e.x=e.a=e.s&t))),{deref:!0});case 70:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.rla).reset,{writeOp:!0});case 69:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.rra).reset,{writeOp:!0});case 63:return this._createAddressing(e.addressingMode,(0,n.readModifyWrite)(this._state,o.slo).reset,{writeOp:!0});default:return null}}_createAddressing(t,e,{deref:i=!1,writeOp:s=!1}={}){switch(i&&1!==t&&(e=(0,a.dereference)(this._state,e).reset),t){case 1:return(0,a.immediate)(this._state,e);case 2:return(0,a.zeroPage)(this._state,e);case 3:return(0,a.absolute)(this._state,e);case 6:return(0,a.zeroPageX)(this._state,e);case 9:return(0,a.zeroPageY)(this._state,e);case 7:return(0,a.absoluteX)(this._state,e,s);case 10:return(0,a.absoluteY)(this._state,e,s);case 8:return(0,a.indexedIndirectX)(this._state,e);case 11:return(0,a.indirectIndexedY)(this._state,e,s);case 4:return(0,_.indirect)(this._state,e);default:throw new Error(`invalid addressing mode ${t}`)}}}},9022:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.cycleType=0,this.address=0,this.value=0,this.pollInterrupts=!1,this.nextStep=null}read(t,e){return this.cycleType=0,this.address=e,this.nextStep=t,this}write(t,e,i){return this.cycleType=1,this.address=e,this.value=i,this.nextStep=t,this}poll(t){return this.pollInterrupts=t,this}}},1324:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.absolute=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null)){this.reset=()=>this._result.read(this._fetchLo,this._state.p),this._fetchLo=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._result.read(this._fetchHi,this._state.p)),this._fetchHi=t=>(this._operand|=t<<8,this._state.p=this._state.p+1&65535,this._next(this._operand,this._state)),this._operand=0,this._result=new a.default,this._state=t,this._next=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.absolute=(t,e)=>new o(t,e)},195:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.absoluteY=e.absoluteX=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e,i=(()=>null),s=!1){this.reset=()=>this._result.read(this._fetchLo,this._state.p),this._fetchLo=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._result.read(this._fetchHi,this._state.p)),this._fetchHi=t=>{this._operand|=t<<8,this._state.p=this._state.p+1&65535;const e=this._indexExtractor(this._state);return this._carry=(255&this._operand)+e>255,this._operand=65280&this._operand|this._operand+e&255,this._carry||this._writeOp?this._result.read(this._dereferenceAndCarry,this._operand):this._next(this._operand,this._state)},this._dereferenceAndCarry=t=>(this._carry&&(this._operand=this._operand+256&65535),this._next(this._operand,this._state)),this._operand=0,this._carry=!1,this._result=new a.default,this._state=t,this._indexExtractor=e,this._next=i,this._writeOp=s,(0,n.freezeImmutables)(this)}static absoluteX(t,e,i){return new o(t,(t=>t.x),e,i)}static absoluteY(t,e,i){return new o(t,(t=>t.y),e,i)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dereferenceAndCarry",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_indexExtractor",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Boolean)],o.prototype,"_writeOp",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function),s.__metadata("design:paramtypes",[r.default.State,Function,Boolean]),s.__metadata("design:returntype",o)],o,"absoluteX",null),s.__decorate([n.Immutable,s.__metadata("design:type",Function),s.__metadata("design:paramtypes",[r.default.State,Function,Boolean]),s.__metadata("design:returntype",o)],o,"absoluteY",null),e.absoluteX=(t,e,i)=>o.absoluteX(t,e,i),e.absoluteY=(t,e,i)=>o.absoluteY(t,e,i)},9125:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.dereference=void 0;const s=i(655),r=s.__importDefault(i(9022)),a=i(3272),n=s.__importDefault(i(4874));class o{constructor(t,e=(()=>null)){this.reset=t=>this._result.read(this._dereference,t),this._dereference=t=>this._next(t,this._state),this._result=new r.default,this._next=e,this._state=t,(0,a.freezeImmutables)(this)}}s.__decorate([a.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([a.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dereference",void 0),s.__decorate([a.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([a.Immutable,s.__metadata("design:type",n.default.State)],o.prototype,"_state",void 0),s.__decorate([a.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.dereference=(t,e)=>new o(t,e)},8914:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.immediate=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null)){this.reset=()=>this._result.read(this._fetchOperand,this._state.p),this._fetchOperand=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._next(this._operand,this._state)),this._operand=0,this._result=new a.default,this._state=t,this._next=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchOperand",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.immediate=(t,e)=>new o(t,e)},8931:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zeroPageY=e.zeroPageX=e.zeroPage=e.indirectIndexedY=e.indexedIndirectX=e.immediate=e.dereference=e.absoluteY=e.absoluteX=e.absolute=void 0;var s=i(1324);Object.defineProperty(e,"absolute",{enumerable:!0,get:function(){return s.absolute}});var r=i(195);Object.defineProperty(e,"absoluteX",{enumerable:!0,get:function(){return r.absoluteX}}),Object.defineProperty(e,"absoluteY",{enumerable:!0,get:function(){return r.absoluteY}});var a=i(9125);Object.defineProperty(e,"dereference",{enumerable:!0,get:function(){return a.dereference}});var n=i(8914);Object.defineProperty(e,"immediate",{enumerable:!0,get:function(){return n.immediate}});var o=i(7734);Object.defineProperty(e,"indexedIndirectX",{enumerable:!0,get:function(){return o.indexedIndirectX}});var _=i(7466);Object.defineProperty(e,"indirectIndexedY",{enumerable:!0,get:function(){return _.indirectIndexedY}});var h=i(3599);Object.defineProperty(e,"zeroPage",{enumerable:!0,get:function(){return h.zeroPage}});var c=i(3799);Object.defineProperty(e,"zeroPageX",{enumerable:!0,get:function(){return c.zeroPageX}}),Object.defineProperty(e,"zeroPageY",{enumerable:!0,get:function(){return c.zeroPageY}})},7734:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.indexedIndirectX=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null)){this.reset=()=>this._result.read(this._fetchAddress,this._state.p),this._fetchAddress=t=>(this._address=t,this._state.p=this._state.p+1&65535,this._result.read(this._addIndex,this._address)),this._addIndex=t=>(this._address=this._address+this._state.x&255,this._result.read(this._fetchLo,this._address)),this._fetchLo=t=>(this._operand=t,this._address=this._address+1&255,this._result.read(this._fetchHi,this._address)),this._fetchHi=t=>(this._operand|=t<<8,this._next(this._operand,this._state)),this._operand=0,this._address=0,this._result=new a.default,this._state=t,this._next=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddress",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_addIndex",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.indexedIndirectX=(t,e)=>new o(t,e)},369:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.indirect=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null)){this.reset=()=>this._result.read(this._fetchAddressLo,this._state.p),this._fetchAddressLo=t=>(this._address=t,this._state.p=this._state.p+1&65535,this._result.read(this._fetchAddressHi,this._state.p)),this._fetchAddressHi=t=>(this._address|=t<<8,this._state.p=this._state.p+1&65535,this._result.read(this._fetchLo,this._address)),this._fetchLo=t=>(this._operand=t,255==(255&this._address)?this._address&=65280:this._address=this._address+1&65535,this._result.read(this._fetchHi,this._address)),this._fetchHi=t=>(this._operand|=t<<8,this._next(this._operand,this._state)),this._operand=0,this._address=0,this._result=new a.default,this._state=t,this._next=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddressLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddressHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.indirect=(t,e)=>new o(t,e)},7466:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.indirectIndexedY=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null),i){this.reset=()=>this._result.read(this._fetchAddress,this._state.p),this._fetchAddress=t=>(this._address=t,this._state.p=this._state.p+1&65535,this._result.read(this._fetchLo,this._address)),this._fetchLo=t=>(this._operand=t,this._address=this._address+1&255,this._result.read(this._fetchHi,this._address)),this._fetchHi=t=>(this._operand|=t<<8,this._carry=(255&this._operand)+this._state.y>255,this._operand=65280&this._operand|this._operand+this._state.y&255,this._carry||this._writeOp?this._result.read(this._dereferenceAndCarry,this._operand):this._next(this._operand,this._state)),this._dereferenceAndCarry=t=>(this._carry&&(this._operand=this._operand+256&65535),this._next(this._operand,this._state)),this._operand=0,this._address=0,this._carry=!1,this._result=new a.default,this._state=t,this._next=e,this._writeOp=i,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddress",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchLo",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchHi",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dereferenceAndCarry",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Boolean)],o.prototype,"_writeOp",void 0),e.indirectIndexedY=(t,e,i)=>new o(t,e,i)},3599:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zeroPage=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e=(()=>null)){this.reset=()=>this._result.read(this._fetchAddress,this._state.p),this._fetchAddress=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._next(this._operand,this._state)),this._operand=0,this._result=new a.default,this._state=t,this._next=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddress",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),e.zeroPage=(t,e)=>new o(t,e)},3799:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zeroPageY=e.zeroPageX=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e,i){this.reset=()=>this._result.read(this._fetchAddress,this._state.p),this._fetchAddress=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._result.read(this._addIndex,this._operand)),this._addIndex=t=>(this._operand=this._operand+this._indexExtractor(this._state)&255,this._next(this._operand,this._state)),this._operand=0,this._result=new a.default,this._state=t,this._indexExtractor=e,this._next=i,(0,n.freezeImmutables)(this)}static zeroPageX(t,e=(()=>null)){return new o(t,(t=>t.x),e)}static zeroPageY(t,e=(()=>null)){return new o(t,(t=>t.y),e)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchAddress",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_addIndex",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_next",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_indexExtractor",void 0),e.zeroPageX=(t,e)=>o.zeroPageX(t,e),e.zeroPageY=(t,e)=>o.zeroPageY(t,e)},806:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.branch=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e){this.reset=()=>this._result.read(this._fetchTarget,this._state.p).poll(!0),this._fetchTarget=t=>(this._operand=t,this._state.p=this._state.p+1&65535,this._predicate(this._state.flags)?this._result.read(this._firstDummyRead,this._state.p):null),this._firstDummyRead=t=>(this._target=this._state.p+(128&this._operand?this._operand-256:this._operand)&65535,(65280&this._target)==(65280&this._state.p)?(this._state.p=this._target,null):this._result.read(this._secondDummyRead,65280&this._state.p|255&this._target).poll(!0)),this._secondDummyRead=t=>(this._state.p=this._target,null),this._target=0,this._operand=0,this._result=new a.default,this._state=t,this._predicate=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchTarget",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_firstDummyRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_secondDummyRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_predicate",void 0),e.branch=(t,e)=>new o(t,e)},3061:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.write=e.rti=e.push=e.pull=e.nullaryOneCycle=e.rts=e.readModifyWrite=e.jsr=e.branch=void 0;var s=i(806);Object.defineProperty(e,"branch",{enumerable:!0,get:function(){return s.branch}});var r=i(8808);Object.defineProperty(e,"jsr",{enumerable:!0,get:function(){return r.jsr}});var a=i(9958);Object.defineProperty(e,"readModifyWrite",{enumerable:!0,get:function(){return a.readModifyWrite}});var n=i(9133);Object.defineProperty(e,"rts",{enumerable:!0,get:function(){return n.rts}});var o=i(8542);Object.defineProperty(e,"nullaryOneCycle",{enumerable:!0,get:function(){return o.nullaryOneCycle}});var _=i(9e3);Object.defineProperty(e,"pull",{enumerable:!0,get:function(){return _.pull}});var h=i(2786);Object.defineProperty(e,"push",{enumerable:!0,get:function(){return h.push}});var c=i(274);Object.defineProperty(e,"rti",{enumerable:!0,get:function(){return c.rti}});var l=i(7290);Object.defineProperty(e,"write",{enumerable:!0,get:function(){return l.write}})},8808:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.jsr=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t){this.reset=()=>this._result.read(this._fetchPcl,this._state.p),this._fetchPcl=t=>(this._addressLo=t,this._state.p=this._state.p+1&65535,this._result.read(this._dummyStackRead,256+this._state.s)),this._dummyStackRead=()=>this._result.write(this._pushPch,256+this._state.s,this._state.p>>>8),this._pushPch=()=>(this._state.s=this._state.s-1&255,this._result.write(this._pushPcl,256+this._state.s,255&this._state.p)),this._pushPcl=()=>(this._state.s=this._state.s-1&255,this._result.read(this._fetchPch,this._state.p)),this._fetchPch=t=>(this._state.p=this._addressLo|t<<8,null),this._addressLo=0,this._result=new a.default,this._state=t,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyStackRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pushPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pushPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),e.jsr=t=>new o(t)},8542:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.nullaryOneCycle=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e){this.reset=()=>this._result.read(this._executeOperation,this._state.p).poll(!0),this._executeOperation=()=>(this._operation(this._state),null),this._result=new a.default,this._state=t,this._operation=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_executeOperation",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_operation",void 0),e.nullaryOneCycle=(t,e)=>new o(t,e)},9e3:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.pull=void 0;const s=i(655),r=i(3272),a=s.__importDefault(i(9022)),n=s.__importDefault(i(4874));class o{constructor(t,e){this.reset=()=>this._result.read(this._dummyRead,this._state.p).poll(!0),this._dummyRead=()=>this._result.read(this._incrementS,256+this._state.s),this._incrementS=()=>(this._state.s=this._state.s+1&255,this._result.read(this._pull,256+this._state.s)),this._pull=t=>(this._operation(this._state,t),null),this._result=new a.default,this._state=t,this._operation=e,(0,r.freezeImmutables)(this)}}s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyRead",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_incrementS",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pull",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",n.default.State)],o.prototype,"_state",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Function)],o.prototype,"_operation",void 0),e.pull=(t,e)=>new o(t,e)},2786:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.push=void 0;const s=i(655),r=i(3272),a=s.__importDefault(i(4874)),n=s.__importDefault(i(9022));class o{constructor(t,e){this.reset=()=>this._result.read(this._dummyRead,this._state.p),this._dummyRead=()=>this._result.write(this._push,256+this._state.s,this._operation(this._state)),this._push=()=>(this._state.s=this._state.s-1&255,null),this._result=new n.default,this._state=t,this._operation=e,(0,r.freezeImmutables)(this)}}s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyRead",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_push",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",a.default.State)],o.prototype,"_state",void 0),s.__decorate([r.Immutable,s.__metadata("design:type",Function)],o.prototype,"_operation",void 0),e.push=(t,e)=>new o(t,e)},9958:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.readModifyWrite=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e){this.reset=t=>(this._address=t,this._result.read(this._read,t)),this._read=t=>(this._operand=t,this._result.write(this._dummyWrite,this._address,this._operand)),this._dummyWrite=t=>this._result.write(this._write,this._address,this._operation(this._operand,this._state)),this._write=()=>null,this._result=new a.default,this._state=t,this._operation=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_read",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyWrite",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_write",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_operation",void 0),e.readModifyWrite=(t,e)=>new o(t,e)},274:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rti=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t){this.reset=()=>this._result.read(this._dummyOperandRead,this._state.p),this._dummyOperandRead=()=>this._result.read(this._dummyStackRead,256+this._state.s),this._dummyStackRead=()=>(this._state.s=this._state.s+1&255,this._result.read(this._popP,256+this._state.s)),this._popP=t=>(this._state.flags=-17&(32|t),this._state.s=this._state.s+1&255,this._result.read(this._popPcl,256+this._state.s)),this._popPcl=t=>(this._state.p=65280&this._state.p|t,this._state.s=this._state.s+1&255,this._result.read(this._popPch,256+this._state.s)),this._popPch=t=>(this._state.p=255&this._state.p|t<<8,null),this._result=new a.default,this._state=t,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyOperandRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyStackRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_popP",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_popPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_popPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),e.rti=t=>new o(t)},9133:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rts=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t){this.reset=()=>this._result.read(this._dummyOperandRead,this._state.p),this._dummyOperandRead=()=>this._result.read(this._dummyStackRead,256+this._state.s),this._dummyStackRead=()=>(this._state.s=this._state.s+1&255,this._result.read(this._popPcl,256+this._state.s)),this._popPcl=t=>(this._state.p=65280&this._state.p|t,this._state.s=this._state.s+1&255,this._result.read(this._popPch,256+this._state.s)),this._popPch=t=>(this._state.p=255&this._state.p|t<<8,this._result.read(this._incrementP,this._state.p)),this._incrementP=()=>(this._state.p=this._state.p+1&65535,null),this._result=new a.default,this._state=t,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyOperandRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyStackRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_popPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_popPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_incrementP",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),e.rts=t=>new o(t)},7290:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.write=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e){this.reset=t=>this._result.write((()=>null),t,this._operation(this._state)),this._result=new a.default,this._state=t,this._operation=e,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Function)],o.prototype,"_operation",void 0),e.write=(t,e)=>new o(t,e)},2049:(t,e)=>{function i(t,e){e.flags=-131&e.flags|128&t|(t?0:2)}function s(t,e){if(8&e.flags){const i=(15&t)+(15&e.a)+(1&e.flags),s=(t>>>4)+(e.a>>>4)+(i>9?1:0);e.a=i%10|s%10<<4,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|(s>9?1:0)}else{const i=e.a+t+(1&e.flags),s=255&i;e.flags=-196&e.flags|128&s|(s?0:2)|i>>>8|(~(t^e.a)&(s^t)&128)>>>1,e.a=s}return null}function r(t,e){if(8&e.flags){const i=(15&e.a)-(15&t)-(1&~e.flags),s=(e.a>>>4)-(t>>>4)-(i<0?1:0);e.a=(i<0?10+i:i)|(s<0?10+s:s)<<4,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|(s<0?0:1)}else{t=255&~t;const i=e.a+t+(1&e.flags),s=255&i;e.flags=-196&e.flags|128&s|(s?0:2)|i>>>8|(~(t^e.a)&(s^t)&128)>>>1,e.a=s}return null}Object.defineProperty(e,"__esModule",{value:!0}),e.aac=e.isc=e.aax=e.slo=e.rla=e.rra=e.axs=e.dcp=e.alr=e.arr=e.rorRmw=e.rorImmediate=e.rolRmw=e.rolImmediate=e.lsrRmw=e.lsrImmediate=e.sbc=e.cmp=e.bit=e.aslRmw=e.aslImmediate=e.adc=e.genUnary=e.genNullary=e.genRmw=void 0,e.genRmw=function(t,e,s){const r=s(t);return i(r,e),r},e.genNullary=function(t,e){i(e(t),t)},e.genUnary=function(t,e,s){return i(s(t,e),e),null},e.adc=s,e.aslImmediate=function(t){const e=t.a;t.a=t.a<<1&255,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},e.aslRmw=function(t,e){const i=t<<1&255;return e.flags=-132&e.flags|128&i|(i?0:2)|t>>>7,i},e.bit=function(t,e){return e.flags=-195&e.flags|192&t|(t&e.a?0:2),null},e.cmp=function(t,e,i){const s=i(e)+(255&~t)+1;e.flags=-132&e.flags|128&s|(255&s?0:2)|s>>>8},e.sbc=r,e.lsrImmediate=function(t){const e=t.a;t.a=t.a>>>1,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},e.lsrRmw=function(t,e){const i=t>>>1;return e.flags=-132&e.flags|128&i|(i?0:2)|1&t,i},e.rolImmediate=function(t){const e=t.a;t.a=t.a<<1&255|1&t.flags,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|e>>>7},e.rolRmw=function(t,e){const i=t<<1&255|1&e.flags;return e.flags=-132&e.flags|128&i|(i?0:2)|t>>>7,i},e.rorImmediate=function(t){const e=t.a;t.a=t.a>>>1|(1&t.flags)<<7,t.flags=-132&t.flags|128&t.a|(t.a?0:2)|1&e},e.rorRmw=function(t,e){const i=t>>>1|(1&e.flags)<<7;return e.flags=-132&e.flags|128&i|(i?0:2)|1&t,i},e.arr=function(t,e){e.a=(e.a&t)>>>1|(1&e.flags?128:0),e.flags=-196&e.flags|(64&e.a)>>>6|(e.a?0:2)|128&e.a|64&e.a^(32&e.a)<<1},e.alr=function(t,e){const i=e.a&t;return e.a=i>>>1,e.flags=-132&e.flags|128&e.a|(e.a?0:2)|1&i,null},e.dcp=function(t,e){const i=t+255&255,s=e.a+(255&~i)+1;return e.flags=-132&e.flags|128&s|(255&s?0:2)|s>>>8,i},e.axs=function(t,e){const i=(e.a&e.x)+(255&~t)+1;return e.x=255&i,e.flags=-132&e.flags|128&e.x|(255&e.x?0:2)|i>>>8,null},e.rra=function(t,e){const i=t>>>1|(1&e.flags)<<7;return e.flags=-2&e.flags|1&t,s(i,e),i},e.rla=function(t,e){const s=t<<1&255|1&e.flags;return e.flags=-2&e.flags|t>>>7,i(e.a&=s,e),s},e.slo=function(t,e){e.flags=-2&e.flags|t>>>7;const s=t<<1&255;return e.a=e.a|s,i(e.a,e),s},e.aax=function(t){const e=t.a&t.x;return i(e,t),e},e.isc=function(t,e){const i=t+1&255;return r(i,e),i},e.aac=function(t,e){return e.a&=t,i(e.a,e),e.flags=-2&e.flags|(128&e.a)>>>7,null}},8898:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.boot=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t){this.reset=()=>this._result.read(this._pre1Step,255),this._pre1Step=()=>this._result.read(this._pre2Step,255),this._pre2Step=()=>this._result.read(this._stack1Step,256),this._stack1Step=()=>this._result.read(this._stack2Step,511),this._stack2Step=()=>(this._state.s=253,this._result.read(this._stack3Step,510)),this._stack3Step=()=>this._result.read(this._readTargetLoStep,65532),this._readTargetLoStep=t=>(this._targetAddress=t,this._result.read(this._readTargetHiStep,65533)),this._readTargetHiStep=t=>(this._targetAddress|=t<<8,this._state.p=this._targetAddress,null),this._targetAddress=0,this._result=new a.default,this._state=t,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pre1Step",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pre2Step",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_stack1Step",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_stack2Step",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_stack3Step",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_readTargetLoStep",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_readTargetHiStep",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),e.boot=t=>new o(t)},1485:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.irq=e.nmi=e.brk=e.boot=void 0;var s=i(8898);Object.defineProperty(e,"boot",{enumerable:!0,get:function(){return s.boot}});var r=i(2530);Object.defineProperty(e,"brk",{enumerable:!0,get:function(){return r.brk}}),Object.defineProperty(e,"nmi",{enumerable:!0,get:function(){return r.nmi}}),Object.defineProperty(e,"irq",{enumerable:!0,get:function(){return r.irq}})},2530:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.nmi=e.irq=e.brk=void 0;const s=i(655),r=s.__importDefault(i(4874)),a=s.__importDefault(i(9022)),n=i(3272);class o{constructor(t,e,i){this.reset=()=>this._result.read(this._dummyRead,this._state.p),this._dummyRead=()=>(this._isBrk&&(this._state.p=this._state.p+1&65535),this._result.write(this._pushPch,256+this._state.s,this._state.p>>>8)),this._pushPch=()=>(this._state.s=this._state.s-1&255,this._result.write(this._pushPcl,256+this._state.s,255&this._state.p).poll(!0)),this._pushPcl=()=>(this._state.s=this._state.s-1&255,this._vector=this._state.nmi?65530:this._defaultVector,this._result.write(this._pushFlags,256+this._state.s,this._isBrk?16|this._state.flags:-17&this._state.flags)),this._pushFlags=()=>(this._state.s=this._state.s-1&255,this._result.read(this._fetchPcl,this._vector)),this._fetchPcl=t=>(this._state.flags|=4,this._state.p=t,this._result.read(this._fetchPch,++this._vector)),this._fetchPch=t=>(this._state.p=this._state.p|t<<8,this._state.nmi=this._state.irq=!1,null),this._vector=0,this._result=new a.default,this._state=t,this._defaultVector=e,this._isBrk=i,(0,n.freezeImmutables)(this)}}s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"reset",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_dummyRead",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pushPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pushPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_pushFlags",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchPcl",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_fetchPch",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Object)],o.prototype,"_result",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",r.default.State)],o.prototype,"_state",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Number)],o.prototype,"_defaultVector",void 0),s.__decorate([n.Immutable,s.__metadata("design:type",Boolean)],o.prototype,"_isBrk",void 0),e.brk=t=>new o(t,65534,!0),e.irq=t=>new o(t,65534,!1),e.nmi=t=>new o(t,65530,!1)},7451:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(2319));e.default=class{constructor(){this._left=new s.default,this._right=new s.default,this._up=new s.default,this._down=new s.default,this._fire=new s.default}getLeft(){return this._left}getRight(){return this._right}getUp(){return this._up}getDown(){return this._down}getFire(){return this._fire}}},7866:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=i(7819),a=s.__importDefault(i(2319));e.default=class{constructor(){this.valueChanged=new r.Event,this._fireSwitch=new a.default,this._value=.5}setValue(t){this._value=t,this.valueChanged.dispatch(t)}getValue(){return this._value}getFire(){return this._fireSwitch}}},2319:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7819);e.default=class{constructor(t=!1){this._state=t,this.stateChanged=new s.Event,this.beforeRead=new s.Event}read(){return this.beforeRead.dispatch(this),this._state}peek(){return this._state}toggle(t){this._state!==t&&(this._state=t,this.stateChanged.dispatch(t))}}},1337:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655).__importDefault(i(7438));var r;!function(t){t.create=function(t={}){return Object.assign({tvMode:0,enableAudio:!0,randomSeed:-1,emulatePaddles:!0,frameStart:-1,pcmAudio:!1,cpuType:s.default.Type.stateMachine},t)},t.getClockHz=function(t){switch(t.tvMode){case 0:return 3584160;case 1:case 2:return 3556800}}}(r||(r={})),e.default=r},9823:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655).__importDefault(i(2319));e.default=class{constructor(){this._selectSwitch=new s.default,this._resetButton=new s.default,this._colorSwitch=new s.default,this._difficutlyP0=new s.default,this._difficutlyP1=new s.default}getSelectSwitch(){return this._selectSwitch}getResetButton(){return this._resetButton}getColorSwitch(){return this._colorSwitch}getDifficultySwitchP0(){return this._difficutlyP0}getDifficultySwitchP1(){return this._difficutlyP1}}},2982:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,function(t){let e;!function(t){t.vanilla_2k="vanilla_2k",t.vanilla_4k="vanilla_4k",t.bankswitch_2k_cv="bankswitch_2k_cv",t.bankswitch_8k_F8="bankswitch_8k_F8",t.bankswitch_8k_E0="bankswitch_8k_E0",t.bankswitch_8k_3F="bankswitch_8k_3F",t.bankswitch_8k_FE="bankswitch_8k_FE",t.bankswitch_8k_UA="bankswitch_8k_UA",t.bankswitch_8k_DPC="bankswitch_8k_DPC",t.bankswitch_8k_econobanking="bankswitch_8k_econobanking",t.bankswitch_8k_pp="bankswitch_8k_pp",t.bankswitch_12k_FA="bankswitch_12k_FA",t.bankswitch_16k_F6="bankswitch_16k_F6",t.bankswitch_16k_E7="bankswitch_16k_E7",t.bankswitch_FA2="bankswitch_FA2",t.bankswitch_32k_F4="bankswitch_32k_F4",t.bankswitch_64k_F0="bankswitch_64k_F0",t.bankswitch_64k_EF="bankswitch_64k_EF",t.bankswitch_3E="bankswitch_3E",t.bankswitch_supercharger="bankswitch_supercharger",t.bankswitch_dpc_plus="bankswitch_dpc_plus",t.bankswitch_cdf="bankswitch_cdf",t.unknown="unknown"}(e=t.CartridgeType||(t.CartridgeType={})),t.getAllTypes=function(){return[e.vanilla_2k,e.vanilla_4k,e.bankswitch_2k_cv,e.bankswitch_8k_F8,e.bankswitch_8k_E0,e.bankswitch_8k_3F,e.bankswitch_8k_FE,e.bankswitch_8k_UA,e.bankswitch_8k_econobanking,e.bankswitch_8k_pp,e.bankswitch_12k_FA,e.bankswitch_8k_DPC,e.bankswitch_16k_F6,e.bankswitch_16k_E7,e.bankswitch_FA2,e.bankswitch_32k_F4,e.bankswitch_3E,e.bankswitch_64k_F0,e.bankswitch_64k_EF,e.bankswitch_supercharger,e.bankswitch_dpc_plus,e.bankswitch_cdf,e.unknown]},t.describeCartridgeType=function(t){switch(t){case e.vanilla_2k:return"plain 2k";case e.vanilla_4k:return"plain 4k";case e.bankswitch_2k_cv:return"2k CommaVideo scheme";case e.bankswitch_8k_F8:return"bankswitched 8k, F8 (Atari) scheme";case e.bankswitch_8k_E0:return"bankswitched 8k, E0 (Parker Bros.) scheme";case e.bankswitch_8k_3F:return"bankswitched 8k, 3F (Tigervision) scheme";case e.bankswitch_8k_FE:return"bankswitched 8k, FE (Activision) scheme";case e.bankswitch_8k_UA:return"bankswitched 8k, UA (Pleiades) scheme";case e.bankswitch_8k_pp:return"bankswitched 8k, Pink Panther scheme";case e.bankswitch_12k_FA:return"bankswitched 12k, FA (CBS) scheme";case e.bankswitch_8k_DPC:return"bankswitched 8k + DPC";case e.bankswitch_8k_econobanking:return"bankswitched 8k, econobanking scheme";case e.bankswitch_16k_F6:return"bankswitched 16k, F6 (Atari) scheme";case e.bankswitch_16k_E7:return"bankswitched 16k, E7 (M-Network) scheme";case e.bankswitch_FA2:return"bankswitched 28k/29k, FA2 (modified CBS) scheme";case e.bankswitch_32k_F4:return"bankswitched 32k, F4 (Atari) scheme";case e.bankswitch_3E:return"bankswitched 3E (Tigervision + RAM) scheme";case e.bankswitch_64k_F0:return"bankswitched 64k, F0 (Megaboy) scheme";case e.bankswitch_64k_EF:return"bankswitched 64k, EFSC (Homestar Runner) scheme";case e.bankswitch_supercharger:return"bankswitched supercharger";case e.bankswitch_dpc_plus:return"bankswitched DPC+";case e.bankswitch_cdf:return"bankswitched CDF";case e.unknown:return"unknown"}}}(i||(i={})),e.default=i},7028:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=s.__importDefault(i(1337)),a=s.__importDefault(i(6717)),n=i(8483),o=(0,n.decode)("AQEPAQEBAQEBAQEBAwMDAQ=="),_=new Int8Array([1]),h=new Int8Array([1,1]),c=new Int8Array([16,15]),l=(0,n.decode)("AQICAQEBBAM="),u=(0,n.decode)("AQIBAQICBQQCAQMBAQEBBA=="),d=(0,n.decode)("AQQBAwIEAQIDAgEBAQEBAQIEAgEEAQECAgEDAgEDAQEBBAEBAQECAQECBgECAgECAQIBAQIBBgIBAgIBAQEBAgICAgcCAwICAQEBAwIBAQIBAQcBAQMBAQIDAwEBAQICAQECAgQDBQEDAQEFAgEBAQIBAgEDAQIFAQECAQEBBQEBAQEBAQEBBgEBAQIBAQEBBAIBAQMBAwYDAgMBAQIBAgQBAQEDAQEBAQMBAgEEAgIDBAEBBAECAQICAgEBBAMBBAQJBQQBBQMBAQMCAgIBBQECAQEBAgMBAgEBAwQCBQICAQIDAQEBAQECAQMDAwIBAgEBAQEBAwMBAgIDAQMBCA=="),p=(0,n.decode)("BQYEBQoFAwcECgYDBgQJBg=="),f=[_,l,l,(0,n.decode)("AgMCAQQBBgoCBAIBAQQFCQMDBAEBAQgFBQUEAQEBCAQCCAMDAQEHBAIHBQEDAQcEAQQIAgEDBAcBAwcDAgEGBgICBAUDAgYGAQMDAgUDBwMEAwICAgUJAwEFAwECAgsFAQUDAQECDAUBAgUCAQEMBgECBQECAQoGAwICBAECBgo="),h,h,c,u,d,u,c,_,h,h,c,p];e.default=class{constructor(t){this._config=t}setConfig(t){this._config=t}getKey(t,e){return f[t]===h&&o[t]*(e+1)==1?0:t<<5|e}getBuffer(t){const e=t>>>5&15,i=31&t,s=f[e];let n=0;for(let t=0;t<s.length;t++)n+=s[t];n=n*o[e]*(i+1);const _=new Float32Array(n),h=r.default.getClockHz(this._config)/114;let c=0,l=0,u=0,d=!0;for(let t=0;t<n;t++)c++,c===o[e]*(i+1)&&(c=0,l++,l===s[u]&&(u++,l=0,s.length===u&&(u=0)),d=!(1&u)),_[t]=d?1:-1;return new a.default(_,h)}}},6717:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=class{constructor(t,e){this._content=t,this._sampleRate=e}getLength(){return this._content.length}getContent(){return this._content}getSampleRate(){return this._sampleRate}replaceUnderlyingBuffer(t){this._content=t}}},2487:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(7819);e.default=class{constructor(t){this._capacity=t,this.evict=new s.Event,this._size=0,this._index=0,this._buffer=new Array(this._capacity);for(let t=0;t<this._capacity;t++)this._buffer[t]=null}size(){return this._size}pop(){if(0===this._size)return;const t=this._buffer[this._index];return this._buffer[this._index]=null,this._index=(this._index+1)%this._capacity,this._size--,t}push(t){return this._size===this._capacity&&this.evict.dispatch(this.pop()),this._buffer[(this._index+this._size++)%this._capacity]=t,this}forEach(t){for(let e=0;e<this._size;e++)t(this._buffer[(this._index+e)%this._capacity]);return this}clear(){for(let t=0;t<this._capacity;t++)this._buffer[t]=null;return this._size=0,this._index=0,this}capacity(){return this._capacity}}},8483:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.__init=void 0;const i=new Uint8Array(256);function s(t,e){const s=i[t.charCodeAt(e)];if(s>63)throw new Error('invalid base64 character "'+t[e]+'" at index '+e);return s}function r(t,e){return(s(t,e)<<18)+(s(t,e+1)<<12)+(s(t,e+2)<<6)+s(t,e+3)}!function(t){let e;for(e=0;e<256;e++)i[e]=255;for(e=0;e<64;e++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;i["=".charCodeAt(0)]=0}(e.__init||(e.__init={})),e.decode=function(t){if(t.length%4!=0)throw new Error("invalid base64 data --- char count mismatch");const e=t.length/4,i=3*e-function(t){let e=0,i=t.length-1;for(;i>=0&&"="===t[i--];)e++;return e}(t),s=new Uint8Array(i);let a=0;for(let n=0;n<e;n++){const e=r(t,4*n);for(let t=0;t<3&&a<i;t++)s[a++]=e>>>8*(2-t)&255}return s}},5756:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isIOS=e.isSafari=void 0,e.isSafari="safari"in window,e.isIOS=!!navigator.platform.match(/iPhone|iPad|iPod/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},3272:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Immutable=e.freezeImmutables=void 0;const i=Symbol("immutable properties");e.freezeImmutables=function(t){const e=t[i];if(e)for(const i of e)Object.defineProperty(t,i,{writable:!1,configurable:!1})},e.Immutable=function(t,e){t[i]||Object.defineProperty(t,i,{value:[],writable:!1,enumerable:!1}),t[i].push(e)}},2518:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(7819),a=s.__importDefault(i(2089));e.default=class{constructor(t){this._factory=t,this.event={release:new r.Event,dispose:new r.Event},this._pool=[],this._poolSize=0}get(){let t;if(0===this._poolSize){const e=this._factory();t=new a.default(e,(t=>this._releaseMember(t)),(t=>this._disposeMember(t)))}else t=this._pool[--this._poolSize],t._isAvailable=!1;return t}_releaseMember(t){if(t._isAvailable)throw new Error("Trying to release an already released pool member");if(t._isDisposed)throw new Error("Trying to release an already disposed pool member");const e=this._poolSize++;this._pool[e]=t,t._isAvailable=!0,t._poolPosition=e,this.event.release.dispatch(t.get())}_disposeMember(t){if(t._isDisposed)throw new Error("Trying to dispose of an already disposed pool member");t._isAvailable&&(this._poolSize>1&&(this._pool[t._poolPosition]=this._pool[this._poolSize-1]),this._poolSize--),t._isDisposed=!0,this.event.dispose.dispatch(t.get())}}},2089:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=class{constructor(t,e,i){this._value=t,this._releaseCB=e,this._disposeCB=i,this._isAvailable=!1,this._isDisposed=!1}adopt(t){this._value=t}get(){return this._value}release(){this._releaseCB(this)}dispose(){this._disposeCB(this)}}},189:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7819);class r{constructor(){this.message=new s.Event,this._io=null}bind(t){this._io||(t&&t.message.addHandler(r._onAsyncIOMessage,this),this._io=t)}unbind(){this._io&&(this._io.message.removeHandler(r._onAsyncIOMessage,this),this._io=null)}send(t){this._io&&this._io.send(t)}static _onAsyncIOMessage(t,e){e.message.dispatch(t)}}e.default=r},4067:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(7489)),r=i(5756).isIOS;e.default=class{constructor(t,e=1e5,i="stellerator-fullscreen"){this._videoDriver=t,this._zIndex=e,this._fullscreenClass=i,this._resizeListener=()=>{this._resizeHandle||(this._resizeHandle=setTimeout((()=>{this._resizeHandle=null,this._adjustSizeForFullscreen()}),100))},this._resizeHandle=null,this._changeListener=this._onChange.bind(this),this._engaged=!1}engage(){this._engaged||(this._engaged=!0,r||!s.default?(this._adjustSizeForFullscreen(),window.addEventListener("resize",this._resizeListener),this._engaged=!0):(s.default.on("change",this._changeListener),s.default.request(this._videoDriver.getCanvas())))}disengage(){this._engaged&&(r||!s.default?(this._resetSize(),window.removeEventListener("resize",this._resizeListener),this._engaged=!1):s.default.exit())}toggle(){this._engaged?this.disengage():this.engage()}isEngaged(){return this._engaged}_onChange(){s.default&&(s.default.isFullscreen?(window.addEventListener("resize",this._resizeListener),this._adjustSizeForFullscreen()):(this._resetSize(),window.removeEventListener("resize",this._resizeListener),s.default.off("change",this._changeListener),this._engaged=!1))}_resetSize(){const t=this._videoDriver.getCanvas();this._resizeHandle&&(clearTimeout(this._resizeHandle),this._resizeHandle=null),t.style.width="",t.style.height="",t.style.maxWidth="",t.style.maxHeight="",r&&(t.style.position="",t.style.top="",t.style.left="",t.style.zIndex=""),document.body.classList.remove(this._fullscreenClass),setTimeout((()=>this._videoDriver.resize()),0)}_adjustSizeForFullscreen(){const t=this._videoDriver.getCanvas();this._videoDriver.resize(window.innerWidth,window.innerHeight),t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px",t.style.maxWidth=window.innerWidth+"px",t.style.maxHeight=window.innerHeight+"px",r&&(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex=""+this._zIndex),document.body.classList.add(this._fullscreenClass)}}},575:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.auxTargets=e.joystickTargets=void 0;const s=i(655),r=i(7819),a=s.__importDefault(i(2445)),n=i(2326);function o(t){return"object"==typeof t?t.pressed:t>.5}e.joystickTargets=["left","right","up","down","fire","start","select","pause"],e.auxTargets=["start","select","pause"];class _{constructor(){this._onGamepadConnect=()=>this.probeGamepads(),this._onGamepadDisconnect=()=>this.probeGamepads(),this.gamepadCountChanged=new r.Event,this._shadows=null,this._mappings=new Map,this._mappingStates=new WeakMap,this._mappingTargets=new WeakMap,this._bound=!1,this._joysticks=[],this._auxSwitches={},this._gamepadCount=0,this._lastPoll=0,this.setMapping(n.defaultMapping)}static probeGamepadCount(){let t=0;const e=navigator.getGamepads();for(let i=0;i<e.length;i++)e[i]&&t++;return t}init(){if(!navigator.getGamepads)throw new Error("gamepad API not available");this.probeGamepads(),window.addEventListener("gamepadconnected",this._onGamepadConnect),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnect)}deinit(){this.unbind(),window.removeEventListener("gamepadconnected",this._onGamepadConnect),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnect)}bind(t=[],e={}){this._bound||(this._bound=!0,this._joysticks=t,this._auxSwitches=e,this._bound=!0,this._shadows=new WeakMap,this._controlledSwitches().forEach((t=>{const e=new a.default;this._shadows.set(t,e),e.setState(t.read()),t.beforeRead.addHandler(_._onBeforeSwitchRead,this)})))}unbind(){this._bound&&(this._controlledSwitches().forEach((t=>t.beforeRead.removeHandler(_._onBeforeSwitchRead,this))),this._shadows=null,this._auxSwitches={},this._joysticks=[],this._bound=!1)}getGamepadCount(){return this._gamepadCount}setMapping(t,e){void 0!==e&&this._mappings.set(e,t);const i=new Map,s=[];for(const e of t)s.indexOf(e.target)&&(s.push(e.target),i.set(e.target,!1));this._mappingStates.set(t,i),this._mappingTargets.set(t,s)}clearMapping(t){this._mappings.delete(t)}poll(){this._readGamepads()}static _onBeforeSwitchRead(t,e){e.poll()}probeGamepads(){const t=_.probeGamepadCount();t!==this._gamepadCount&&(this._gamepadCount=t,this.gamepadCountChanged.dispatch(this._gamepadCount))}_getSwitchForTarget(t,e=null){if(this._auxSwitches[t])return this._auxSwitches[t];if(!e)return null;switch(t){case"up":return e.getUp();case"down":return e.getDown();case"left":return e.getLeft();case"right":return e.getRight();case"fire":return e.getFire();default:return null}}_controlledSwitches(){const t=[...Object.keys(this._auxSwitches).map((t=>this._auxSwitches[t]))];for(const e of this._joysticks)t.push(e.getLeft(),e.getRight(),e.getUp(),e.getDown(),e.getFire());return t}_readGamepads(){const t=Date.now();if(0===this._gamepadCount||t-this._lastPoll<50)return;this._lastPoll=t;const e=navigator.getGamepads();let i=0;for(let t=0;t<e.length;t++){const s=e[t];if(!s)continue;const r=this._mappings.get(s.id)||n.defaultMapping,a=this._mappingStates.get(r),_=this._mappingTargets.get(r);for(const t of _)a.set(t,!1);for(const t of r)switch(t.type){case"button":const e=s.buttons[t.index];void 0!==e&&o(e)&&a.set(t.target,!0);break;case"axis":const i=s.axes[t.index];void 0!==i&&("positive"===t.sign?i>.5:i<-.5)&&a.set(t.target,!0)}for(const t of _){const e=this._getSwitchForTarget(t,this._joysticks[i]);if(!e)continue;const s=this._shadows.get(e);s.toggle(a.get(t)),s.sync(e)}i++}}}e.default=_},2515:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this._x=-1,this._listener=this._onDocumentMouseMove.bind(this)}bind(t){this._paddle||(this._paddle=t,this._x=-1,document.addEventListener("mousemove",this._listener))}unbind(){this._paddle&&(document.removeEventListener("mousemove",this._listener),this._paddle=null)}_onDocumentMouseMove(t){if(this._x>=0){const e=t.screenX-this._x;let i=this._paddle.getValue();i+=-e/window.innerWidth/.9,i<0&&(i=0),i>1&&(i=1),this._paddle.setValue(i)}this._x=t.screenX}}},6166:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=i(5359),a=s.__importDefault(i(4626)),n=s.__importDefault(i(6465)),o=s.__importDefault(i(4114)),_=s.__importDefault(i(9456)),h=s.__importDefault(i(8301)),c=s.__importDefault(i(2487)),l=i(3305);class u{constructor(t,e={}){this._canvas=t,this._onContextLost=t=>{t.preventDefault(),this._gl=null,this._mainProgram=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._sourceTexture=null,this._phosphorProcessor=null,this._ntscProcessor=null,this._integerScalingProcessor=null,this._scanlineProcessor=null,this._processors=[]},this._onContextRestored=()=>{this._getRenderingContext(),this.init()},this._config=null,this._gl=null,this._video=null,this._capabilities=null,this._mainProgram=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._sourceTexture=null,this._anmiationFrameHandle=0,this._phosphorProcessor=null,this._ntscProcessor=null,this._scanlineProcessor=null,this._integerScalingProcessor=null,this._processors=[],this._pendingFrames=new c.default(3),this._consecutiveUnderflows=0,this._hasFrame=!1,this._config=Object.assign(Object.assign({},{gamma:1,scalingMode:"qis",phosphorLevel:.5,scanlineLevel:.2,tvEmulation:"composite"}),e),this._getRenderingContext(),this._canvas.addEventListener("webglcontextlost",this._onContextLost),this._canvas.addEventListener("webglcontextrestored",this._onContextRestored),this._pendingFrames.evict.addHandler((t=>t.release()))}init(){return this._gl?(this._phosphorProcessor=new n.default(this._gl,this._capabilities),this._ntscProcessor=new o.default(this._gl,this._capabilities),this._scanlineProcessor=new _.default(this._gl,this._capabilities),this._integerScalingProcessor=new h.default(this._gl,this._capabilities),this._updateCanvasSize(),this._mainProgram=a.default.compile(this._gl,r.vsh.plain.source(this._capabilities),r.fsh.blitWithGamma.source(this._capabilities)),this._mainProgram.use(),this._mainProgram.uniform1i("u_Sampler0",0),this._createVertexCoordinateBuffer(),this._createTextureCoordinateBuffer(),this._configureSourceTexture(),this._applyConfiguration(),this):this}close(){const t=this._gl;if(this._cancelDraw(),this.unbind(),t)return this._mainProgram.delete(),t.deleteBuffer(this._vertexCoordinateBuffer),t.deleteBuffer(this._textureCoordinateBuffer),t.deleteTexture(this._sourceTexture),this._ntscProcessor.destroy(),this._phosphorProcessor.destroy(),this._scanlineProcessor.destroy(),this._integerScalingProcessor.destroy(),this;this._canvas.removeEventListener("webglcontextlost",this._onContextLost),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestored),this._pendingFrames.forEach((t=>t.release()))}resize(t,e){return this._updateCanvasSize(t,e),this._updateVertexBuffer(),this._video&&(this._configureProcessors(),this._scheduleDraw()),this._hasFrame&&this._draw(),this}getCanvas(){return this._canvas}bind(t){return this._video||(this._video=t,this._video.newFrame.addHandler(u._frameHandler,this),this._configureProcessors(),this._scheduleDraw()),this}unbind(){return this._video?(this._cancelDraw(),this._video.newFrame.removeHandler(u._frameHandler,this),this._video=null,this._pendingFrames.forEach((t=>t.release())),this._pendingFrames.clear(),this):this}getConfig(){return this._config}updateConfig(t){return this}static _frameHandler(t,e){e._pendingFrames.size()===e._pendingFrames.capacity()&&(e._pendingFrames.forEach((t=>t.release())),e._pendingFrames.clear()),e._pendingFrames.push(t),e._scheduleDraw()}_getRenderingContext(){const t={alpha:!1,depth:!1,antialias:!1};if(this._gl=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t),!this._gl)throw new Error("unable to acquire webgl context");this._capabilities=(0,l.detect)(this._gl)}_scheduleDraw(){0===this._anmiationFrameHandle&&(this._anmiationFrameHandle=requestAnimationFrame((()=>this._onAnimationFrame())))}_cancelDraw(){0!==this._anmiationFrameHandle&&cancelAnimationFrame(this._anmiationFrameHandle),this._anmiationFrameHandle=0}_onAnimationFrame(){const t=this._gl;if(this._anmiationFrameHandle=0,0===this._pendingFrames.size())return void(this._consecutiveUnderflows++<=5&&this._scheduleDraw());this._consecutiveUnderflows=0,this._scheduleDraw();const e=this._pendingFrames.pop();t&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._sourceTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.get()),e.release(),this._hasFrame=!0,this._draw())}_draw(){if(!this._gl)return;const t=this._gl;let e=this._sourceTexture;for(const t of this._processors)t.render(e),e=t.getTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,"none"===this._config.scalingMode?t.NEAREST:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,"none"===this._config.scalingMode?t.NEAREST:t.LINEAR),this._mainProgram.use(),this._mainProgram.bindVertexAttribArray("a_VertexPosition",this._vertexCoordinateBuffer,2,t.FLOAT,!1,0,0),this._mainProgram.bindVertexAttribArray("a_TextureCoordinate",this._textureCoordinateBuffer,2,t.FLOAT,!1,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_STRIP,0,4)}_createVertexCoordinateBuffer(){if(!this._gl)return;const t=this._gl,e=t.drawingBufferWidth,i=t.drawingBufferHeight,s=e>0?2/e:1,r=i>0?2/i:1;let a,n,o,_;4/3*i<=e?(n=2,a=4/3*i*s,_=1,o=Math.floor(-4/3*i)/2*s):(n=e/(4/3)*r,a=2,_=Math.floor(e/(4/3))/2*r,o=-1);const h=[o+a,_,o,_,o+a,_-n,o,_-n];this._vertexCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW)}_updateVertexBuffer(){this._gl&&(this._gl.deleteBuffer(this._vertexCoordinateBuffer),this._createVertexCoordinateBuffer())}_createTextureCoordinateBuffer(){if(!this._gl)return;const t=this._gl;this._textureCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW)}_updateCanvasSize(t,e){void 0!==t&&void 0!==e||(t=this.getCanvas().clientWidth,e=this.getCanvas().clientHeight);const i=window.devicePixelRatio||1;this.getCanvas().width=t*i,this.getCanvas().height=e*i}_configureSourceTexture(){if(!this._gl)return;const t=this._gl;this._sourceTexture||(this._sourceTexture=t.createTexture()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._sourceTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1)}_configureProcessors(){if(!this._video||!this._gl)return;switch(this._phosphorProcessor.configure(this._config.phosphorLevel),this._scanlineProcessor.configure(this._config.scanlineLevel),this._integerScalingProcessor.configure(this._gl.drawingBufferWidth,this._gl.drawingBufferHeight),this._config.tvEmulation){case"composite":this._ntscProcessor.configure("composite");break;case"svideo":this._ntscProcessor.configure("svideo")}let t=this._video.getWidth(),e=this._video.getHeight();for(const i of this._processors)i.resize(t,e),t=i.getWidth(),e=i.getHeight()}_applyConfiguration(){this._gl&&(this._mainProgram.use(),this._mainProgram.uniform1f("u_Gamma",this._config.gamma),this._processors=[],"none"!==this._config.tvEmulation&&(this._ntscProcessor.init(),this._processors.push(this._ntscProcessor)),this._config.phosphorLevel>0&&(this._phosphorProcessor.init(),this._processors.push(this._phosphorProcessor)),this._config.scanlineLevel>0&&(this._scanlineProcessor.init(),this._processors.push(this._scanlineProcessor)),"qis"===this._config.scalingMode&&(this._integerScalingProcessor.init(),this._processors.push(this._integerScalingProcessor)),this._configureProcessors())}}e.default=u},2845:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(8125),a=s.__importDefault(i(2375)),n=s.__importDefault(i(4811)),o=["touchstart","click","keydown"],_=window.AudioContext||window.webkitAudioContext;function h(t,e=500){return new Promise((i=>{t.then((()=>i())),setTimeout(i,e)}))}class c{constructor(){if(this._interactionListener=()=>{const t=this.context;this.interactionRequired=!1,o.forEach((t=>document.removeEventListener(t,this._interactionListener))),this.mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){return yield h(t.resume()),new Promise((e=>setTimeout((()=>s.__awaiter(this,void 0,void 0,(function*(){yield h(t.suspend()),e()}))),100)))}))))},this.mutex=new r.Mutex,this.context=null,this.interactionRequired=!0,_){this.context=new _;try{this.context.destination.channelCount=1}catch(t){console.warn("audio driver: failed to set channel count")}o.forEach((t=>document.addEventListener(t,this._interactionListener)))}}stopListening(){o.forEach((t=>document.removeEventListener(t,this._interactionListener)))}}let l=new c;e.default=class{constructor(t=0,e=0,i){this._touchListener=()=>{o.forEach((t=>document.removeEventListener(t,this._touchListener,!0))),this._context&&(this._context.resume(),setTimeout((()=>{this._mutex.runExclusive((()=>this._suspended?this._context.suspend():this._context.resume()))}),10))},this._context=null,this._merger=null,this._waveformChannels=null,this._pcmChannels=null,this._channels=null,this._cache=new Map,this._mutex=new r.Mutex,this._suspended=!0,this._isBound=!1,this._waveformChannels=new Array(t),this._pcmChannels=new Array(e);for(let e=0;e<t;e++)this._waveformChannels[e]=new a.default(this._cache);for(let t=0;t<e;t++)this._pcmChannels[t]=new n.default(i);this._channels=[...this._waveformChannels,...this._pcmChannels]}init(){const t=l;l=new c,this._context=t.context,t.stopListening(),this._mutex=t.mutex,t.interactionRequired&&o.forEach((t=>document.addEventListener(t,this._touchListener,!0))),this._merger=this._context.createChannelMerger(this._channels.length),this._merger.connect(this._context.destination),this._channels.forEach((t=>t.init(this._context,this._merger)))}bind(t=[],e=[]){if(!this._isBound){if(t.length!==this._waveformChannels.length)throw new Error(`invalid number of waveform sources: expected ${this._waveformChannels.length}, got ${t.length}`);if(e.length!==this._pcmChannels.length)throw new Error(`invalid number of waveform sources: expected ${this._pcmChannels.length}, got ${e.length}`);this._waveformChannels.forEach(((e,i)=>e.bind(t[i]))),this._pcmChannels.forEach(((t,i)=>t.bind(e[i]))),this._isBound=!0,this.resume()}}unbind(){this._isBound&&(this._channels.forEach((t=>t.unbind())),this._isBound=!1,this.pause())}setMasterVolume(t,e){this._channels[t].setMasterVolume(e)}pause(){return this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){this._suspended||(this._suspended=!0,yield h(this._context.suspend()))}))))}resume(){return this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){this._suspended&&(this._suspended=!1,yield h(this._context.resume()))}))))}close(){this._mutex.runExclusive((()=>this._context.close()))}}},8971:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=class{constructor(){this._buffer=new Float32Array(2),this._fractionalIndex=0,this._needsData=!1,this._ratio=0,this.reset(1,1)}reset(t,e){this._ratio=t/e,this._needsData=!1,this._fractionalIndex=0;for(let t=0;t<2;t++)this._buffer[t]=0}get(){const t=(1-this._fractionalIndex)*this._buffer[0]+this._fractionalIndex*this._buffer[1];return this._fractionalIndex+=this._ratio,this._fractionalIndex>1&&(this._fractionalIndex-=1,this._needsData=!0),t}push(t){this._buffer[0]=this._buffer[1],this._buffer[1]=t,this._needsData=!1}needsData(){return this._needsData}}},4811:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=s.__importDefault(i(2487)),a=s.__importDefault(i(8971));class n{constructor(t=1024){this._hostFragmentSize=t,this._outputSampleRate=0,this._bufferSize=0,this._volume=1,this._gain=null,this._processor=null,this._bufferUnderrun=!1,this._fragmentRing=null,this._fragmentSize=0,this._inputSampleRate=0,this._fragmentIndex=0,this._currentFragment=null,this._lastFragment=null,this._resampler=new a.default}init(t,e){this._outputSampleRate=t.sampleRate,this._gain=t.createGain(),this._gain.gain.value=this._volume,this._gain.connect(e),this._processor=t.createScriptProcessor(this._hostFragmentSize,1,1),this._bufferSize=this._processor.bufferSize,this._processor.connect(this._gain),this._processor.onaudioprocess=t=>this._processAudio(t),t.createBuffer(1,1,t.sampleRate).getChannelData(0).set([0])}bind(t){this.unbind(),this._audio=t,this._fragmentSize=t.getFrameSize(),this._inputSampleRate=t.getSampleRate(),this._fragmentIndex=0,this._lastFragment=null,this._bufferUnderrun=!0,this._fragmentRing=new r.default(Math.ceil(4*this._bufferSize/this._outputSampleRate/this._fragmentSize*this._inputSampleRate)),this._fragmentRing.evict.addHandler((t=>t.release())),this._audio.newFrame.addHandler(n._onNewFragment,this),this._resampler.reset(this._inputSampleRate,this._outputSampleRate)}unbind(){this._audio&&(this._audio.newFrame.removeHandler(n._onNewFragment,this),this._lastFragment&&(this._lastFragment.release(),this._lastFragment=null),this._currentFragment&&(this._currentFragment.release(),this._currentFragment=null),this._fragmentRing&&(this._fragmentRing.forEach((t=>t.release())),this._fragmentRing.clear(),this._fragmentRing=null))}setMasterVolume(t){this._volume=t}static _onNewFragment(t,e){e._fragmentRing.push(t),e._currentFragment||(e._currentFragment=e._fragmentRing.pop(),e._fragmentIndex=0)}_processAudio(t){if(!this._audio)return;const e=t.outputBuffer.getChannelData(0);let i=0;const s=t=>{const s=this._lastFragment&&this._lastFragment.get();for(;i<t;)this._resampler.needsData()&&(this._resampler.push(this._audio&&this._audio.isPaused()||!s?0:s[this._fragmentIndex++]*this._volume),this._fragmentIndex>=this._fragmentSize&&(this._fragmentIndex=0)),e[i++]=this._resampler.get()};this._currentFragment&&this._bufferUnderrun&&(s(this._bufferSize>>>1),this._bufferUnderrun=!1);let r=this._currentFragment&&this._currentFragment.get();for(;i<this._bufferSize&&this._currentFragment;)this._resampler.needsData()&&(this._resampler.push(r[this._fragmentIndex++]*this._volume),this._fragmentIndex>=this._fragmentSize&&(this._fragmentIndex=0,this._lastFragment&&this._lastFragment.release(),this._lastFragment=this._currentFragment,this._currentFragment=this._fragmentRing.pop(),r=this._currentFragment&&this._currentFragment.get())),e[i++]=this._resampler.get();i<this._bufferSize&&(this._bufferUnderrun=!0),s(this._bufferSize)}}e.default=n},2375:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(t){this._cache=t,this._context=null,this._source=null,this._gain=null,this._audio=null,this._volume=0,this._masterVolume=1}init(t,e){this._context=t,this._gain=this._context.createGain(),this._gain.connect(e)}bind(t){this._audio||(this._audio=t,this._volume=this._audio.getVolume(),this._updateGain(),this._audio.volumeChanged.addHandler(i._onVolumeChanged,this),this._audio.bufferChanged.addHandler(i._onBufferChanged,this),this._audio.stop.addHandler(i._onStop,this))}unbind(){this._audio&&(this._audio.volumeChanged.removeHandler(i._onVolumeChanged,this),this._audio.bufferChanged.removeHandler(i._onBufferChanged,this),this._audio.stop.removeHandler(i._onStop,this),this._source&&(this._source.stop(),this._source=null),this._audio=null)}setMasterVolume(t){this._masterVolume=t,this._updateGain()}static _onVolumeChanged(t,e){e._volume=t,e._updateGain()}static _onBufferChanged(t,e){if(!e._cache.has(t)){const i=e._audio.getBuffer(t),s=e._context.createBuffer(1,i.getLength(),i.getSampleRate());s.getChannelData(0).set(i.getContent()),e._cache.set(t,s)}const i=e._cache.get(t),s=e._context.createBufferSource();e._source&&e._source.stop(),s.loop=!0,s.buffer=i,s.connect(e._gain),s.start(),e._source=s}static _onStop(t,e){e._source&&(e._source.stop(),e._source=null)}_updateGain(){this._gain.gain.value=this._volume*this._masterVolume}}e.default=i},2485:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.axis=e.button=void 0,e.button=function(t,e){return{type:"button",index:t,target:e}},e.axis=function(t,e,i){return{type:"axis",index:t,sign:e,target:i}}},2445:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this._state=!1,this._dirty=!1}toggle(t){t!==this._state&&(this._state=t,this._dirty=!0)}setState(t){this._state=t,this._dirty=!1}sync(t){this._dirty&&(t.toggle(this._state),this._dirty=!1)}}},2326:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.defaultMapping=void 0;const s=i(2485);e.defaultMapping=[(0,s.button)(12,"up"),(0,s.button)(13,"down"),(0,s.button)(14,"left"),(0,s.button)(15,"right"),(0,s.button)(8,"select"),(0,s.button)(9,"start"),...[0,1,2,3,10,11].map((t=>(0,s.button)(t,"fire"))),...[4,5,6,7].map((t=>(0,s.button)(t,"pause"))),(0,s.axis)(0,"negative","left"),(0,s.axis)(0,"positive","right"),(0,s.axis)(1,"negative","up"),(0,s.axis)(1,"positive","down"),(0,s.axis)(2,"negative","left"),(0,s.axis)(2,"positive","right"),(0,s.axis)(3,"negative","up"),(0,s.axis)(3,"positive","down")],e.default=e.defaultMapping},3305:(t,e)=>{function i(t,e){const i=t.createTexture(),s=t.createFramebuffer();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,64,64,0,t.RGBA,e,null),t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const r=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.deleteFramebuffer(s),t.deleteTexture(i),r===t.FRAMEBUFFER_COMPLETE}function s(t){return t.getExtension("WEBGL_color_buffer_float"),!!t.getExtension("OES_texture_float")&&i(t,t.FLOAT)}function r(t){t.getExtension("EXT_color_buffer_half_float");const e=t.getExtension("OES_texture_half_float");return!!e&&i(t,e.HALF_FLOAT_OES)}function a(t,e,i){const s=t.getShaderPrecisionFormat(e,i);return!!s&&s.precision>0}Object.defineProperty(e,"__esModule",{value:!0}),e.detect=void 0,e.detect=function(t=null){if(!t){const e=document.createElement("canvas");e.width=64,e.height=64,t=e.getContext("webgl")||e.getContext("experimental-webgl")}return t?{floatTextures:s(t),halfFloatTextures:r(t),highpInFsh:a(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT),highpInVsh:a(t,t.VERTEX_SHADER,t.HIGH_FLOAT)}:null}},8301:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(4626)),r=i(5359);e.default=class{constructor(t,e){this._gl=t,this._capabilities=e,this._width=0,this._height=0,this._widthFrom=0,this._heightFrom=0,this._widthTo=0,this._heightTo=0,this._texture=null,this._program=null,this._framebuffer=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._initialized=!1}init(){if(this._initialized)return;const t=this._gl;this._framebuffer=t.createFramebuffer(),this._program=s.default.compile(t,r.vsh.plain.source(this._capabilities),r.fsh.blit.source(this._capabilities)),this._program.use(),this._program.uniform1i("u_Sampler0",0),this._vertexCoordinateBuffer=t.createBuffer(),this._textureCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),this._initialized=!0}destroy(){if(!this._initialized)return;const t=this._gl;this._program.delete(),t.deleteFramebuffer(this._framebuffer),t.deleteBuffer(this._vertexCoordinateBuffer),t.deleteBuffer(this._textureCoordinateBuffer),this._texture&&t.deleteTexture(this._texture),this._initialized=!1}render(t){const e=this._gl;this._program.use(),this._program.bindVertexAttribArray("a_VertexPosition",this._vertexCoordinateBuffer,2,e.FLOAT,!1,0,0),this._program.bindVertexAttribArray("a_TextureCoordinate",this._textureCoordinateBuffer,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),e.viewport(0,0,this._width,this._height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4)}getWidth(){return this._width}getHeight(){return this._height}getTexture(){return this._texture}resize(t,e){this._widthFrom=t,this._heightFrom=e,this._reconfigure()}configure(t,e){this._widthTo=t,this._heightTo=e,this._reconfigure()}_reconfigure(){if(this._widthFrom<=0||this._heightFrom<=0||this._widthTo<=0||this._heightTo<=0||!this._initialized)return;this._width=this._widthTo>this._widthFrom?Math.floor(this._widthTo/this._widthFrom)*this._widthFrom:this._widthFrom,this._height=this._heightTo>this._heightFrom?Math.floor(this._heightTo/this._heightFrom)*this._heightFrom:this._heightFrom;const t=this._gl;this._texture&&t.deleteTexture(this._texture),this._texture=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._width,this._height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}}},4114:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(4626)),r=i(5359);e.default=class{constructor(t,e){this._gl=t,this._capabilities=e,this._height=0,this._programPass1=null,this._programPass2=null,this._targetPass1=null,this._targetPass2=null,this._framebuffer=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._initialized=!1}init(){if(this._initialized)return;const t=this._gl;t.getExtension("WEBGL_color_buffer_float"),t.getExtension("OES_texture_float"),this._programPass1=s.default.compile(t,r.vsh.plain.source(this._capabilities),r.fsh.ntscPass1.source(this._capabilities)),this._programPass2=s.default.compile(t,r.vsh.plain.source(this._capabilities),r.fsh.ntscPass2.source(this._capabilities)),this._programPass1.use(),this._programPass1.uniform1i("u_Sampler0",0),this._programPass2.use(),this._programPass2.uniform1i("u_Sampler0",0),this._framebuffer=t.createFramebuffer(),this._vertexCoordinateBuffer=t.createBuffer(),this._textureCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),this._initialized=!0}destroy(){if(!this._initialized)return;const t=this._gl;this._programPass1.delete(),this._programPass2.delete(),t.deleteFramebuffer(this._framebuffer),t.deleteTexture(this._targetPass1),t.deleteTexture(this._targetPass2),t.deleteBuffer(this._vertexCoordinateBuffer),t.deleteBuffer(this._textureCoordinateBuffer),this._initialized=!1}render(t){this._pass(t,this._targetPass1,this._programPass1,960),this._pass(this._targetPass1,this._targetPass2,this._programPass2,480)}getWidth(){return 480}getHeight(){return this._height}getTexture(){return this._targetPass2}resize(t,e){if(!this._initialized)return;if(160!==t)throw new Error("NTSC postprocessor supports only for width = 160");this._height=e;const i=this._gl;this._targetPass1&&i.deleteTexture(this._targetPass1),this._targetPass2&&i.deleteTexture(this._targetPass2),this._targetPass1=i.createTexture(),this._targetPass2=i.createTexture(),i.activeTexture(i.TEXTURE0);for(const t of[this._targetPass1,this._targetPass2])i.bindTexture(i.TEXTURE_2D,t),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t===this._targetPass2?480:960,e,0,i.RGBA,t===this._targetPass1?this._textureType():i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)}configure(t){this._initialized&&(this._programPass1.use(),"composite"===t?(this._programPass1.uniform1f("u_Artifacting",1),this._programPass1.uniform1f("u_Fringing",1)):(this._programPass1.uniform1f("u_Artifacting",0),this._programPass1.uniform1f("u_Fringing",0)))}_pass(t,e,i,s){const r=this._gl;i.use(),i.bindVertexAttribArray("a_VertexPosition",this._vertexCoordinateBuffer,2,r.FLOAT,!1,0,0),i.bindVertexAttribArray("a_TextureCoordinate",this._textureCoordinateBuffer,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this._framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.viewport(0,0,s,this._height),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_STRIP,0,4)}_textureType(){const t=this._gl;return this._capabilities.floatTextures?t.FLOAT:this._capabilities.halfFloatTextures?t.getExtension("OES_texture_half_float").HALF_FLOAT_OES:t.UNSIGNED_BYTE}}},6465:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(4626)),r=i(5359);e.default=class{constructor(t,e){this._gl=t,this._capabilities=e,this._width=0,this._height=0,this._texture0=null,this._texture1=null,this._framebuffer=null,this._program=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._initialized=!1}init(){if(this._initialized)return;const t=this._gl;this._framebuffer=t.createFramebuffer(),this._program=s.default.compile(t,r.vsh.plain.source(this._capabilities),r.fsh.phosphor.source(this._capabilities)),this._program.use(),this._program.uniform1i("u_Sampler_NewImage",0),this._program.uniform1i("u_Sampler_PreviousImage",1),this._vertexCoordinateBuffer=t.createBuffer(),this._textureCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),this._initialized=!0}destroy(){if(!this._initialized)return;const t=this._gl;this._program.delete(),t.deleteFramebuffer(this._framebuffer),t.deleteBuffer(this._vertexCoordinateBuffer),t.deleteBuffer(this._textureCoordinateBuffer),this._texture0&&t.deleteTexture(this._texture0),this._texture1&&t.deleteTexture(this._texture1),this._initialized=!1}render(t){const e=this._gl;this._program.use(),this._program.bindVertexAttribArray("a_VertexPosition",this._vertexCoordinateBuffer,2,e.FLOAT,!1,0,0),this._program.bindVertexAttribArray("a_TextureCoordinate",this._textureCoordinateBuffer,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._texture0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture1,0),e.viewport(0,0,this._width,this._height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4);const i=this._texture1;this._texture1=this._texture0,this._texture0=i}getWidth(){return this._width}getHeight(){return this._height}getTexture(){return this._texture0}resize(t,e){if(!this._initialized)return;this._width=t,this._height=e;const i=this._gl;this._texture0&&i.deleteTexture(this._texture0),this._texture1&&i.deleteTexture(this._texture1),this._texture0=i.createTexture(),this._texture1=i.createTexture(),i.bindFramebuffer(i.FRAMEBUFFER,this._framebuffer),i.viewport(0,0,t,e),i.clearColor(0,0,0,1),i.activeTexture(i.TEXTURE0);for(const s of[this._texture0,this._texture1])i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),i.clear(i.COLOR_BUFFER_BIT)}configure(t){this._initialized&&(this._program.use(),this._program.uniform1f("u_PhosphorLevel",t))}}},4626:(t,e)=>{function i(t,e,i){const s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(`failed to compile shader:\n\n${t.getShaderInfoLog(s)}\n\n${i}`);return s}Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i,s){this._gl=t,this._program=e,this._vsh=i,this._fsh=s,this._attributeLocations=new Map,this._uniformLocations=new Map}static compile(t,e,r,a={a_VertexPosition:0}){const n=i(t,t.VERTEX_SHADER,e),o=i(t,t.FRAGMENT_SHADER,r),_=t.createProgram();for(const e of Object.keys(a))t.bindAttribLocation(_,a[e],e);if(t.attachShader(_,n),t.attachShader(_,o),t.linkProgram(_),!t.getProgramParameter(_,t.LINK_STATUS))throw new Error(`failed to link program:\n\n${t.getProgramInfoLog(_)}`);return new s(t,_,n,o)}delete(){const t=this._gl;t.deleteProgram(this._program),t.deleteShader(this._vsh),t.deleteShader(this._fsh)}use(){this._gl.useProgram(this._program)}getAttribLocation(t){if(!this._attributeLocations.has(t)){const e=this._gl.getAttribLocation(this._program,t);if(e<0)throw new Error(`invalid attribute ${t}`);this._attributeLocations.set(t,e)}return this._attributeLocations.get(t)}getUniformLocation(t){if(!this._uniformLocations.has(t)){const e=this._gl.getUniformLocation(this._program,t);if(null===e)throw new Error(`invalid uniform ${t}`);this._uniformLocations.set(t,e)}return this._uniformLocations.get(t)}bindVertexAttribArray(t,e,i,s,r,a,n){const o=this._gl;o.bindBuffer(o.ARRAY_BUFFER,e),o.vertexAttribPointer(this.getAttribLocation(t),i,s,r,a,n),o.enableVertexAttribArray(this.getAttribLocation(t))}uniform1i(t,e){this._gl.uniform1i(this.getUniformLocation(t),e)}uniform1f(t,e){this._gl.uniform1f(this.getUniformLocation(t),e)}}e.default=s},9456:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655).__importDefault(i(4626)),r=i(5359);e.default=class{constructor(t,e){this._gl=t,this._capabilities=e,this._width=0,this._height=0,this._texture=null,this._program=null,this._framebuffer=null,this._vertexCoordinateBuffer=null,this._textureCoordinateBuffer=null,this._initialized=!1}init(){if(this._initialized)return;const t=this._gl;this._framebuffer=t.createFramebuffer(),this._program=s.default.compile(t,r.vsh.plain.source(this._capabilities),r.fsh.scanlines.source(this._capabilities)),this._program.use(),this._program.uniform1i("u_Sampler0",0),this._vertexCoordinateBuffer=t.createBuffer(),this._textureCoordinateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),this._initialized=!0}destroy(){if(!this._initialized)return;const t=this._gl;this._program.delete(),t.deleteFramebuffer(this._framebuffer),t.deleteBuffer(this._vertexCoordinateBuffer),t.deleteBuffer(this._textureCoordinateBuffer),this._texture&&t.deleteTexture(this._texture),this._initialized=!1}render(t){const e=this._gl;this._program.use(),this._program.bindVertexAttribArray("a_VertexPosition",this._vertexCoordinateBuffer,2,e.FLOAT,!1,0,0),this._program.bindVertexAttribArray("a_TextureCoordinate",this._textureCoordinateBuffer,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),e.viewport(0,0,this._width,2*this._height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4)}getWidth(){return this._width}getHeight(){return 2*this._height}getTexture(){return this._texture}resize(t,e){if(!this._initialized)return;this._width=t,this._height=e;const i=this._gl;this._texture&&i.deleteTexture(this._texture),this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,2*e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),this._program.use(),this._program.uniform1f("u_Height",2*this._height)}configure(t){this._initialized&&(this._program.use(),this._program.uniform1f("u_Level",1-t))}}},5359:(t,e)=>{function i(t){return`precision ${t.highpInVsh?"highp":"mediump"} float;`}Object.defineProperty(e,"__esModule",{value:!0}),e.fsh=e.vsh=void 0,function(t){let e;!function(t){t.source=t=>`\n            ${function(t){return`precision ${t.highpInVsh?"highp":"mediump"} float;`}(t)}\n\n            attribute vec2 a_VertexPosition;\n            attribute vec2 a_TextureCoordinate;\n\n            varying vec2 v_TextureCoordinate;\n\n            void main() {\n                v_TextureCoordinate = a_TextureCoordinate;\n                gl_Position = vec4(a_VertexPosition, 0, 1);\n            }\n        `}(e=t.plain||(t.plain={}))}(e.vsh||(e.vsh={})),function(t){let e,s,r,a,n,o;!function(t){t.source=t=>`\n            ${i(t)}\n\n            varying vec2 v_TextureCoordinate;\n\n            uniform sampler2D u_Sampler0;\n\n            void main() {\n                gl_FragColor = vec4(texture2D(u_Sampler0, v_TextureCoordinate).rgb, 1.0);\n            }\n        `}(e=t.blit||(t.blit={})),function(t){t.source=t=>`\n            ${i(t)}\n\n            varying vec2 v_TextureCoordinate;\n\n            uniform sampler2D u_Sampler0;\n            uniform float u_Gamma;\n\n            void main() {\n                vec4 texel = texture2D(u_Sampler0, v_TextureCoordinate);\n\n                gl_FragColor = vec4(pow(texel.rgb, vec3(u_Gamma)), 1.);\n            }\n        `}(s=t.blitWithGamma||(t.blitWithGamma={})),function(t){t.source=t=>`\n            ${i(t)}\n\n            varying vec2 v_TextureCoordinate;\n\n            uniform float u_PhosphorLevel;\n            uniform sampler2D u_Sampler_NewImage;\n            uniform sampler2D u_Sampler_PreviousImage;\n\n            float applyPhosphor(float new, float previous) {\n                float decayed = previous * u_PhosphorLevel;\n                decayed = step(0.5, (previous - decayed) * 255.0) * decayed;\n\n                return max(new, decayed);\n            }\n\n            void main() {\n                vec4 new = texture2D(u_Sampler_NewImage, v_TextureCoordinate);\n                vec4 previous = texture2D(u_Sampler_PreviousImage, v_TextureCoordinate);\n\n                gl_FragColor = vec4(\n                    applyPhosphor(new.r, previous.r),\n                    applyPhosphor(new.g, previous.g),\n                    applyPhosphor(new.b, previous.b),\n                    1.0\n                );\n            }\n        `}(r=t.phosphor||(t.phosphor={})),function(t){t.source=t=>`\n            ${i(t)}\n\n            #define PI 3.14159265\n\n            #define CHROMA_MOD_FREQ (PI / 3.0)\n\n            #define SATURATION 1.0\n            #define BRIGHTNESS 1.0\n\n            uniform sampler2D u_Sampler0;\n            uniform float u_Fringing;\n            uniform float u_Artifacting;\n\n            varying vec2 v_TextureCoordinate;\n\n            const mat3 yiq_mat = mat3(\n                0.2989, 0.5870, 0.1140,\n                0.5959, -0.2744, -0.3216,\n                0.2115, -0.5229, 0.3114\n            );\n\n            vec3 rgb2yiq(vec3 col) {\n                return col * yiq_mat;\n            }\n\n            ${t.floatTextures||t.halfFloatTextures?"":"\n                vec4 pack(vec3 yiq) {\n                    yiq += 1.2;\n                    yiq /= 3.4;\n\n                    int y_byte = int(yiq.r * 1024.0);\n                    int i_byte = int(yiq.g * 1024.0);\n                    int q_byte = int(yiq.b * 1024.0);\n\n                    int y_high = (y_byte / 4) * 4;\n                    int i_high = (i_byte / 4) * 4;\n                    int q_high = (q_byte / 4) * 4;\n                    int alpha = (q_byte - q_high) * 16 + (i_byte - i_high) * 4 + (y_byte - y_high);\n\n                    return vec4(\n                        float(y_high / 4) / 255.0,\n                        float(i_high / 4) / 255.0,\n                        float(q_high / 4) / 255.0,\n                        float(alpha) / 255.0\n                    );\n                }\n                "}\n\n            void main() {\n                mat3 mix_mat = mat3(\n                    BRIGHTNESS, u_Fringing, u_Fringing,\n                    u_Artifacting, 2.0 * SATURATION, 0.0,\n                    u_Artifacting, 0.0, 2.0 * SATURATION\n                );\n\n                vec3 col = texture2D(u_Sampler0, v_TextureCoordinate).rgb;\n                vec3 yiq = rgb2yiq(col);\n\n                float mod_phase = v_TextureCoordinate.x * 960.0 * CHROMA_MOD_FREQ;\n\n                float i_mod = cos(mod_phase);\n                float q_mod = sin(mod_phase);\n\n                yiq.yz *= vec2(i_mod, q_mod); // Modulate.\n                yiq *= mix_mat; // Cross-talk.\n                yiq.yz *= vec2(i_mod, q_mod); // Demodulate.\n\n                gl_FragColor = ${t.floatTextures||t.halfFloatTextures?"vec4(yiq, 1.0)":"pack(yiq)"};\n            }\n        `}(a=t.ntscPass1||(t.ntscPass1={})),function(t){const e=[1202e-8,22146e-9,13155e-9,1202e-8,49979e-9,11394e-8,12215e-8,5612e-9,170516e-9,237199e-9,16964e-8,285688e-9,984574e-9,.002018683,.002002275,-909882e-9,-.007049081,-.01322286,-.012606931,.00246086,.035868225,.084016453,.1355635,.175261268,.190176552],s=[118847e-9,271306e-9,502642e-9,930833e-9,.001451013,.002064744,.002700432,.003241276,.003524948,-.003350284,-.002491729,-721149e-9,.002164659,.006313635,.011789103,.01854566,.026414396,.03510071,.044196567,.053207202,.061590275,.068803602,.074356193,.077856564,.079052396];function r(t,e){return t.floatTextures||t.halfFloatTextures?`${e}.rgb`:`unpack(${e})`}t.source=t=>`\n            ${i(t)}\n\n            uniform sampler2D u_Sampler0;\n            varying vec2 v_TextureCoordinate;\n\n            const mat3 yiq2rgb_mat = mat3(\n                1.0, 0.956, 0.6210,\n                1.0, -0.2720, -0.6474,\n                1.0, -1.1060, 1.7046\n            );\n\n            vec3 yiq2rgb(vec3 yiq) {\n                return yiq * yiq2rgb_mat;\n            }\n\n            ${t.floatTextures||t.halfFloatTextures?"":"\n                vec3 unpack(vec4 yiqPacked) {\n                    int y_high = int(yiqPacked.r * 1024.0);\n                    int i_high = int(yiqPacked.g * 1024.0);\n                    int q_high = int(yiqPacked.b * 1024.0);\n                    int alpha = int(yiqPacked.a * 256.0);\n\n                    int y_low = alpha - (alpha / 4) * 4;\n                    int i_low = alpha - y_low - (alpha / 16) * 16;\n                    int q_low = alpha - i_low - y_low;\n\n                    return vec3(\n                        float(y_high + y_low) / 1023.0,\n                        float(i_high + i_low) / 1023.0,\n                        float(q_high + q_low) / 1023.0\n                    ) * 3.4 - 1.2;\n                }\n                "}\n\n            vec3 fetch_offset(int offset) {\n                float x = (floor(v_TextureCoordinate.x * 960.0) + 0.5 + float(offset)) / 960.0;\n\n                return step(0.0, x) * step(-1.0, -x) *\n                    ${r(t,"texture2D(u_Sampler0, vec2(x, v_TextureCoordinate.y))")};\n            }\n\n            void main() {\n                float one_x = 1.0 / 960.0;\n                vec3 signal = vec3(0.0);\n\n                ${new Array(24).fill(0).map(((t,i)=>`\n                signal +=\n                    (fetch_offset(${i-24}) + fetch_offset(${24-i})) *\n                        vec3(${e[i]}, ${s[i]}, ${s[i]});\n                `)).join("\n")}\n\n                signal += ${r(t,"texture2D(u_Sampler0, v_TextureCoordinate)")} *\n                    vec3(${e[24]}, ${s[24]}, ${s[24]});\n\n                vec3 rgb = yiq2rgb(signal);\n                gl_FragColor = vec4(rgb, 1.0);\n            }\n        `}(n=t.ntscPass2||(t.ntscPass2={})),function(t){t.source=t=>`\n            ${i(t)}\n\n            uniform sampler2D u_Sampler0;\n            uniform float u_Level;\n            uniform float u_Height;\n\n            varying vec2 v_TextureCoordinate;\n\n            void main() {\n                vec3 texel = texture2D(u_Sampler0, v_TextureCoordinate).rgb;\n\n                gl_FragColor = vec4(\n                    (step(1.0, mod(v_TextureCoordinate.y * u_Height, 2.0)) * (1.0 - u_Level) + u_Level) * texel, 1.0);\n            }\n        `}(o=t.scanlines||(t.scanlines={}))}(e.fsh||(e.fsh={}))},3782:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655).__importDefault(i(427));e.default=class{constructor(){this._reset=new s.default,this._select=new s.default,this._difficultyPlayer1=new s.default,this._difficultyPlayer2=new s.default,this._color=new s.default,this._boundControlPanel=null}bind(t){this.unbind(),this._boundControlPanel=t,this._reset.bind(this._boundControlPanel.getResetButton()),this._select.bind(this._boundControlPanel.getSelectSwitch()),this._difficultyPlayer1.bind(this._boundControlPanel.getDifficultySwitchP0()),this._difficultyPlayer2.bind(this._boundControlPanel.getDifficultySwitchP1()),this._color.bind(this._boundControlPanel.getColorSwitch()),this._difficultyPlayer1.toggle(!0),this._difficultyPlayer2.toggle(!0)}unbind(){this._boundControlPanel&&(this._reset.unbind(),this._select.unbind(),this._difficultyPlayer1.unbind(),this._difficultyPlayer2.unbind(),this._color.unbind(),this._boundControlPanel=null)}reset(){return this._reset}select(){return this._select}difficultyPlayer1(){return this._difficultyPlayer1}difficultyPlayer2(){return this._difficultyPlayer2}color(){return this._color}}},2558:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.Stellerator=void 0;const s=i(655),r=i(8125),a=i(7819),n=s.__importDefault(i(1692)),o=s.__importDefault(i(530)),_=s.__importDefault(i(2548)),h=s.__importDefault(i(6166)),c=s.__importDefault(i(1752)),l=s.__importDefault(i(9725)),u=s.__importDefault(i(4030)),d=s.__importDefault(i(2515)),p=s.__importDefault(i(575)),f=s.__importDefault(i(4067)),m=s.__importDefault(i(2982)),g=s.__importDefault(i(1337)),b=i(8483),y=s.__importDefault(i(3782)),v=s.__importDefault(i(7438)),w=s.__importDefault(i(189));class E{constructor(t=null,e,i={}){this._pauseHandler=()=>{switch(this._emulationService.getState()){case n.default.State.paused:this.resume();break;case n.default.State.running:this.pause()}},this._canvasElt=null,this._config=null,this._emulationService=null,this._serviceInitialized=null,this._videoDriver=null,this._fullscreenVideo=null,this._audioDriver=null,this._keyboardIO=null,this._asyncIO=null,this._touchIO=null,this._paddle=null,this._gamepad=null,this._controlPanel=new y.default,this._state=E.State.stopped,this._driverManager=new _.default,this._mutex=new r.Mutex,this._canvasElt=t,this._config=Object.assign({gamma:1,scalingMode:E.ScalingMode.qis,tvEmulation:E.TvEmulation.svideo,phosphorLevel:.5,scanlineLevel:.2,audio:!0,volume:.5,enableKeyboard:!0,enableTouch:!0,touchLeftHanded:!1,touchJoystickSensitivity:15,keyboardTarget:document,fullscreenViaKeyboard:!0,paddleViaMouse:!0,pauseViaKeyboard:!0,pauseViaTouch:!0,fullscreenViaTouch:!0,enableGamepad:!0,resetViaKeyboard:!0},i),this._emulationService=new o.default(e),this.frequencyUpdate=this._emulationService.frequencyUpdate;const s=new a.Event;this._emulationService.stateChanged.addHandler((t=>s.dispatch(this._mapState(t)))),this.stateChange=s,this._createDrivers(),this._driverManager.addDriver(this._controlPanel,(t=>this._controlPanel.bind(t.getControlPanel()))),this._driverManager.bind(this._emulationService),this._serviceInitialized=this._emulationService.init().then(void 0,(t=>{throw console.log(t),t}))}setGamma(t){return this._config.gamma=t,this._createVideoDriver(),this}getGamma(){return this._config.gamma}setScalingMode(t){return this._config.scalingMode=t,this._createVideoDriver(),this}getScalingMode(){return this._config.scalingMode}setTvEmulation(t){return this._config.tvEmulation=t,this._createVideoDriver(),this}getTvEmulation(){return this._config.tvEmulation}setPhosphorLevel(t){return this._config.phosphorLevel=t,this._createVideoDriver(),this}getPhosphorLevel(){return this._config.phosphorLevel}setScanlineLevel(t){return this._config.scanlineLevel=t,this._createVideoDriver(),this}getScanlineLevel(){return this._config.scanlineLevel}toggleFullscreen(t){return this._fullscreenVideo?(void 0===t?this._fullscreenVideo.toggle():t?this._fullscreenVideo.engage():this._fullscreenVideo.disengage(),this):this}isFullscreen(){return!!this._fullscreenVideo&&this._fullscreenVideo.isEngaged()}setVolume(t){return this._audioDriver&&this._audioDriver.setMasterVolume(Math.max(Math.min(t,1),0)),this}audioEnabled(){return!!this._audioDriver}getVolume(){return this._audioDriver?this._audioDriver.getMasterVolume():0}resize(){return this._videoDriver&&this._videoDriver.resize(),this}getState(){return this._state}getControlPanel(){return this._controlPanel}setCanvas(t){return this._canvasElt=t,this._createVideoDriver(),this._createTouchDriver(),this}releaseCanvas(){return this._removeVideoDriver(),this._removeTouchDriver(),this._canvasElt=null,this}start(t,e,i={}){return this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){"string"==typeof t&&(t=(0,b.decode)(t));const s=g.default.create({tvMode:this._convertTvMode(e),pcmAudio:!0});return void 0!==i.randomSeed&&i.randomSeed>0&&(s.randomSeed=i.randomSeed),void 0!==i.emulatePaddles&&(s.emulatePaddles=i.emulatePaddles),void 0!==i.frameStart&&(s.frameStart=i.frameStart),s.cpuType=function(t=E.CpuAccuracy.cycle){switch(t){case E.CpuAccuracy.cycle:return v.default.Type.stateMachine;case E.CpuAccuracy.instruction:return v.default.Type.batchedAccess;default:throw new Error(`invalid CPU Accuracy: ${t}`)}}(i.cpuAccuracy),yield this._serviceInitialized,this._state=this._mapState(yield this._emulationService.start(t,Object.assign(Object.assign({},s),{asyncIO:i.asyncIO}),i.cartridgeType))}))))}run(t,e,i={}){return s.__awaiter(this,void 0,void 0,(function*(){if((yield this.start(t,e,i))===E.State.paused)return this.resume()}))}pause(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._serviceInitialized,this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){return this._state=this._mapState(yield this._emulationService.pause())}))))}))}resume(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._serviceInitialized,this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){return this._state=this._mapState(yield this._emulationService.resume())}))))}))}stop(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._serviceInitialized,this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){return this._state=this._mapState(yield this._emulationService.stop())}))))}))}reset(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._serviceInitialized,this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){return this._state=this._mapState(yield this._emulationService.reset())}))))}))}lastError(){return this._emulationService.getLastError()}asyncIOSend(t){return this._asyncIO.send(t),this}_convertTvMode(t){switch(t){case E.TvMode.ntsc:return 0;case E.TvMode.pal:return 1;case E.TvMode.secam:return 2;default:throw new Error(`invalid TV mode '${t}'`)}}_createDrivers(){if(this._createVideoDriver(),this._config.audio)try{this._audioDriver=new c.default,this._audioDriver.init(),this._audioDriver.setMasterVolume(this._config.volume),this._driverManager.addDriver(this._audioDriver,(t=>this._audioDriver.bind(!0,[t.getPCMChannel()]))),this._emulationService.stateChanged.addHandler((t=>{t===n.default.State.running?this._audioDriver.resume():this._audioDriver.pause()}))}catch(t){console.error(`failed to initialize audio: ${t&&t.message}`)}this._createTouchDriver(),this._config.enableKeyboard&&(this._keyboardIO=new l.default(this._config.keyboardTarget),this._driverManager.addDriver(this._keyboardIO,(t=>this._keyboardIO.bind(t.getJoystick(0),t.getJoystick(1),t.getControlPanel()))),this._config.fullscreenViaKeyboard&&this._keyboardIO.toggleFullscreen.addHandler((()=>this._fullscreenVideo&&this._fullscreenVideo.toggle())),this._config.pauseViaKeyboard&&this._keyboardIO.togglePause.addHandler(this._pauseHandler),this._config.resetViaKeyboard&&this._keyboardIO.hardReset.addHandler((()=>this.reset()))),this._config.enableGamepad&&(this._gamepad=new p.default,this._gamepad.init(),this._driverManager.addDriver(this._gamepad,(t=>this._gamepad.bind([t.getJoystick(0),t.getJoystick(1)],{start:t.getControlPanel().getResetButton(),select:t.getControlPanel().getSelectSwitch()})))),this._config.paddleViaMouse&&(this._paddle=new d.default,this._driverManager.addDriver(this._paddle,(t=>this._paddle.bind(t.getPaddle(0))))),this._asyncIO=new w.default,this.asyncIOMessage=this._asyncIO.message,this._driverManager.addDriver(this._asyncIO,((t,e)=>e.bind(t.getAsyncIO())))}_removeVideoDriver(){this._videoDriver&&(this._videoDriver.unbind(),this._driverManager.removeDriver(this._videoDriver),this._fullscreenVideo.disengage(),this._fullscreenVideo=null,this._videoDriver=null)}_createVideoDriver(){this._videoDriver&&this._removeVideoDriver(),this._canvasElt&&(this._videoDriver=new h.default(this._canvasElt,{gamma:this._config.gamma,scalingMode:this._config.scalingMode,tvEmulation:this._config.tvEmulation,phosphorLevel:this._config.phosphorLevel,scanlineLevel:this._config.scanlineLevel}).init(),this._driverManager.addDriver(this._videoDriver,(t=>this._videoDriver.bind(t.getVideo()))),this._fullscreenVideo=new f.default(this._videoDriver))}_removeTouchDriver(){this._touchIO&&(this._touchIO.unbind(),this._driverManager.removeDriver(this._touchIO),this._touchIO=null)}_createTouchDriver(){this._touchIO&&this._removeTouchDriver(),this._config.enableTouch&&(this._touchIO=new u.default(this._canvasElt,this._config.touchJoystickSensitivity,this._config.touchLeftHanded),this._driverManager.addDriver(this._touchIO,(t=>this._touchIO.bind(t.getJoystick(0),t.getControlPanel()))),this._config.pauseViaTouch&&this._touchIO.togglePause.addHandler(this._pauseHandler),this._config.fullscreenViaTouch&&this._touchIO.toggleFullscreen.addHandler((()=>this._fullscreenVideo&&this._fullscreenVideo.toggle())))}_mapState(t){switch(t){case n.default.State.stopped:return E.State.stopped;case n.default.State.running:return E.State.running;case n.default.State.paused:return E.State.paused;case n.default.State.error:return E.State.error;default:throw new Error("cannot happen")}}}e.Stellerator=E,e.default=E,function(t){let e,i,s,r,a;!function(t){t.ntsc="ntsc",t.pal="pal",t.secam="secam"}(e=t.TvMode||(t.TvMode={})),function(t){t.composite="composite",t.svideo="svideo",t.none="none"}(i=t.TvEmulation||(t.TvEmulation={})),function(t){t.qis="qis",t.bilinear="bilinear",t.none="none"}(s=t.ScalingMode||(t.ScalingMode={})),t.CartridgeType=m.default.CartridgeType,t.describeCartridgeType=m.default.describeCartridgeType,t.allCartridgeTypes=m.default.getAllTypes,function(t){t.running="running",t.paused="paused",t.stopped="stopped",t.error="error"}(r=t.State||(t.State={})),function(t){t.cycle="cycle",t.instruction="instruction"}(a=t.CpuAccuracy||(t.CpuAccuracy={}))}(E=e.Stellerator||(e.Stellerator={})),e.default=E},427:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(7819);class r{constructor(){this.stateChange=new s.Event,this._state=!1,this._boundSwitch=null}bind(t){this.unbind(),this._boundSwitch=t,this._boundSwitch.toggle(this._state),this._boundSwitch.stateChanged.addHandler(r._onBoundStateChange,this),this._setState(this._boundSwitch.read())}unbind(){this._boundSwitch&&(this._boundSwitch.stateChanged.removeHandler(r._onBoundStateChange,this),this._boundSwitch=null)}toggle(t){return this._boundSwitch?this._boundSwitch.toggle(t):this._setState(t),this}read(){return this._state}static _onBoundStateChange(t,e){e._setState(t)}_setState(t){t!==this._state&&(this._state=t,this.stateChange.dispatch(this._state))}}e.default=r},9725:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(7819);function r(t){return{type:0,swtch:t}}function a(t){return{type:1,trigger:t}}class n{constructor(t,e=n.defaultMappings){this._target=t,this.toggleFullscreen=new s.Event,this.hardReset=new s.Event,this.togglePause=new s.Event,this._keydownListener=null,this._keyupListener=null,this._joystick0=null,this._joystick1=null,this._controlPanel=null,this._dispatchTable={},this._compiledMappings=new Map,this._compileMappings(e)}bind(t,e,i){this._joystick0||(this._joystick0=t,this._joystick1=e,this._controlPanel=i,this._updateActionTable(),this._keydownListener=t=>{if(!this._compiledMappings.has(t.keyCode))return;const e=(t.shiftKey?4:0)|(t.ctrlKey?1:0)|(t.altKey?2:0);if(!this._compiledMappings.get(t.keyCode).has(e))return;const i=this._compiledMappings.get(t.keyCode).get(e);if(void 0!==i){t.preventDefault();const e=this._dispatchTable[i];switch(e.type){case 0:e.swtch.toggle(!0);break;case 1:e.trigger.dispatch(void 0)}}},this._keyupListener=t=>{if(this._compiledMappings.has(t.keyCode))for(const e of this._compiledMappings.get(t.keyCode).values()){t.preventDefault();const i=this._dispatchTable[e];0===i.type&&i.swtch.toggle(!1)}},this._target.addEventListener("keydown",this._keydownListener),this._target.addEventListener("keyup",this._keyupListener))}unbind(){this._joystick0&&(this._target.removeEventListener("keydown",this._keydownListener),this._target.removeEventListener("keyup",this._keyupListener),this._joystick0=this._joystick1=this._controlPanel=null,this._keydownListener=this._keyupListener=null)}_updateActionTable(){this._dispatchTable[12]=a(this.toggleFullscreen),this._dispatchTable[13]=a(this.hardReset),this._dispatchTable[14]=a(this.togglePause),this._dispatchTable[0]=r(this._controlPanel.getSelectSwitch()),this._dispatchTable[1]=r(this._controlPanel.getResetButton()),this._dispatchTable[2]=r(this._joystick0.getLeft()),this._dispatchTable[3]=r(this._joystick0.getRight()),this._dispatchTable[4]=r(this._joystick0.getUp()),this._dispatchTable[5]=r(this._joystick0.getDown()),this._dispatchTable[10]=r(this._joystick0.getFire()),this._dispatchTable[6]=r(this._joystick1.getLeft()),this._dispatchTable[7]=r(this._joystick1.getRight()),this._dispatchTable[8]=r(this._joystick1.getUp()),this._dispatchTable[9]=r(this._joystick1.getDown()),this._dispatchTable[11]=r(this._joystick1.getFire())}_compileMappings(t){const e=(t,e,i)=>{if(0!=(-8&i))throw new Error(`invalid modifier set ${i}`);this._compiledMappings.has(e)||this._compiledMappings.set(e,new Map),this._compiledMappings.get(e).set(i,t)};t.forEach((t=>{const i=t.action;(Array.isArray(t.spec)?t.spec:[t.spec]).forEach((t=>e(i,"object"==typeof t?t.keycode:t,"object"==typeof t?t.modifiers:0)))}))}}e.default=n,function(t){t.defaultMappings=[{action:0,spec:{keycode:32,modifiers:4}},{action:1,spec:{keycode:13,modifiers:4}},{action:2,spec:[65,37]},{action:3,spec:[68,39]},{action:4,spec:[87,38]},{action:5,spec:[83,40]},{action:10,spec:[32,86]},{action:6,spec:74},{action:7,spec:76},{action:8,spec:73},{action:9,spec:75},{action:11,spec:66},{action:12,spec:13},{action:13,spec:{keycode:82,modifiers:4}},{action:14,spec:80}]}(n||(n={})),e.default=n},4030:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(655),r=i(7819),a=s.__importDefault(i(5601));class n{constructor(t,e){this.touch=t,this.type="unknown";const i=e.getBoundingClientRect();this.x=(t.clientX-i.left)/i.width,this.y=(t.clientY-i.top)/i.height,this.x0=t.clientX,this.y0=t.clientY}}e.default=class{constructor(t,e=15,i=!1){this._canvas=t,this._joystickSensitivity=e,this._leftHanded=i,this._onTouchStart=t=>{for(let e=0;e<t.changedTouches.length;e++){const i=new n(t.changedTouches.item(e),this._canvas),s=i.touch.identifier;if((this._leftHanded?i.x>.5:i.x<=.5)?i.y<=.5?i.type="alt":i.type=this._isAlt?"pause":"fire":i.y<=.5?i.type=this._isAlt?"select":"joystick":i.type=this._isAlt?"reset":"joystick",!this._pendingTouches.has(s)&&!this._pendingTouches.has(i.type))switch(this._pendingTouches.set(s,i),this._pendingTouches.set(i.type,i),i.type){case"alt":this._isAlt=!0,this._fullscreenDoubleTapDetector.startTouch();break;case"fire":this._joystick.getFire().toggle(!0);break;case"pause":this.togglePause.dispatch(void 0),this._fullscreenDoubleTapDetector.cancelTouch();break;case"select":this._select.toggle(!0),this._fullscreenDoubleTapDetector.cancelTouch();break;case"reset":this._reset.toggle(!0),this._fullscreenDoubleTapDetector.cancelTouch();break;case"joystick":break;default:throw new Error("invalid touch type")}}t.preventDefault()},this._onTouchEnd=t=>{for(let e=0;e<t.changedTouches.length;e++){const i=this._pendingTouches.get(t.changedTouches.item(e).identifier);if(i){switch(i.type){case"alt":this._isAlt=!1,this._fullscreenDoubleTapDetector.endTouch();break;case"fire":this._joystick.getFire().toggle(!1);break;case"select":this._select.toggle(!1);break;case"reset":this._reset.toggle(!1);break;case"joystick":this._joystick.getDown().toggle(!1),this._joystick.getUp().toggle(!1),this._joystick.getLeft().toggle(!1),this._joystick.getRight().toggle(!1);break;case"pause":break;default:throw new Error("invalid touch type")}this._pendingTouches.delete(i.type),this._pendingTouches.delete(i.touch.identifier)}}t.preventDefault()},this._onTouchMove=t=>{for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches.item(e),s=this._pendingTouches.get(i.identifier);if(!s)continue;if("joystick"!==s.type)continue;const r=i.clientX-s.x0,a=i.clientY-s.y0,n=Math.sqrt(r*r+a*a),o=Math.abs(a/n),_=Math.abs(r/n),h=n>this._joystickSensitivity;this._joystick.getLeft().toggle(h&&r<0&&_>.5),this._joystick.getRight().toggle(h&&r>0&&_>.5),this._joystick.getUp().toggle(h&&a<0&&o>.5),this._joystick.getDown().toggle(h&&a>0&&o>.5),n>3*this._joystickSensitivity&&(s.x0+=r/n*(n-3*this._joystickSensitivity),s.y0+=a/n*(n-3*this._joystickSensitivity))}t.preventDefault()},this.togglePause=new r.Event,this._fullscreenDoubleTapDetector=new a.default,this._bound=!1,this._joystick=null,this._select=null,this._reset=null,this._isAlt=!1,this._pendingTouches=new Map,this.toggleFullscreen=this._fullscreenDoubleTapDetector.trigger}static isSupported(){return"ontouchstart"in window}bind(t,e){this._bound||(this._bound=!0,this._joystick=t,this._select=e.getSelectSwitch(),this._reset=e.getResetButton(),this._bindListeners())}unbind(){this._bound&&(this._unbindListeners(),this._bound=!1,this._joystick=this._reset=this._select=null)}_bindListeners(){this._canvas.addEventListener("touchstart",this._onTouchStart),this._canvas.addEventListener("touchend",this._onTouchEnd),this._canvas.addEventListener("touchmove",this._onTouchMove)}_unbindListeners(){this._canvas.removeEventListener("touchstart",this._onTouchStart),this._canvas.removeEventListener("touchend",this._onTouchEnd),this._canvas.removeEventListener("touchmove",this._onTouchMove)}}},1752:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=s.__importDefault(i(2845));e.default=class{constructor(t){this._fragmentSize=t,this._pcmAudio=!1,this._volume=1}init(){}bind(t,e){if(!this._channels){this._channels=[...e],this._driver&&this._pcmAudio===t||(this._driver&&this._driver.close(),this._driver=t?new r.default(0,this._channels.length,this._fragmentSize):new r.default(this._channels.length,0,this._fragmentSize),this._driver.init()),t?this._driver.bind([],this._channels):this._driver.bind(this._channels,[]);for(let t=0;t<this._channels.length;t++)this._driver.setMasterVolume(t,this._volume);this._pcmAudio=t}}unbind(){this._channels&&(this._driver.unbind(),this._channels=null)}setMasterVolume(t){if(this._volume=t,this._channels)for(let t=0;t<this._channels.length;t++)this._driver.setMasterVolume(t,this._volume)}getMasterVolume(){return this._volume}pause(){return s.__awaiter(this,void 0,void 0,(function*(){this._driver&&(yield this._driver.pause())}))}resume(){return s.__awaiter(this,void 0,void 0,(function*(){this._driver&&(yield this._driver.resume())}))}}},5601:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7819);e.default=class{constructor(t=500,e=200){this._maxTapLength=t,this._timeout=e,this.trigger=new s.Event,this._dispatch=!1,this._touching=!1,this._lastTouchEligible=!1,this._lastTouchStart=0,this._lastTouchEnd=0}startTouch(){this._lastTouchStart=Date.now(),this._touching||(this._touching=!0,this._dispatch=this._lastTouchEligible&&this._lastTouchStart-this._lastTouchEnd<this._timeout)}endTouch(){this._lastTouchEnd=Date.now(),this._dispatch&&(this._dispatch=!1,this.trigger.dispatch(void 0)),this._touching&&(this._touching=!1,this._lastTouchEligible=this._lastTouchStart-this._lastTouchEnd<this._maxTapLength)}cancelTouch(){this.endTouch(),this._lastTouchEligible=!1}isDispatching(){return this._dispatch}}},2548:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655).__importDefault(i(1692));class r{constructor(){this._drivers=new Map,this._driversBound=!1}bind(t){return this._driversBound||(this._emulationService=t,this._shouldBindDrivers()&&this._bindDrivers(),this._emulationService.stateChanged.addHandler(r._onEmuStateChange,this)),this}unbind(){return this._emulationService?(this._unbindDrivers(),this._emulationService.stateChanged.removeHandler(r._onEmuStateChange,this),this._emulationService=null,this):this}addDriver(t,e){return this._drivers.set(t,new r.DriverContext(t,e)),this._driversBound&&e(this._emulationService.getEmulationContext(),t),this}removeDriver(t){return this._drivers.get(t)?(t.unbind(),this._drivers.delete(t),this):this}static _onEmuStateChange(t,e){e._shouldBindDrivers(t)?e._bindDrivers():e._unbindDrivers()}_shouldBindDrivers(t=(this._emulationService?this._emulationService.getState():void 0)){return this._emulationService&&(t===s.default.State.running||t===s.default.State.paused)}_bindDrivers(){this._driversBound||(this._drivers.forEach((t=>t.binder(this._emulationService.getEmulationContext(),t.driver))),this._driversBound=!0)}_unbindDrivers(){this._driversBound&&(this._drivers.forEach((t=>t.driver.unbind())),this._driversBound=!1)}}e.default=r,function(t){t.DriverContext=class{constructor(t,e){this.driver=t,this.binder=e}}}(r||(r={})),e.default=r},1692:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,function(t){let e;!function(t){t.stopped="stopped",t.running="running",t.paused="paused",t.error="error"}(e=t.State||(t.State={}))}(i||(i={})),e.default=i},2157:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3454),r=i(7819);e.default=class{constructor(t){this._rpc=t,this.message=new r.Event}init(){this._rpc.registerSignalHandler(s.SIGNAL_TYPE.messageFromAsyncIO,(t=>this.message.dispatch(t)))}send(t){this._rpc.signal(s.SIGNAL_TYPE.messageToAsyncIO,Array.from(t))}}},7577:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=s.__importDefault(i(7451)),a=s.__importDefault(i(9823)),n=s.__importDefault(i(7866)),o=i(3454);class _{constructor(t){this._rpc=t,this._joysticks=new Array(2),this._paddles=new Array(4),this._controlPanel=new a.default;for(let t=0;t<2;t++)this._joysticks[t]=new r.default;for(let t=0;t<4;t++)this._paddles[t]=new n.default}sendUpdate(){this._rpc.signal(o.SIGNAL_TYPE.controlStateUpdate,{joystickState:this._joysticks.map(_._joystickState),paddleState:this._paddles.map(_._paddleState),controlPanelState:_._controlPanelState(this._controlPanel)})}getJoystick(t){if(t<0||t>1)throw new Error(`invalid joystick index ${t}`);return this._joysticks[t]}getControlPanel(){return this._controlPanel}getPaddle(t){if(t<0||t>3)throw new Error(`invalid paddle index ${t}`);return this._paddles[t]}static _joystickState(t){return{up:t.getUp().read(),down:t.getDown().read(),left:t.getLeft().read(),right:t.getRight().read(),fire:t.getFire().read()}}static _paddleState(t){return{value:t.getValue(),fire:t.getFire().read()}}static _controlPanelState(t){return{difficulty0:t.getDifficultySwitchP0().read(),difficulty1:t.getDifficultySwitchP1().read(),select:t.getSelectSwitch().read(),reset:t.getResetButton().read(),color:t.getColorSwitch().read()}}}e.default=_},3097:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=class{constructor(t,e,i,s,r){if(this._videoProxy=t,this._controlProxy=e,this._waveformChannels=i,this._pcmChannel=s,this._asyncIOProxy=r,this._config=null,2!==this._waveformChannels.length)throw new Error(`invalid channel count ${this._waveformChannels.length}`)}setConfig(t){this._config=t}getConfig(){return this._config}getVideo(){return this._videoProxy}getJoystick(t){return this._controlProxy.getJoystick(t)}getControlPanel(){return this._controlProxy.getControlPanel()}getPaddle(t){return this._controlProxy.getPaddle(t)}getWaveformChannels(){return this._waveformChannels}getPCMChannel(){return this._pcmChannel}getVideoProxy(){return this._videoProxy}getAsyncIO(){return this._asyncIOProxy}}},530:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(7819),a=i(158),n=s.__importDefault(i(1692)),o=s.__importDefault(i(3097)),_=s.__importDefault(i(9158)),h=s.__importDefault(i(7577)),c=s.__importDefault(i(4197)),l=s.__importDefault(i(2277)),u=i(8125),d=i(3454),p=s.__importDefault(i(2157));e.default=class{constructor(t){this._stellaWorkerUri=t,this.stateChanged=new r.Event,this.frequencyUpdate=new r.Event,this._rateLimitEnforced=!0,this._mutex=new u.Mutex,this._worker=null,this._rpc=null,this._state=n.default.State.stopped,this._lastError=null,this._emulationContext=null,this._frequency=0,this._waveformChannels=new Array(2),this._pcmChannel=null,this._controlProxy=null,this._controlProxyUpdateHandle=null,this._proxyState=0,this._savedConfig=null}init(){return s.__awaiter(this,void 0,void 0,(function*(){this._worker=new Worker(this._stellaWorkerUri),this._rpc=new a.RpcProvider(((t,e)=>this._worker.postMessage(t,e))),this._pcmChannel=new l.default(0,this._rpc).init();for(let t=0;t<2;t++)this._waveformChannels[t]=new c.default(t,this._rpc).init();const t=new _.default(this._rpc),e=new h.default(this._rpc),i=new p.default(this._rpc);i.init(),t.init(),this._emulationContext=new o.default(t,e,this._waveformChannels,this._pcmChannel,i),this._worker.onmessage=t=>this._rpc.dispatch(t.data),this._rpc.registerSignalHandler(d.SIGNAL_TYPE.emulationFrequencyUpdate,this._onFrequencyUpdate.bind(this)).registerSignalHandler(d.SIGNAL_TYPE.emulationError,this._onEmulationError.bind(this)),this._controlProxy=e}))}start(t,e,i){return s.__awaiter(this,void 0,void 0,(function*(){return yield this.stop(),this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){const s=yield this._rpc.rpc(d.RPC_TYPE.emulationStart,{buffer:t,config:e,cartridgeType:i});return s===n.default.State.paused?(this._savedConfig=e,this._emulationContext.setConfig(e),yield this._startProxies(e)):this._savedConfig=null,this._applyState(s)}))))}))}pause(){return this._mutex.runExclusive((()=>this._rpc.rpc(d.RPC_TYPE.emulationPause).then((t=>(this._pauseProxies(),this._applyState(t))))))}stop(){return this._mutex.runExclusive((()=>this._rpc.rpc(d.RPC_TYPE.emulationStop).then((t=>(this._stopProxies(),this._applyState(t))))))}reset(){return this._mutex.runExclusive((()=>s.__awaiter(this,void 0,void 0,(function*(){const t=yield this._rpc.rpc(d.RPC_TYPE.emulationReset);return this._state!==n.default.State.error||t!==n.default.State.running&&t!==n.default.State.paused||!this._savedConfig||(yield this._startProxies(this._savedConfig)),this._applyState(t)}))))}resume(){return this._mutex.runExclusive((()=>this._rpc.rpc(d.RPC_TYPE.emulationResume).then((t=>(this._resumeProxies(),this._applyState(t))))))}setRateLimit(t){return this._rateLimitEnforced=t,this._rpc.rpc(d.RPC_TYPE.emulationSetRateLimit,t)}getFrequency(){return this._frequency}getRateLimit(){return this._rateLimitEnforced}getState(){return this._state}getLastError(){return this._lastError}getEmulationContext(){switch(this._state){case n.default.State.running:case n.default.State.paused:return this._emulationContext;default:return null}}_fetchLastError(){return this._rpc.rpc(d.RPC_TYPE.emulationFetchLastError).then((t=>t?new Error(t):null))}_applyState(t){return t===n.default.State.error?this._fetchLastError().then((e=>(this._state=t,this._lastError=e,this._stopProxies(),this.stateChanged.dispatch(t),t))):(this._state=t,this.stateChanged.dispatch(t),t)}_onFrequencyUpdate(t){this._frequency=t,this.frequencyUpdate.dispatch(this._frequency)}_onEmulationError(t){this._lastError=new Error(t||""),this._stopProxies(),this._state=n.default.State.error,this.stateChanged.dispatch(this._state)}_startProxies(t){return s.__awaiter(this,void 0,void 0,(function*(){yield this._emulationContext.getVideoProxy().start();for(let e=0;e<this._waveformChannels.length;e++)yield this._waveformChannels[e].start(t);yield this._pcmChannel.start(),this._startControlUpdates(),this._proxyState=1}))}_stopProxies(){0!==this._proxyState&&(this._emulationContext.getVideoProxy().stop(),this._pcmChannel.stop(),this._stopControlUpdates(),this._proxyState=0)}_pauseProxies(){1===this._proxyState&&(this._stopControlUpdates(),this._proxyState=2)}_resumeProxies(){2===this._proxyState&&(this._startControlUpdates(),this._proxyState=1)}_startControlUpdates(){null===this._controlProxyUpdateHandle&&(this._controlProxyUpdateHandle=setInterval((()=>this._controlProxy.sendUpdate()),25))}_stopControlUpdates(){null!==this._controlProxyUpdateHandle&&(clearInterval(this._controlProxyUpdateHandle),this._controlProxyUpdateHandle=null)}}},2277:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(7819),a=s.__importDefault(i(2518)),n=i(3454);class o{constructor(t,e){this._index=t,this._rpc=e,this.newFrame=new r.Event,this.togglePause=new r.Event,this._sampleRate=0,this._frameSize=0,this._paused=!1,this._framePool=new a.default((()=>null)),this._frameMap=new WeakMap,this._enabled=!1,this._signalReturnFrame="",this._framePool.event.release.addHandler(o._onReleaseFragment,this),this._signalReturnFrame=n.SIGNAL_TYPE.pcmAudioReturnFrame(this._index)}init(){return this._rpc.registerSignalHandler(n.SIGNAL_TYPE.pcmAudioNewFrame(this._index),this._onNewFrame.bind(this)).registerSignalHandler(n.SIGNAL_TYPE.pcmAudioTogglePause(this._index),this._onTogglePause.bind(this)),this}start(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._enabled)return;const t=yield this._rpc.rpc(n.RPC_TYPE.getPCMAudioParameters(this._index));this._sampleRate=t.sampleRate,this._frameSize=t.frameSize,this._paused=t.paused,this._enabled=!0}))}stop(){this._enabled=!1}isPaused(){return this._paused}getSampleRate(){return this._sampleRate}getFrameSize(){return this._frameSize}static _onReleaseFragment(t,e){e._frameMap.has(t)&&e._rpc.signal(e._signalReturnFrame,{id:e._frameMap.get(t),buffer:t.buffer},[t.buffer])}_onNewFrame(t){if(!this._enabled)return;const e=this._framePool.get(),i=new Float32Array(t.buffer);e.adopt(i),this._frameMap.set(i,t.id),this.newFrame.dispatch(e)}_onTogglePause(t){t.paused!==this._paused&&(this._paused=t.paused,this.togglePause.dispatch(this._paused))}}e.default=o},9158:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(7819),a=s.__importDefault(i(2518)),n=i(3454);class o{constructor(t){this._rpc=t,this.newFrame=new r.Event,this._framePool=new a.default((()=>null)),this._frameMap=null,this._active=!1,this._width=0,this._height=0,this._framePool.event.release.addHandler(o._onDisposeFrame,this)}init(){this._rpc.registerSignalHandler(n.SIGNAL_TYPE.videoNewFrame,this._onNewFrame.bind(this))}start(){return s.__awaiter(this,void 0,void 0,(function*(){this._active&&this.stop();const t=yield this._rpc.rpc(n.RPC_TYPE.getVideoParameters);this._active=!0,this._width=t.width,this._height=t.height,this._frameMap=new WeakMap}))}stop(){this._active=!1}getWidth(){return this._width}getHeight(){return this._height}static _onDisposeFrame(t,e){if(!e._active)return;if(!e._frameMap.has(t))return void console.warn("unknown imageData returned to proxy");const i=e._frameMap.get(t);e._frameMap.delete(t),e._rpc.signal(n.SIGNAL_TYPE.videoReturnSurface,{id:i,buffer:t.data.buffer},[t.data.buffer])}_onNewFrame(t){if(!this._active)return void console.warn("video proxy deactivated: ignoring frame");if(this._width!==t.width||this._height!==t.height)return void console.warn("surface dimensions do not match; ignoring frame");const e=this._framePool.get(),i=new ImageData(new Uint8ClampedArray(t.buffer),t.width,t.height);e.adopt(i),this._frameMap.set(i,t.id),this.newFrame.dispatch(e)}}e.default=o},4197:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const s=i(655),r=i(7819),a=s.__importDefault(i(7028)),n=i(3454);e.default=class{constructor(t,e){this._index=t,this._rpc=e,this.bufferChanged=new r.Event,this.volumeChanged=new r.Event,this.stop=new r.Event,this._toneGenerator=new a.default,this._volume=0}init(){return this._rpc.registerSignalHandler(n.SIGNAL_TYPE.waveformAudioBufferChange,this._onBufferChangeSignal.bind(this)).registerSignalHandler(n.SIGNAL_TYPE.waveformAudioVolumeChange,this._onVolumeChangeSignal.bind(this)).registerSignalHandler(n.SIGNAL_TYPE.audioStop,this._onStopSignal.bind(this)),this}start(t){return s.__awaiter(this,void 0,void 0,(function*(){const e=yield this._rpc.rpc(n.RPC_TYPE.getWaveformAudioParameters(this._index));this._toneGenerator.setConfig(t),this.setVolume(e.volume)}))}setVolume(t){return this._volume=t,this}getVolume(){return this._volume}getBuffer(t){return this._toneGenerator.getBuffer(t)}_onVolumeChangeSignal(t){t.index===this._index&&(this._volume=t.value,this.volumeChanged.dispatch(this._volume))}_onBufferChangeSignal(t){t.index===this._index&&this.bufferChanged.dispatch(t.key)}_onStopSignal(t){t===this._index&&this.stop.dispatch(void 0)}}},3454:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SIGNAL_TYPE=e.RPC_TYPE=void 0,e.RPC_TYPE={emulationPause:"emulation/pause",emulationReset:"emulation/reset",emulationResume:"emulation/resume",emulationSetRateLimit:"emulation/setRateLimit",emulationStart:"emulation/start",emulationStop:"emulation/stop",emulationFetchLastError:"emulation/fetchLastError",getVideoParameters:"video/getParameters",getWaveformAudioParameters:t=>`audio/waveform/getParameters/${t}`,getPCMAudioParameters:t=>`audio/pcm/getParameters/${t}`,setup:"/setup"},Object.freeze(e.RPC_TYPE),e.SIGNAL_TYPE={emulationError:"emulation/error",emulationFrequencyUpdate:"emulation/frequencyUpdate",videoNewFrame:"video/newFrame",videoReturnSurface:"video/returnSurface",controlStateUpdate:"control/stateUpdate",waveformAudioVolumeChange:"audio/waveform/volumeChange",waveformAudioBufferChange:"audio/waveform/bufferChange",pcmAudioNewFrame:t=>`audio/pcm/newFrame/${t}`,pcmAudioTogglePause:t=>`audio/pcm/togglePause/${t}`,pcmAudioReturnFrame:t=>`audio/pcm/returnFrame/${t}`,audioStop:"audio/stop",messageFromAsyncIO:"asyncIO/messageFrom",messageToAsyncIO:"asyncIO/messageTo"},Object.freeze(e.SIGNAL_TYPE)},655:(t,e,i)=>{i.r(e),i.d(e,{__assign:()=>a,__asyncDelegator:()=>w,__asyncGenerator:()=>v,__asyncValues:()=>E,__await:()=>y,__awaiter:()=>c,__classPrivateFieldGet:()=>A,__classPrivateFieldIn:()=>S,__classPrivateFieldSet:()=>k,__createBinding:()=>u,__decorate:()=>o,__exportStar:()=>d,__extends:()=>r,__generator:()=>l,__importDefault:()=>P,__importStar:()=>C,__makeTemplateObject:()=>x,__metadata:()=>h,__param:()=>_,__read:()=>f,__rest:()=>n,__spread:()=>m,__spreadArray:()=>b,__spreadArrays:()=>g,__values:()=>p});var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var a=function(){return a=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},a.apply(this,arguments)};function n(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(i[s[r]]=t[s[r]])}return i}function o(t,e,i,s){var r,a=arguments.length,n=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(n=(a<3?r(n):a>3?r(e,i,n):r(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n}function _(t,e){return function(i,s){e(i,s,t)}}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,i,s){return new(i||(i=Promise))((function(r,a){function n(t){try{_(s.next(t))}catch(t){a(t)}}function o(t){try{_(s.throw(t))}catch(t){a(t)}}function _(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,o)}_((s=s.apply(t,e||[])).next())}))}function l(t,e){var i,s,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,s=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((r=(r=n.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],s=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var u=Object.create?function(t,e,i,s){void 0===s&&(s=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,r)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]};function d(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||u(e,t,i)}function p(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,a=i.call(t),n=[];try{for(;(void 0===e||e-- >0)&&!(s=a.next()).done;)n.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return n}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function g(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var s=Array(t),r=0;for(e=0;e<i;e++)for(var a=arguments[e],n=0,o=a.length;n<o;n++,r++)s[r]=a[n];return s}function b(t,e,i){if(i||2===arguments.length)for(var s,r=0,a=e.length;r<a;r++)!s&&r in e||(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function v(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=i.apply(t,e||[]),a=[];return s={},n("next"),n("throw"),n("return"),s[Symbol.asyncIterator]=function(){return this},s;function n(t){r[t]&&(s[t]=function(e){return new Promise((function(i,s){a.push([t,e,i,s])>1||o(t,e)}))})}function o(t,e){try{(i=r[t](e)).value instanceof y?Promise.resolve(i.value.v).then(_,h):c(a[0][2],i)}catch(t){c(a[0][3],t)}var i}function _(t){o("next",t)}function h(t){o("throw",t)}function c(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}}function w(t){var e,i;return e={},s("next"),s("throw",(function(t){throw t})),s("return"),e[Symbol.iterator]=function(){return this},e;function s(s,r){e[s]=t[s]?function(e){return(i=!i)?{value:y(t[s](e)),done:"return"===s}:r?r(e):e}:r}}function E(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=p(t),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(i){e[i]=t[i]&&function(e){return new Promise((function(s,r){!function(t,e,i,s){Promise.resolve(s).then((function(e){t({value:e,done:i})}),e)}(s,r,(e=t[i](e)).done,e.value)}))}}}function x(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var T=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&u(e,t,i);return T(e,t),e}function P(t){return t&&t.__esModule?t:{default:t}}function A(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function k(t,e,i,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(t,i):r?r.value=i:e.set(t,i),i}function S(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}},8520:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=i(7819),r="resolve_transaction",a="reject_transaction",n="error",o=function(){function t(t,e){void 0===e&&(e=0),this._dispatch=t,this._rpcTimeout=e,this.error=new s.Event,this._rpcHandlers={},this._signalHandlers={},this._pendingTransactions={},this._nextTransactionId=0}return t.prototype.dispatch=function(e){var i=e;switch(i.type){case t.MessageType.signal:return this._handleSignal(i);case t.MessageType.rpc:return this._handeRpc(i);case t.MessageType.internal:return this._handleInternal(i);default:this._raiseError("invalid message type "+i.type)}},t.prototype.rpc=function(e,i,s){var r=this,a=this._nextTransactionId++;return this._dispatch({type:t.MessageType.rpc,transactionId:a,id:e,payload:i},s||void 0),new Promise((function(t,e){var i=r._pendingTransactions[a]={id:a,resolve:t,reject:e};r._rpcTimeout>0&&(r._pendingTransactions[a].timeoutHandle=setTimeout((function(){return r._transactionTimeout(i)}),r._rpcTimeout))}))},t.prototype.signal=function(e,i,s){return this._dispatch({type:t.MessageType.signal,id:e,payload:i},s||void 0),this},t.prototype.registerRpcHandler=function(t,e){if(this._rpcHandlers[t])throw new Error("rpc handler for "+t+" already registered");return this._rpcHandlers[t]=e,this},t.prototype.registerSignalHandler=function(t,e){return this._signalHandlers[t]||(this._signalHandlers[t]=[]),this._signalHandlers[t].push(e),this},t.prototype.deregisterRpcHandler=function(t,e){return this._rpcHandlers[t]&&delete this._rpcHandlers[t],this},t.prototype.deregisterSignalHandler=function(t,e){return this._signalHandlers[t]&&(this._signalHandlers[t]=this._signalHandlers[t].filter((function(t){return e!==t}))),this},t.prototype._raiseError=function(e){this.error.dispatch(new Error(e)),this._dispatch({type:t.MessageType.internal,id:n,payload:e})},t.prototype._handleSignal=function(t){if(!this._signalHandlers[t.id])return this._raiseError("invalid signal "+t.id);this._signalHandlers[t.id].forEach((function(e){return e(t.payload)}))},t.prototype._handeRpc=function(e){var i=this;if(!this._rpcHandlers[e.id])return this._raiseError("invalid rpc "+e.id);Promise.resolve(this._rpcHandlers[e.id](e.payload)).then((function(s){return i._dispatch({type:t.MessageType.internal,id:r,transactionId:e.transactionId,payload:s})}),(function(s){return i._dispatch({type:t.MessageType.internal,id:a,transactionId:e.transactionId,payload:s})}))},t.prototype._handleInternal=function(t){var e=void 0!==t.transactionId?this._pendingTransactions[t.transactionId]:void 0;switch(t.id){case r:if(!e||void 0===t.transactionId)return this._raiseError("no pending transaction with id "+t.transactionId);e.resolve(t.payload),this._clearTransaction(this._pendingTransactions[t.transactionId]);break;case a:if(!e||void 0===t.transactionId)return this._raiseError("no pending transaction with id "+t.transactionId);this._pendingTransactions[t.transactionId].reject(t.payload),this._clearTransaction(this._pendingTransactions[t.transactionId]);break;case n:this.error.dispatch(new Error("remote error: "+t.payload));break;default:this._raiseError("unhandled internal message "+t.id)}},t.prototype._transactionTimeout=function(t){t.reject("transaction timed out"),this._raiseError("transaction "+t.id+" timed out"),delete this._pendingTransactions[t.id]},t.prototype._clearTransaction=function(t){void 0!==t.timeoutHandle&&clearTimeout(t.timeoutHandle),delete this._pendingTransactions[t.id]},t}();!function(t){var e;(e=t.MessageType||(t.MessageType={}))[e.signal=0]="signal",e[e.rpc=1]="rpc",e[e.internal=2]="internal"}(o||(o={})),e.default=o},158:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=i(8520);e.RpcProvider=s.default},7489:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});const s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=(()=>{if("undefined"==typeof document)return!1;const t=s[0],e={};for(const i of s){const s=i?.[1];if(s in document){for(const[s,r]of i.entries())e[t[s]]=r;return e}}return!1})(),a={change:r.fullscreenchange,error:r.fullscreenerror};let n={request:(t=document.documentElement,e)=>new Promise(((i,s)=>{const a=()=>{n.off("change",a),i()};n.on("change",a);const o=t[r.requestFullscreen](e);o instanceof Promise&&o.then(a).catch(s)})),exit:()=>new Promise(((t,e)=>{if(!n.isFullscreen)return void t();const i=()=>{n.off("change",i),t()};n.on("change",i);const s=document[r.exitFullscreen]();s instanceof Promise&&s.then(i).catch(e)})),toggle:(t,e)=>n.isFullscreen?n.exit():n.request(t,e),onchange(t){n.on("change",t)},onerror(t){n.on("error",t)},on(t,e){const i=a[t];i&&document.addEventListener(i,e,!1)},off(t,e){const i=a[t];i&&document.removeEventListener(i,e,!1)},raw:r};Object.defineProperties(n,{isFullscreen:{get:()=>Boolean(document[r.fullscreenElement])},element:{enumerable:!0,get:()=>document[r.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>Boolean(document[r.fullscreenEnabled])}}),r||(n={isEnabled:!1});const o=n}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var a=e[s]={exports:{}};return t[s](a,a.exports,i),a.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{var t=s;const e=i(655).__importDefault(i(2558));t.default={Stellerator:e.default}})(),s.default})()));
//# sourceMappingURL=stellerator-embedded.js.map